/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Dr=Object.create;var Re=Object.defineProperty;var Tr=Object.getOwnPropertyDescriptor;var Nr=Object.getOwnPropertyNames,en=Object.getOwnPropertySymbols,Mr=Object.getPrototypeOf,tn=Object.prototype.hasOwnProperty,Ir=Object.prototype.propertyIsEnumerable;var nn=(t,e,n)=>e in t?Re(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,rn=(t,e)=>{for(var n in e||(e={}))tn.call(e,n)&&nn(t,n,e[n]);if(en)for(var n of en(e))Ir.call(e,n)&&nn(t,n,e[n]);return t};var on=t=>Re(t,"__esModule",{value:!0});var Or=(t,e)=>{on(t);for(var n in e)Re(t,n,{get:e[n],enumerable:!0})},Pr=(t,e,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Nr(e))!tn.call(t,r)&&r!=="default"&&Re(t,r,{get:()=>e[r],enumerable:!(n=Tr(e,r))||n.enumerable});return t},ae=t=>Pr(on(Re(t!=null?Dr(Mr(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);Or(exports,{default:()=>Xt});var mt=ae(require("obsidian"));var Jt=ae(require("obsidian"));var H=function(){return H=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},H.apply(this,arguments)};function I(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function J(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o}var $r="ENTRIES",sn="KEYS",an="VALUES",K="",vt=function(){function t(e,n){var r=e._tree,i=Array.from(r.keys());this.set=e,this._type=n,this._path=i.length>0?[{node:r,keys:i}]:[]}return t.prototype.next=function(){var e=this.dive();return this.backtrack(),e},t.prototype.dive=function(){if(this._path.length===0)return{done:!0,value:void 0};var e=ke(this._path),n=e.node,r=e.keys;if(ke(r)===K)return{done:!1,value:this.result()};var i=n.get(ke(r));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()},t.prototype.backtrack=function(){if(this._path.length!==0){var e=ke(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}},t.prototype.key=function(){return this.set._prefix+this._path.map(function(e){var n=e.keys;return ke(n)}).filter(function(e){return e!==K}).join("")},t.prototype.value=function(){return ke(this._path).node.get(K)},t.prototype.result=function(){switch(this._type){case an:return this.value();case sn:return this.key();default:return[this.key(),this.value()]}},t.prototype[Symbol.iterator]=function(){return this},t}(),ke=function(t){return t[t.length-1]},Lr=function(t,e,n){var r=new Map;if(e===void 0)return r;for(var i=e.length+1,o=i+n,s=new Uint8Array(o*i).fill(n+1),a=0;a<i;++a)s[a]=a;for(var l=1;l<o;++l)s[l*i]=l;return ln(t,e,n,r,s,1,i,""),r},ln=function(t,e,n,r,i,o,s,a){var l,u,c=o*s;try{e:for(var f=I(t.keys()),p=f.next();!p.done;p=f.next()){var d=p.value;if(d===K){var h=i[c-1];h<=n&&r.set(a,[t.get(d),h])}else{for(var _=o,g=0;g<d.length;++g,++_){for(var F=d[g],m=s*_,v=m-s,S=i[m],b=Math.max(0,_-n-1),A=Math.min(s-1,_+n),T=b;T<A;++T){var M=F!==e[T],V=i[v+T]+ +M,x=i[v+T+1]+1,O=i[m+T]+1,B=i[m+T+1]=Math.min(V,x,O);B<S&&(S=B)}if(S>n)continue e}ln(t.get(d),e,n,r,i,_,s,a+d)}}}catch(z){l={error:z}}finally{try{p&&!p.done&&(u=f.return)&&u.call(f)}finally{if(l)throw l.error}}},yt=function(){function t(e,n){e===void 0&&(e=new Map),n===void 0&&(n=""),this._size=void 0,this._tree=e,this._prefix=n}return t.prototype.atPrefix=function(e){var n,r;if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");var i=J(qe(this._tree,e.slice(this._prefix.length)),2),o=i[0],s=i[1];if(o===void 0){var a=J(Ft(s),2),l=a[0],u=a[1];try{for(var c=I(l.keys()),f=c.next();!f.done;f=c.next()){var p=f.value;if(p!==K&&p.startsWith(u)){var d=new Map;return d.set(p.slice(u.length),l.get(p)),new t(d,e)}}}catch(h){n={error:h}}finally{try{f&&!f.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}return new t(o,e)},t.prototype.clear=function(){this._size=void 0,this._tree.clear()},t.prototype.delete=function(e){return this._size=void 0,zr(this._tree,e)},t.prototype.entries=function(){return new vt(this,$r)},t.prototype.forEach=function(e){var n,r;try{for(var i=I(this),o=i.next();!o.done;o=i.next()){var s=J(o.value,2),a=s[0],l=s[1];e(a,l,this)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.fuzzyGet=function(e,n){return Lr(this._tree,e,n)},t.prototype.get=function(e){var n=_t(this._tree,e);return n!==void 0?n.get(K):void 0},t.prototype.has=function(e){var n=_t(this._tree,e);return n!==void 0&&n.has(K)},t.prototype.keys=function(){return new vt(this,sn)},t.prototype.set=function(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=wt(this._tree,e);return r.set(K,n),this},Object.defineProperty(t.prototype,"size",{get:function(){if(this._size)return this._size;this._size=0;for(var e=this.entries();!e.next().done;)this._size+=1;return this._size},enumerable:!1,configurable:!0}),t.prototype.update=function(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=wt(this._tree,e);return r.set(K,n(r.get(K))),this},t.prototype.fetch=function(e,n){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;var r=wt(this._tree,e),i=r.get(K);return i===void 0&&r.set(K,i=n()),i},t.prototype.values=function(){return new vt(this,an)},t.prototype[Symbol.iterator]=function(){return this.entries()},t.from=function(e){var n,r,i=new t;try{for(var o=I(e),s=o.next();!s.done;s=o.next()){var a=J(s.value,2),l=a[0],u=a[1];i.set(l,u)}}catch(c){n={error:c}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i},t.fromObject=function(e){return t.from(Object.entries(e))},t}(),qe=function(t,e,n){var r,i;if(n===void 0&&(n=[]),e.length===0||t==null)return[t,n];try{for(var o=I(t.keys()),s=o.next();!s.done;s=o.next()){var a=s.value;if(a!==K&&e.startsWith(a))return n.push([t,a]),qe(t.get(a),e.slice(a.length),n)}}catch(l){r={error:l}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return n.push([t,e]),qe(void 0,"",n)},_t=function(t,e){var n,r;if(e.length===0||t==null)return t;try{for(var i=I(t.keys()),o=i.next();!o.done;o=i.next()){var s=o.value;if(s!==K&&e.startsWith(s))return _t(t.get(s),e.slice(s.length))}}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},wt=function(t,e){var n,r,i=e.length;e:for(var o=0;t&&o<i;){try{for(var s=(n=void 0,I(t.keys())),a=s.next();!a.done;a=s.next()){var l=a.value;if(l!==K&&e[o]===l[0]){for(var u=Math.min(i-o,l.length),c=1;c<u&&e[o+c]===l[c];)++c;var f=t.get(l);if(c===l.length)t=f;else{var p=new Map;p.set(l.slice(c),f),t.set(e.slice(o,o+c),p),t.delete(l),t=p}o+=c;continue e}}}catch(h){n={error:h}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}var d=new Map;return t.set(e.slice(o),d),d}return t},zr=function(t,e){var n=J(qe(t,e),2),r=n[0],i=n[1];if(r!==void 0){if(r.delete(K),r.size===0)un(i);else if(r.size===1){var o=J(r.entries().next().value,2),s=o[0],a=o[1];cn(i,s,a)}}},un=function(t){if(t.length!==0){var e=J(Ft(t),2),n=e[0],r=e[1];if(n.delete(r),n.size===0)un(t.slice(0,-1));else if(n.size===1){var i=J(n.entries().next().value,2),o=i[0],s=i[1];o!==K&&cn(t.slice(0,-1),o,s)}}},cn=function(t,e,n){if(t.length!==0){var r=J(Ft(t),2),i=r[0],o=r[1];i.set(o+e,n),i.delete(o)}},Ft=function(t){return t[t.length-1]},He,xt="or",fn="and",Br="and_not",bt=function(){function t(e){if((e==null?void 0:e.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');this._options=H(H(H({},Et),e),{searchOptions:H(H({},pn),e.searchOptions||{}),autoSuggestOptions:H(H({},Wr),e.autoSuggestOptions||{})}),this._index=new yt,this._documentCount=0,this._documentIds=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this.addFields(this._options.fields)}return t.prototype.add=function(e){var n,r,i,o,s=this._options,a=s.extractField,l=s.tokenize,u=s.processTerm,c=s.fields,f=s.idField,p=a(e,f);if(p==null)throw new Error('MiniSearch: document does not have ID field "'.concat(f,'"'));var d=this.addDocumentId(p);this.saveStoredFields(d,e);try{for(var h=I(c),_=h.next();!_.done;_=h.next()){var g=_.value,F=a(e,g);if(F!=null){var m=l(F.toString(),g),v=this._fieldIds[g],S=new Set(m).size;this.addFieldLength(d,v,this._documentCount-1,S);try{for(var b=(i=void 0,I(m)),A=b.next();!A.done;A=b.next()){var T=A.value,M=u(T,g);M&&this.addTerm(v,d,M)}}catch(V){i={error:V}}finally{try{A&&!A.done&&(o=b.return)&&o.call(b)}finally{if(i)throw i.error}}}}}catch(V){n={error:V}}finally{try{_&&!_.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}},t.prototype.addAll=function(e){var n,r;try{for(var i=I(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.add(s)}}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.addAllAsync=function(e,n){var r=this;n===void 0&&(n={});var i=n.chunkSize,o=i===void 0?10:i,s={chunk:[],promise:Promise.resolve()},a=e.reduce(function(c,f,p){var d=c.chunk,h=c.promise;return d.push(f),(p+1)%o==0?{chunk:[],promise:h.then(function(){return new Promise(function(_){return setTimeout(_,0)})}).then(function(){return r.addAll(d)})}:{chunk:d,promise:h}},s),l=a.chunk,u=a.promise;return u.then(function(){return r.addAll(l)})},t.prototype.remove=function(e){var n,r,i,o,s,a,l=this._options,u=l.tokenize,c=l.processTerm,f=l.extractField,p=l.fields,d=l.idField,h=f(e,d);if(h==null)throw new Error('MiniSearch: document does not have ID field "'.concat(d,'"'));try{for(var _=I(this._documentIds),g=_.next();!g.done;g=_.next()){var F=J(g.value,2),m=F[0],v=F[1];if(h===v){try{for(var S=(i=void 0,I(p)),b=S.next();!b.done;b=S.next()){var A=b.value,T=f(e,A);if(T!=null){var M=u(T.toString(),A),V=this._fieldIds[A],x=new Set(M).size;this.removeFieldLength(m,V,this._documentCount,x);try{for(var O=(s=void 0,I(M)),B=O.next();!B.done;B=O.next()){var z=B.value,q=c(z,A);q&&this.removeTerm(V,m,q)}}catch(W){s={error:W}}finally{try{B&&!B.done&&(a=O.return)&&a.call(O)}finally{if(s)throw s.error}}}}}catch(W){i={error:W}}finally{try{b&&!b.done&&(o=S.return)&&o.call(S)}finally{if(i)throw i.error}}this._storedFields.delete(m),this._documentIds.delete(m),this._fieldLength.delete(m),this._documentCount-=1;return}}}catch(W){n={error:W}}finally{try{g&&!g.done&&(r=_.return)&&r.call(_)}finally{if(n)throw n.error}}throw new Error("MiniSearch: cannot remove document with ID ".concat(h,": it is not in the index"))},t.prototype.removeAll=function(e){var n,r;if(e)try{for(var i=I(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.remove(s)}}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new yt,this._documentCount=0,this._documentIds=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}},t.prototype.search=function(e,n){var r,i;n===void 0&&(n={});var o=this.executeQuery(e,n),s=[];try{for(var a=I(o),l=a.next();!l.done;l=a.next()){var u=J(l.value,2),c=u[0],f=u[1],p=f.score,d=f.terms,h=f.match,_=d.length,g={id:this._documentIds.get(c),score:p*_,terms:Object.keys(h),match:h};Object.assign(g,this._storedFields.get(c)),(n.filter==null||n.filter(g))&&s.push(g)}}catch(F){r={error:F}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return s.sort(gn),s},t.prototype.autoSuggest=function(e,n){var r,i,o,s;n===void 0&&(n={}),n=H(H({},this._options.autoSuggestOptions),n);var a=new Map;try{for(var l=I(this.search(e,n)),u=l.next();!u.done;u=l.next()){var c=u.value,f=c.score,p=c.terms,d=p.join(" "),h=a.get(d);h!=null?(h.score+=f,h.count+=1):a.set(d,{score:f,terms:p,count:1})}}catch(b){r={error:b}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}var _=[];try{for(var g=I(a),F=g.next();!F.done;F=g.next()){var m=J(F.value,2),h=m[0],v=m[1],f=v.score,p=v.terms,S=v.count;_.push({suggestion:h,terms:p,score:f/S})}}catch(b){o={error:b}}finally{try{F&&!F.done&&(s=g.return)&&s.call(g)}finally{if(o)throw o.error}}return _.sort(gn),_},Object.defineProperty(t.prototype,"documentCount",{get:function(){return this._documentCount},enumerable:!1,configurable:!0}),t.loadJSON=function(e,n){if(n==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return t.loadJS(JSON.parse(e),n)},t.getDefault=function(e){if(Et.hasOwnProperty(e))return Ct(Et,e);throw new Error('MiniSearch: unknown option "'.concat(e,'"'))},t.loadJS=function(e,n){var r,i,o,s,a=e.index,l=e.documentCount,u=e.nextId,c=e.documentIds,f=e.fieldIds,p=e.fieldLength,d=e.averageFieldLength,h=e.storedFields,_=e.serializationVersion;if(_!==1&&_!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");var g=new t(n);g._documentCount=l,g._nextId=u,g._documentIds=Ye(c),g._fieldIds=f,g._fieldLength=Ye(p),g._avgFieldLength=d,g._storedFields=Ye(h),g._index=new yt;try{for(var F=I(a),m=F.next();!m.done;m=F.next()){var v=J(m.value,2),S=v[0],b=v[1],A=new Map;try{for(var T=(o=void 0,I(Object.keys(b))),M=T.next();!M.done;M=T.next()){var V=M.value,x=b[V];_===1&&(x=x.ds),A.set(parseInt(V,10),Ye(x))}}catch(O){o={error:O}}finally{try{M&&!M.done&&(s=T.return)&&s.call(T)}finally{if(o)throw o.error}}g._index.set(S,A)}}catch(O){r={error:O}}finally{try{m&&!m.done&&(i=F.return)&&i.call(F)}finally{if(r)throw r.error}}return g},t.prototype.executeQuery=function(e,n){var r=this;if(n===void 0&&(n={}),typeof e!="string"){var i=H(H(H({},n),e),{queries:void 0}),o=e.queries.map(function(g){return r.executeQuery(g,i)});return this.combineResults(o,e.combineWith)}var s=this._options,a=s.tokenize,l=s.processTerm,u=s.searchOptions,c=H(H({tokenize:a,processTerm:l},u),n),f=c.tokenize,p=c.processTerm,d=f(e).map(function(g){return p(g)}).filter(function(g){return!!g}),h=d.map(Vr(c)),_=h.map(function(g){return r.executeQuerySpec(g,c)});return this.combineResults(_,c.combineWith)},t.prototype.executeQuerySpec=function(e,n){var r,i,o,s,a=H(H({},this._options.searchOptions),n),l=(a.fields||this._options.fields).reduce(function(se,R){var ee;return H(H({},se),(ee={},ee[R]=Ct(se,R)||1,ee))},a.boost||{}),u=a.boostDocument,c=a.weights,f=a.maxFuzzy,p=H(H({},pn.weights),c),d=p.fuzzy,h=p.prefix,_=this._index.get(e.term),g=this.termResults(e.term,e.term,1,_,l,u),F,m;if(e.prefix&&(F=this._index.atPrefix(e.term)),e.fuzzy){var v=e.fuzzy===!0?.2:e.fuzzy,S=v<1?Math.min(f,Math.round(e.term.length*v)):v;S&&(m=this._index.fuzzyGet(e.term,S))}if(F)try{for(var b=I(F),A=b.next();!A.done;A=b.next()){var T=J(A.value,2),M=T[0],V=T[1],x=M.length-e.term.length;if(!!x){m==null||m.delete(M);var O=h*M.length/(M.length+.3*x);this.termResults(e.term,M,O,V,l,u,g)}}}catch(se){r={error:se}}finally{try{A&&!A.done&&(i=b.return)&&i.call(b)}finally{if(r)throw r.error}}if(m)try{for(var B=I(m.keys()),z=B.next();!z.done;z=B.next()){var M=z.value,q=J(m.get(M),2),W=q[0],x=q[1];if(!!x){var O=d*M.length/(M.length+x);this.termResults(e.term,M,O,W,l,u,g)}}}catch(se){o={error:se}}finally{try{z&&!z.done&&(s=B.return)&&s.call(B)}finally{if(o)throw o.error}}return g},t.prototype.combineResults=function(e,n){if(n===void 0&&(n=xt),e.length===0)return new Map;var r=n.toLowerCase();return e.reduce(Rr[r])||new Map},t.prototype.toJSON=function(){var e,n,r,i,o=[];try{for(var s=I(this._index),a=s.next();!a.done;a=s.next()){var l=J(a.value,2),u=l[0],c=l[1],f={};try{for(var p=(r=void 0,I(c)),d=p.next();!d.done;d=p.next()){var h=J(d.value,2),_=h[0],g=h[1];f[_]=Object.fromEntries(g)}}catch(F){r={error:F}}finally{try{d&&!d.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}o.push([u,f])}}catch(F){e={error:F}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),index:o,serializationVersion:2}},t.prototype.termResults=function(e,n,r,i,o,s,a){var l,u,c,f,p;if(a===void 0&&(a=new Map),i==null)return a;try{for(var d=I(Object.keys(o)),h=d.next();!h.done;h=d.next()){var _=h.value,g=o[_],F=this._fieldIds[_],m=i.get(F);if(m!=null){var v=m.size,S=this._avgFieldLength[F];try{for(var b=(c=void 0,I(m.keys())),A=b.next();!A.done;A=b.next()){var T=A.value,M=s?s(this._documentIds.get(T),n):1;if(!!M){var V=m.get(T),x=this._fieldLength.get(T)[F],O=jr(V,v,this._documentCount,x,S),B=r*g*M*O,z=a.get(T);if(z){z.score+=B,Qr(z.terms,e);var q=Ct(z.match,n);q?q.push(_):z.match[n]=[_]}else a.set(T,{score:B,terms:[e],match:(p={},p[n]=[_],p)})}}}catch(W){c={error:W}}finally{try{A&&!A.done&&(f=b.return)&&f.call(b)}finally{if(c)throw c.error}}}}}catch(W){l={error:W}}finally{try{h&&!h.done&&(u=d.return)&&u.call(d)}finally{if(l)throw l.error}}return a},t.prototype.addTerm=function(e,n,r){var i=this._index.fetch(r,vn),o=i.get(e);if(o==null)o=new Map,o.set(n,1),i.set(e,o);else{var s=o.get(n);o.set(n,(s||0)+1)}},t.prototype.removeTerm=function(e,n,r){if(!this._index.has(r)){this.warnDocumentChanged(n,e,r);return}var i=this._index.fetch(r,vn),o=i.get(e);o==null||o.get(n)==null?this.warnDocumentChanged(n,e,r):o.get(n)<=1?o.size<=1?i.delete(e):o.delete(n):o.set(n,o.get(n)-1),this._index.get(r).size===0&&this._index.delete(r)},t.prototype.warnDocumentChanged=function(e,n,r){var i,o;if(!(console==null||console.warn==null))try{for(var s=I(Object.keys(this._fieldIds)),a=s.next();!a.done;a=s.next()){var l=a.value;if(this._fieldIds[l]===n){console.warn("MiniSearch: document with ID ".concat(this._documentIds.get(e),' has changed before removal: term "').concat(r,'" was not present in field "').concat(l,'". Removing a document after it has changed can corrupt the index!'));return}}}catch(u){i={error:u}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}},t.prototype.addDocumentId=function(e){var n=this._nextId;return this._documentIds.set(n,e),this._documentCount+=1,this._nextId+=1,n},t.prototype.addFields=function(e){for(var n=0;n<e.length;n++)this._fieldIds[e[n]]=n},t.prototype.addFieldLength=function(e,n,r,i){var o=this._fieldLength.get(e);o==null&&this._fieldLength.set(e,o=[]),o[n]=i;var s=this._avgFieldLength[n]||0,a=s*r+i;this._avgFieldLength[n]=a/(r+1)},t.prototype.removeFieldLength=function(e,n,r,i){var o=this._avgFieldLength[n]*r-i;this._avgFieldLength[n]=o/(r-1)},t.prototype.saveStoredFields=function(e,n){var r,i,o=this._options,s=o.storeFields,a=o.extractField;if(!(s==null||s.length===0)){var l=this._storedFields.get(e);l==null&&this._storedFields.set(e,l={});try{for(var u=I(s),c=u.next();!c.done;c=u.next()){var f=c.value,p=a(n,f);p!==void 0&&(l[f]=p)}}catch(d){r={error:d}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}},t}(),Ct=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0},Rr=(He={},He[xt]=function(t,e){var n,r;try{for(var i=I(e.keys()),o=i.next();!o.done;o=i.next()){var s=o.value,a=t.get(s);if(a==null)t.set(s,e.get(s));else{var l=e.get(s),u=l.score,c=l.terms,f=l.match;a.score=a.score+u,a.match=Object.assign(a.match,f),mn(a.terms,c)}}}catch(p){n={error:p}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return t},He[fn]=function(t,e){var n,r,i=new Map;try{for(var o=I(e.keys()),s=o.next();!s.done;s=o.next()){var a=s.value,l=t.get(a);if(l!=null){var u=e.get(a),c=u.score,f=u.terms,p=u.match;mn(l.terms,f),i.set(a,{score:l.score+c,terms:l.terms,match:Object.assign(l.match,p)})}}}catch(d){n={error:d}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i},He[Br]=function(t,e){var n,r;try{for(var i=I(e.keys()),o=i.next();!o.done;o=i.next()){var s=o.value;t.delete(s)}}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return t},He),dn=1.2,hn=.7,Hr=.5,jr=function(t,e,n,r,i){var o=Math.log(1+(n-e+.5)/(e+.5));return o*(Hr+t*(dn+1)/(t+dn*(1-hn+hn*r/i)))},Vr=function(t){return function(e,n,r){var i=typeof t.fuzzy=="function"?t.fuzzy(e,n,r):t.fuzzy||!1,o=typeof t.prefix=="function"?t.prefix(e,n,r):t.prefix===!0;return{term:e,fuzzy:i,prefix:o}}},Et={idField:"id",extractField:function(t,e){return t[e]},tokenize:function(t,e){return t.split(Ur)},processTerm:function(t,e){return t.toLowerCase()},fields:void 0,searchOptions:void 0,storeFields:[]},pn={combineWith:xt,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375}},Wr={combineWith:fn,prefix:function(t,e,n){return e===n.length-1}},Qr=function(t,e){t.includes(e)||t.push(e)},mn=function(t,e){var n,r;try{for(var i=I(e),o=i.next();!o.done;o=i.next()){var s=o.value;t.includes(s)||t.push(s)}}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},gn=function(t,e){var n=t.score,r=e.score;return r-n},vn=function(){return new Map},Ye=function(t){var e,n,r=new Map;try{for(var i=I(Object.keys(t)),o=i.next();!o.done;o=i.next()){var s=o.value;r.set(parseInt(s,10),t[s])}}catch(a){e={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},Ur=/[\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;var St=class{constructor(){this.handlers=new Map;this.disabled=[]}on(e,n,r){if(e.includes("@")||n.includes("@"))throw new Error("Invalid context/event name - Cannot contain @");this.handlers.set(`${e}@${n}`,r)}off(e,n){if(n)this.handlers.delete(`${e}@${n}`);else for(let[r]of this.handlers.entries())r.startsWith(`${e}@`)&&this.handlers.delete(r)}disable(e){this.enable(e),this.disabled.push(e)}enable(e){this.disabled=this.disabled.filter(n=>n!==e)}emit(e,...n){let r=[...this.handlers.entries()].filter(([i,o])=>!this.disabled.includes(i.split("@")[0]));for(let[i,o]of r)i.endsWith(`@${e}`)&&o(...n)}};var yn=/^"|"$|^'|'$/g,_n=/[\u4e00-\u9fa5]/,wn=100,Xe=180,Fn="suggestion-highlight omnisearch-highlight",k=new St,ye=`${app.vault.configDir}/plugins/omnisearch/searchIndex.json`,De=`${app.vault.configDir}/plugins/omnisearch/notesCache.json`,Ze=`${app.vault.configDir}/plugins/omnisearch/historyCache.json`,et={ToggleExcerpts:"toggle-excerpts"};var xn=!1;function At(t){xn=t}function bn(){return xn}var Cn=/[|\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u;var Bt=ae(require("obsidian"));var j=ae(require("obsidian"));function Q(){}function Jr(t,e){for(let n in e)t[n]=e[n];return t}function kt(t){return t()}function En(){return Object.create(null)}function le(t){t.forEach(kt)}function Dt(t){return typeof t=="function"}function U(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Sn(t){return Object.keys(t).length===0}function An(t,...e){if(t==null)return Q;let n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function kn(t,e,n){t.$$.on_destroy.push(An(e,n))}function Te(t,e,n,r){if(t){let i=Dn(t,e,n,r);return t[0](i)}}function Dn(t,e,n,r){return t[1]&&r?Jr(n.ctx.slice(),t[1](r(e))):n.ctx}function Ne(t,e,n,r){if(t[2]&&r){let i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){let o=[],s=Math.max(e.dirty.length,i.length);for(let a=0;a<s;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function Me(t,e,n,r,i,o){if(i){let s=Dn(e,n,r,o);t.p(s,i)}}function Ie(t){if(t.ctx.length>32){let e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}var Wi=new Set;var Tn=!1;function Kr(){Tn=!0}function Gr(){Tn=!1}function w(t,e){t.appendChild(e)}function N(t,e,n){t.insertBefore(e,n||null)}function D(t){t.parentNode.removeChild(t)}function tt(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function C(t){return document.createElement(t)}function Oe(t){return document.createTextNode(t)}function $(){return Oe(" ")}function de(){return Oe("")}function ie(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function E(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function qr(t){return Array.from(t.childNodes)}function Tt(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function Nt(t,e){t.value=e??""}function nt(t,e,n,r){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Mt(t,e,n){t.classList[n?"add":"remove"](e)}function Yr(t,e,{bubbles:n=!1,cancelable:r=!1}={}){let i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,r,e),i}var Qi=new Map;var je;function Ve(t){je=t}function It(){if(!je)throw new Error("Function called outside component initialization");return je}function _e(t){It().$$.on_mount.push(t)}function We(t){It().$$.on_destroy.push(t)}function Ot(){let t=It();return(e,n,{cancelable:r=!1}={})=>{let i=t.$$.callbacks[e];if(i){let o=Yr(e,n,{cancelable:r});return i.slice().forEach(s=>{s.call(t,o)}),!o.defaultPrevented}return!0}}function ue(t,e){let n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}var Qe=[];var rt=[],it=[],Nn=[],Mn=Promise.resolve(),Pt=!1;function In(){Pt||(Pt=!0,Mn.then(On))}function we(){return In(),Mn}function $t(t){it.push(t)}var Lt=new Set,ot=0;function On(){let t=je;do{for(;ot<Qe.length;){let e=Qe[ot];ot++,Ve(e),Xr(e.$$)}for(Ve(null),Qe.length=0,ot=0;rt.length;)rt.pop()();for(let e=0;e<it.length;e+=1){let n=it[e];Lt.has(n)||(Lt.add(n),n())}it.length=0}while(Qe.length);for(;Nn.length;)Nn.pop()();Pt=!1,Lt.clear(),Ve(t)}function Xr(t){if(t.fragment!==null){t.update(),le(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach($t)}}var st=new Set,Fe;function xe(){Fe={r:0,c:[],p:Fe}}function be(){Fe.r||le(Fe.c),Fe=Fe.p}function P(t,e){t&&t.i&&(st.delete(t),t.i(e))}function L(t,e,n,r){if(t&&t.o){if(st.has(t))return;st.add(t),Fe.c.push(()=>{st.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}var Ui=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var Ji=new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]);function ne(t){t&&t.c()}function te(t,e,n,r){let{fragment:i,on_mount:o,on_destroy:s,after_update:a}=t.$$;i&&i.m(e,n),r||$t(()=>{let l=o.map(kt).filter(Dt);s?s.push(...l):le(l),t.$$.on_mount=[]}),a.forEach($t)}function Y(t,e){let n=t.$$;n.fragment!==null&&(le(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Zr(t,e){t.$$.dirty[0]===-1&&(Qe.push(t),In(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function X(t,e,n,r,i,o,s,a=[-1]){let l=je;Ve(t);let u=t.$$={fragment:null,ctx:null,props:o,update:Q,not_equal:i,bound:En(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:En(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};s&&s(u.root);let c=!1;if(u.ctx=n?n(t,e.props||{},(f,p,...d)=>{let h=d.length?d[0]:p;return u.ctx&&i(u.ctx[f],u.ctx[f]=h)&&(!u.skip_bound&&u.bound[f]&&u.bound[f](h),c&&Zr(t,f)),p}):[],u.update(),c=!0,le(u.before_update),u.fragment=r?r(u.ctx):!1,e.target){if(e.hydrate){Kr();let f=qr(e.target);u.fragment&&u.fragment.l(f),f.forEach(D)}else u.fragment&&u.fragment.c();e.intro&&P(t.$$.fragment),te(t,e.target,e.anchor,e.customElement),Gr(),On()}Ve(l)}var ei;typeof HTMLElement=="function"&&(ei=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"})}connectedCallback(){let{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(kt).filter(Dt);for(let e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(t,e,n){this[t]=n}disconnectedCallback(){le(this.$$.on_disconnect)}$destroy(){Y(this,1),this.$destroy=Q}$on(t,e){let n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{let r=n.indexOf(e);r!==-1&&n.splice(r,1)}}$set(t){this.$$set&&!Sn(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});var G=class{$destroy(){Y(this,1),this.$destroy=Q}$on(e,n){let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{let i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Sn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var Pe=[];function Pn(t,e=Q){let n,r=new Set;function i(a){if(U(t,a)&&(t=a,n)){let l=!Pe.length;for(let u of r)u[1](),Pe.push(u,t);if(l){for(let u=0;u<Pe.length;u+=2)Pe[u][0](Pe[u+1]);Pe.length=0}}}function o(a){i(a(t))}function s(a,l=Q){let u=[a,l];return r.add(u),r.size===1&&(n=e(i)||Q),a(t),()=>{r.delete(u),r.size===0&&(n(),n=null)}}return{set:i,update:o,subscribe:s}}var Ce=Pn(!1),zt=class extends j.PluginSettingTab{constructor(e){super(app,e);this.plugin=e,Ce.subscribe(async n=>{y.showExcerpt=n,await oe(this.plugin)})}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Omnisearch settings"}),new j.Setting(e).setName("Behavior").setHeading(),new j.Setting(e).setName(`Respect Obsidian's "Excluded Files"`).setDesc(`Files that are in Obsidian's "Options > Files & Links > Excluded Files" list will be downranked in results.`).addToggle(s=>s.setValue(y.respectExcluded).onChange(async a=>{y.respectExcluded=a,await oe(this.plugin)}));let n=new DocumentFragment;n.createSpan({},s=>{s.innerHTML=`Normalize diacritics in search terms. Words like "br\xFBl\xE9e" or "\u017Elu\u0165ou\u010Dk\xFD" will be indexed as "brulee" and "zlutoucky".<br/>
        <strong>Needs a restart to fully take effect.</strong>`}),new j.Setting(e).setName("Ignore diacritics").setDesc(n).addToggle(s=>s.setValue(y.ignoreDiacritics).onChange(async a=>{y.ignoreDiacritics=a,await oe(this.plugin)}));let r=new DocumentFragment;r.createSpan({},s=>{s.innerHTML=`In addition to standard <code>md</code> files, Omnisearch can also index other plain text files.<br/>
      Add extensions separated by a space. Example: <code>txt org</code>.<br />
      <strong>Needs a restart to fully take effect.</strong>`}),new j.Setting(e).setName("Additional files to index").setDesc(r).addText(s=>{s.setValue(y.indexedFileTypes.join(" ")).setPlaceholder("Example: txt org").onChange(async a=>{y.indexedFileTypes=a.split(" "),await oe(this.plugin)})});let i=new DocumentFragment;i.createSpan({},s=>{s.innerHTML=`The search index is stored on disk, instead of being rebuilt at every startup.
        This results in faster loading times for bigger vaults and mobile devices.<br />
        <em>\u26A0\uFE0F Note: the index can become corrupted - if you notice any issue, disable and re-enable this option to clear the cache.</em><br/>
        <em>\u26A0\uFE0F Cache files in <code>.obsidian/plugins/omnisearch/</code> must not be synchronized.</em><br/>
        <strong>Needs a restart to fully take effect.</strong>
        `}),new j.Setting(e).setName("Store index in file").setDesc(i).addToggle(s=>s.setValue(y.storeIndexInFile).onChange(async a=>{try{await app.vault.adapter.remove(De)}catch(l){console.warn(l)}try{await app.vault.adapter.remove(ye)}catch(l){console.warn(l)}y.storeIndexInFile=a,await oe(this.plugin)})),new j.Setting(e).setName("User Interface").setHeading(),new j.Setting(e).setName("Show ribbon button").setDesc("Add a button on the sidebar to open the Vault search modal. Needs a restart to remove the button.").addToggle(s=>s.setValue(y.ribbonIcon).onChange(async a=>{y.ribbonIcon=a,await oe(this.plugin),a&&this.plugin.addRibbonButton()})),new j.Setting(e).setName("Show excerpt").setDesc("Shows the part of the note that matches the search. Disable this to only show filenames in results.").addToggle(s=>s.setValue(y.showExcerpt).onChange(async a=>{Ce.set(a)}));let o=new DocumentFragment;o.createSpan({},s=>{s.innerHTML=`Shows a button next to the search input, to create a note.
        Acts the same as the <code>shift \u21B5</code> shortcut, can be useful for mobile device users.`}),new j.Setting(e).setName('Show "Create note" button').setDesc(o).addToggle(s=>s.setValue(y.showCreateButton).onChange(async a=>{y.showCreateButton=a,await oe(this.plugin)})),new j.Setting(e).setName("Show indexing notices").setDesc("Shows a notice when indexing is done, usually at startup.").addToggle(s=>s.setValue(y.showIndexingNotices).onChange(async a=>{y.showIndexingNotices=a,await oe(this.plugin)})),new j.Setting(e).setName("Hide full path in results list").setDesc("In the search results, only show the note name, without the full path.").addToggle(s=>s.setValue(y.showShortName).onChange(async a=>{y.showShortName=a,await oe(this.plugin)})),new j.Setting(e).setName("Results weighting").setHeading(),new j.Setting(e).setName(`File name & declared aliases (default: ${$e.weightBasename})`).addSlider(s=>this.weightSlider(s,"weightBasename")),new j.Setting(e).setName(`Headings level 1 (default: ${$e.weightH1})`).addSlider(s=>this.weightSlider(s,"weightH1")),new j.Setting(e).setName(`Headings level 2 (default: ${$e.weightH2})`).addSlider(s=>this.weightSlider(s,"weightH2")),new j.Setting(e).setName(`Headings level 3 (default: ${$e.weightH3})`).addSlider(s=>this.weightSlider(s,"weightH3")),new j.Setting(e).setName("Shortcuts").setHeading(),new j.Setting(e).setName("Use [Ctrl/Cmd]+j/k to navigate up/down in the results, if Vim mode is enabled").addToggle(s=>s.setValue(y.CtrlJK).onChange(async a=>{y.CtrlJK=a,await oe(this.plugin)})),new j.Setting(e).setName("Use [Ctrl/Cmd]+n/p to navigate up/down in the results, if Vim mode is enabled").addToggle(s=>s.setValue(y.CtrlNP).onChange(async a=>{y.CtrlNP=a,await oe(this.plugin)}))}weightSlider(e,n){e.setLimits(1,3,.1),e.setValue(y[n]),e.setDynamicTooltip(),e.onChange(r=>{y[n]=r,oe(this.plugin)})}},$e={respectExcluded:!0,ignoreDiacritics:!0,indexedFileTypes:[],indexPDFs:!1,showIndexingNotices:!1,showShortName:!1,ribbonIcon:!0,showExcerpt:!0,showCreateButton:!1,weightBasename:2,weightH1:1.5,weightH2:1.3,weightH3:1.1,CtrlJK:!1,CtrlNP:!1,storeIndexInFile:!1,welcomeMessage:""},y=Object.assign({},$e);async function $n(t){y=Object.assign({},$e,await t.loadData()),Ce.set(y.showExcerpt)}async function oe(t){await t.saveData(y)}function he(t){return`<span class="${Fn}">${t}</span>`}function ti(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function Ue(t){return new Promise(e=>{setTimeout(e,t)})}function ni(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function pe(t){return t.length?new RegExp(t.map(e=>`(${ni(e)})`).join("|"),"gi"):/^$/g}function at(t,e){return t.headings?.filter(n=>n.level===e).map(n=>n.heading)??[]}function lt(t,e){return(t+e)%e}function ut(t,e){let n=e??-1;if(n>-1){let r=Math.max(0,n-wn),i=Math.min(t.length,n+Xe);t=(r>0?"\u2026":"")+t.slice(r,i).trim()+(i<t.length-1?"\u2026":"")}return ti(t)}function Ln(t){return t.replace(yn,"")}function Rt(t){return t.replace(/(\*|_)+(.+?)(\*|_)+/g,(e,n,r)=>r)}function zn(t){let e=t?.frontmatter?.aliases??[];return(Array.isArray(e)?e:e.toString().split(",")).map(n=>n&&n.trim()).filter(n=>!!n)}function Bn(t){let e=t?.frontmatter?.tags??[],n=(Array.isArray(e)?e:e.split(",")).map(i=>i&&i.trim()).filter(i=>!!i),r=(t?.tags??[]).map(i=>i.tag);return[...n,...r].map(i=>i[0]!=="#"?"#"+i:i)}function me(t){return t.normalize("NFD").replace(/\p{Diacritic}/gu,"")}function Rn(){return Bt.Platform.isMacOS?"\u2318":"ctrl"}function Ht(){return!1}function Hn(t){return Ht()&&t.endsWith(".pdf")||Ee(t)}function Ee(t){return ri().some(e=>t.endsWith(`.${e}`))}function ri(){return[...y.indexedFileTypes,"md"]}function jn(t){let e=t.split(".");return e[e.length-1]}var jt=ae(require("obsidian"));var ge={};function Vn(){ge={}}async function Wn(){if(y.storeIndexInFile&&await app.vault.adapter.exists(De))try{let t=await app.vault.adapter.read(De);ge=JSON.parse(t),console.log("Omnisearch - Notes cache loaded from the file")}catch(t){console.trace("Omnisearch - Could not load Notes cache from the file"),console.error(t)}ge||={}}function Z(t){return ge[t]}function Qn(){return Object.values(ge).filter(t=>t.doesNotExist)}function Vt(t,e){ge[t]=e}function Un(t){delete ge[t]}async function Je(t,e=!1){let n=pe(t.foundWords);n.exec(t.content);let r=n.lastIndex,i=!1;app.workspace.iterateAllLeaves(a=>{a.view instanceof jt.MarkdownView&&!e&&a.getViewState().state?.file===t.path&&a.getViewState()?.pinned&&(app.workspace.setActiveLeaf(a,{focus:!0}),i=!0)}),i||await app.workspace.openLinkText(t.path,"",e);let o=app.workspace.getActiveViewOfType(jt.MarkdownView);if(!o)throw new Error("OmniSearch - No active MarkdownView");let s=o.editor.offsetToPos(r);s.ch=0,o.editor.setCursor(s),o.editor.scrollIntoView({from:{line:s.line-10,ch:0},to:{line:s.line+10,ch:0}})}async function Jn(t,e=!1){try{let n;switch(app.vault.getConfig("newFileLocation")){case"current":n=(app.workspace.getActiveFile()?.parent.path??"")+"/";break;case"folder":n=app.vault.getConfig("newFileFolderPath")+"/";break;default:n="";break}await app.workspace.openLinkText(`${n}${t}.md`,"",e)}catch(n){throw n.message="OmniSearch - Could not create note: "+n.message,console.error(n),n}}function Kn(t,e){return(e.links??[]).map(n=>{let r=Wt(n.link);return app.metadataCache.getFirstLinkpathDest(r,t.path)?"":n.link}).filter(n=>!!n)}function Wt(t){return t.split(/[\^#]+/)[0]}async function Gn(){let t=JSON.stringify(ge);await app.vault.adapter.write(De,t),console.log("Omnisearch - Notes cache saved to the file")}function qn(t){let e=Z(t.path);return!e||e.mtime!==t.stat.mtime}var ct=ae(require("obsidian"));var Yn=ae(require("obsidian")),Qt=null;async function Xn(t){Qt=Qt??await(0,Yn.loadPdfJs)();let e=await app.vault.readBinary(t),n=await Qt.getDocument(e).promise,r=Array.from({length:n.numPages},async(i,o)=>(await(await n.getPage(o+1)).getTextContent()).items.map(l=>l.str).join(""));return(await Promise.all(r)).join("")}var Ke;async function Se(t){if(!(!(t instanceof ct.TFile)||!Hn(t.path))){Z(t.path)?.doesNotExist&&fe(t.path);try{let e=app.metadataCache.getFileCache(t);if(e){let i=Kn(t,e);for(let o of i.filter(s=>!Z(s)))ii(o,t.path)}if(Z(t.path))throw new Error(`${t.basename} is already indexed`);let n;t.path.endsWith(".pdf")?n=me(await Xn(t)):n=me(await app.vault.cachedRead(t));let r={basename:me(t.basename),content:n,path:t.path,mtime:t.stat.mtime,tags:Bn(e),aliases:zn(e).join(""),headings1:e?at(e,1).join(" "):"",headings2:e?at(e,2).join(" "):"",headings3:e?at(e,3).join(" "):""};ce.add(r),Ke=!0,Vt(r.path,r)}catch(e){console.trace("Error while indexing "+t.basename),console.error(e)}}}function ii(t,e){t=Wt(t);let n=t+(t.endsWith(".md")?"":".md");if(Z(n))return;let r={path:n,basename:t,mtime:0,content:"",aliases:"",headings1:"",headings2:"",headings3:"",doesNotExist:!0,parent:e};ce.add(r),Ke=!0,Vt(n,r)}function fe(t){if(!Ee(t)){console.info(`"${t}" is not an indexable file`);return}let e=Z(t);e?(ce.remove(e),Ke=!0,Un(t),Qn().filter(n=>n.parent===t).forEach(n=>{fe(n.path)})):console.warn(`not not found under path ${t}`)}var Ge=new Set;function Zn(t){Ge.add(t)}async function er(){y.showIndexingNotices&&Ge.size>0&&new ct.Notice(`Omnisearch - Reindexing ${Ge.size} notes`,2e3);for(let t of Ge)fe(t.path),await Se(t),await Ue(0);Ge.clear(),await Ut()}async function Ut(){if(y.storeIndexInFile&&ce&&Ke){let t=JSON.stringify(ce);await app.vault.adapter.write(ye,t),console.log("Omnisearch - Index saved on disk"),await Gn(),Ke=!1}}var ce,oi=t=>{let e=t.split(Cn),n=app.plugins.plugins["cm-chs-patch"];return n?e.flatMap(r=>_n.test(r)?n.cut(r):[r]):e};async function tr(){let t={tokenize:oi,processTerm:s=>(y.ignoreDiacritics?me(s):s).toLowerCase(),idField:"path",fields:["basename","aliases","content","headings1","headings2","headings3"],storeFields:["tags"]};if(y.storeIndexInFile&&await app.vault.adapter.exists(ye))try{let s=await app.vault.adapter.read(ye);ce=bt.loadJSON(s,t),console.log("Omnisearch - MiniSearch index loaded from the file"),await Wn()}catch(s){console.trace("Omnisearch - Could not load MiniSearch index from the file"),console.error(s)}ce||(ce=new bt(t),Vn());let e=new Date().getTime(),n=app.vault.getFiles().filter(s=>Ee(s.path)),r,i;y.storeIndexInFile?(r=n.filter(s=>qn(s)),i="modified notes"):(r=n,i="notes"),console.log(`Omnisearch - indexing ${r.length} ${i}`);let o=[];for(let s=0;s<r.length;++s){let a=r[s];Z(a.path)&&fe(a.path),o.push(Se(a)),s%10==0&&(await Ue(1),await Promise.all(o),o=[])}if(await Promise.all(o),r.length>0){let s=`Omnisearch - Indexed ${r.length} ${i} in ${new Date().getTime()-e}ms`;console.log(s),y.showIndexingNotices&&new Jt.Notice(s),await Ut(),await si()}}async function si(){if(Ht()){let t=new Date().getTime();console.warn("Omnisearch - Warnings on 'pdf.worker.min' are due to some issues while reading PDFs file and can usually be ignored.");let e=app.vault.getFiles().filter(i=>i.path.endsWith(".pdf")),n=[];for(let[i,o]of e.entries())Z(o.path)&&fe(o.path),n.push(Se(o)),i%10==0&&(await Ue(1),await Promise.all(n),n=[]);await Promise.all(n);let r=`Omnisearch - Indexed ${e.length} PDFs in ${new Date().getTime()-t}ms`;y.showIndexingNotices&&new Jt.Notice(r),console.log(r)}}async function ai(t){if(!t.segmentsToStr())return[];let e=ce.search(t.segmentsToStr(),{prefix:!0,fuzzy:i=>i.length>4?.2:!1,combineWith:"AND",boost:{basename:y.weightBasename,aliases:y.weightBasename,headings1:y.weightH1,headings2:y.weightH2,headings3:y.weightH3}});y.respectExcluded&&e.forEach(i=>{app.metadataCache.isUserIgnored&&app.metadataCache.isUserIgnored(i.id)&&(i.score/=3)});let n=t.getExactTerms();n.length&&(e=e.filter(i=>{let o=Z(i.id)?.path.toLowerCase()??"",s=Rt(Z(i.id)?.content??"").toLowerCase();return n.every(a=>s.includes(a)||o.includes(a))}));let r=t.exclusions;return r.length&&(e=e.filter(i=>{let o=Rt(Z(i.id)?.content??"").toLowerCase();return r.every(s=>!o.includes(s.value))})),e}function Kt(t,e){let n=null,r=[],i=0;for(;(n=e.exec(t))!==null&&!(++i>100);){let o=n[0];o&&r.push({match:o,offset:n.index})}return r}async function Le(t,e){let n=await ai(t);if(!n.length)return[];let r=t.segments.filter(i=>i.value.startsWith("#")).map(i=>i.value);if(e?.singleFilePath){let i=n.find(o=>o.id===e.singleFilePath);i?n=[i]:n=[]}else{n=n.slice(0,50);for(let i of r)for(let o of n)(o.tags??[]).includes(i)&&(o.score*=100)}return n.map(i=>{let o=Z(i.id);if(!o)throw new Error(`Note "${i.id}" not indexed`);t.segments.forEach(u=>{u.value=u.value.replace(/^#/,"")});let s=[...Object.keys(i.match),...t.segments.filter(u=>u.exact).map(u=>u.value),...r],a=Kt(o.content,pe(s));return rn({score:i.score,foundWords:s,matches:a},o)})}var Ar=ae(require("obsidian"));var ve=ae(require("obsidian"));var nr=ae(require("obsidian"));function li(t){let e,n,r,i,o,s,a,l=t[5].default,u=Te(l,t,t[4],null);return{c(){e=C("div"),n=C("div"),r=C("input"),i=$(),u&&u.c(),E(r,"type","text"),E(r,"class","prompt-input"),E(r,"placeholder",t[1]),E(r,"spellcheck","false"),E(n,"class","omnisearch-input-field"),E(e,"class","omnisearch-input-container")},m(c,f){N(c,e,f),w(e,n),w(n,r),Nt(r,t[0]),t[7](r),w(e,i),u&&u.m(e,null),o=!0,s||(a=[ie(r,"input",t[6]),ie(r,"input",t[3]),ie(r,"compositionstart",t[8]),ie(r,"compositionend",t[9])],s=!0)},p(c,[f]){(!o||f&2)&&E(r,"placeholder",c[1]),f&1&&r.value!==c[0]&&Nt(r,c[0]),u&&u.p&&(!o||f&16)&&Me(u,l,c,c[4],o?Ne(l,c[4],f,null):Ie(c[4]),null)},i(c){o||(P(u,c),o=!0)},o(c){L(u,c),o=!1},d(c){c&&D(e),t[7](null),u&&u.d(c),s=!1,le(a)}}}function ui(t,e,n){let{$$slots:r={},$$scope:i}=e,{value:o=""}=e,{placeholder:s=""}=e,a=Ot(),l;_e(async()=>{await we(),l.focus(),setTimeout(()=>{l.select()},0)});let u=(0,nr.debounce)(()=>{a("input",o)},100);function c(){o=this.value,n(0,o)}function f(h){rt[h?"unshift":"push"](()=>{l=h,n(2,l)})}let p=h=>At(!0),d=h=>At(!1);return t.$$set=h=>{"value"in h&&n(0,o=h.value),"placeholder"in h&&n(1,s=h.placeholder),"$$scope"in h&&n(4,i=h.$$scope)},[o,s,l,u,i,r,c,f,p,d]}var rr=class extends G{constructor(e){super();X(this,e,ui,li,U,{value:0,placeholder:1})}},ft=rr;function ci(t){let e,n,r,i,o=t[1].default,s=Te(o,t,t[0],null);return{c(){e=C("div"),s&&s.c(),E(e,"class","prompt-results")},m(a,l){N(a,e,l),s&&s.m(e,null),n=!0,r||(i=ie(e,"mousedown",fi),r=!0)},p(a,[l]){s&&s.p&&(!n||l&1)&&Me(s,o,a,a[0],n?Ne(o,a[0],l,null):Ie(a[0]),null)},i(a){n||(P(s,a),n=!0)},o(a){L(s,a),n=!1},d(a){a&&D(e),s&&s.d(a),r=!1,i()}}}var fi=t=>t.preventDefault();function di(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=o=>{"$$scope"in o&&n(0,i=o.$$scope)},[i,r]}var ir=class extends G{constructor(e){super();X(this,e,di,ci,U,{})}},dt=ir;function hi(t){let e;return{c(){e=C("span"),e.innerHTML='<svg viewBox="0 0 100 100" class="add-note-glyph" width="16" height="16"><path fill="currentColor" stroke="currentColor" d="M23.3,6.7c-3.7,0-6.7,3-6.7,6.7v73.3c0,3.7,3,6.7,6.7,6.7h28.4c-3.2-4.8-5.1-10.5-5.1-16.7c0-16.6,13.4-30,30-30 c2.3,0,4.5,0.3,6.7,0.8V31.7c0-0.9-0.3-1.7-1-2.4L60.7,7.6c-0.6-0.6-1.5-1-2.4-1L23.3,6.7z M56.7,13L77,33.3H60 c-1.8,0-3.3-1.5-3.3-3.3L56.7,13z M76.7,53.3c-12.9,0-23.3,10.4-23.3,23.3S63.8,100,76.7,100S100,89.6,100,76.7 S89.6,53.3,76.7,53.3z M76.7,63.3c1.8,0,3.3,1.5,3.3,3.3v6.7h6.7c1.8,0,3.3,1.5,3.3,3.3c0,1.8-1.5,3.3-3.3,3.3H80v6.7 c0,1.8-1.5,3.3-3.3,3.3c-1.8,0-3.3-1.5-3.3-3.3V80h-6.7c-1.8,0-3.3-1.5-3.3-3.3s1.5-3.3,3.3-3.3h6.7v-6.7 C73.3,64.8,74.8,63.3,76.7,63.3L76.7,63.3z"></path></svg>',E(e,"class","suggestion-flair"),E(e,"aria-label","Not created yet, select to create")},m(n,r){N(n,e,r)},p:Q,i:Q,o:Q,d(n){n&&D(e)}}}function pi(t){"use strict";return[]}var or=class extends G{constructor(e){super();X(this,e,pi,hi,U,{})}},sr=or;function ar(t){let e,n;return e=new sr({}),{c(){ne(e.$$.fragment)},m(r,i){te(e,r,i),n=!0},i(r){n||(P(e.$$.fragment,r),n=!0)},o(r){L(e.$$.fragment,r),n=!1},d(r){Y(e,r)}}}function mi(t){let e,n,r,i,o,s=t[2]&&ar(t),a=t[4].default,l=Te(a,t,t[3],null);return{c(){e=C("div"),s&&s.c(),n=$(),l&&l.c(),E(e,"data-result-id",t[0]),E(e,"class","suggestion-item omnisearch-result"),Mt(e,"is-selected",t[1])},m(u,c){N(u,e,c),s&&s.m(e,null),w(e,n),l&&l.m(e,null),r=!0,i||(o=[ie(e,"mousemove",t[5]),ie(e,"click",t[6]),ie(e,"auxclick",t[7])],i=!0)},p(u,[c]){u[2]?s?c&4&&P(s,1):(s=ar(u),s.c(),P(s,1),s.m(e,n)):s&&(xe(),L(s,1,1,()=>{s=null}),be()),l&&l.p&&(!r||c&8)&&Me(l,a,u,u[3],r?Ne(a,u[3],c,null):Ie(u[3]),null),(!r||c&1)&&E(e,"data-result-id",u[0]),(!r||c&2)&&Mt(e,"is-selected",u[1])},i(u){r||(P(s),P(l,u),r=!0)},o(u){L(s),L(l,u),r=!1},d(u){u&&D(e),s&&s.d(),l&&l.d(u),i=!1,le(o)}}}function gi(t,e,n){let{$$slots:r={},$$scope:i}=e,{id:o}=e,{selected:s=!1}=e,{glyph:a=!1}=e;function l(f){ue.call(this,t,f)}function u(f){ue.call(this,t,f)}function c(f){ue.call(this,t,f)}return t.$$set=f=>{"id"in f&&n(0,o=f.id),"selected"in f&&n(1,s=f.selected),"glyph"in f&&n(2,a=f.glyph),"$$scope"in f&&n(3,i=f.$$scope)},[o,s,a,i,r,l,u,c]}var lr=class extends G{constructor(e){super();X(this,e,gi,mi,U,{id:0,selected:1,glyph:2})}},ht=lr;function ur(t){let e,n=t[6].length+"",r,i,o=(t[6].length>1?"matches":"match")+"",s;return{c(){e=C("span"),r=Oe(n),i=Oe("\xA0"),s=Oe(o),E(e,"class","omnisearch-result__counter")},m(a,l){N(a,e,l),w(e,r),w(e,i),w(e,s)},p(a,l){l&64&&n!==(n=a[6].length+"")&&Tt(r,n),l&64&&o!==(o=(a[6].length>1?"matches":"match")+"")&&Tt(s,o)},d(a){a&&D(e)}}}function cr(t){let e,n=t[5].replace(t[2],he)+"";return{c(){e=C("div"),E(e,"class","omnisearch-result__body")},m(r,i){N(r,e,i),e.innerHTML=n},p(r,i){i&36&&n!==(n=r[5].replace(r[2],he)+"")&&(e.innerHTML=n)},d(r){r&&D(e)}}}function vi(t){let e,n,r=t[3].replace(t[2],he)+"",i,o,s,a=t[6].length>0&&ur(t),l=t[7]&&cr(t);return{c(){e=C("div"),n=C("span"),i=$(),a&&a.c(),o=$(),l&&l.c(),s=de(),E(n,"class","omnisearch-result__title")},m(u,c){N(u,e,c),w(e,n),n.innerHTML=r,w(e,i),a&&a.m(e,null),N(u,o,c),l&&l.m(u,c),N(u,s,c)},p(u,c){c&12&&r!==(r=u[3].replace(u[2],he)+"")&&(n.innerHTML=r),u[6].length>0?a?a.p(u,c):(a=ur(u),a.c(),a.m(e,null)):a&&(a.d(1),a=null),u[7]?l?l.p(u,c):(l=cr(u),l.c(),l.m(s.parentNode,s)):l&&(l.d(1),l=null)},d(u){u&&D(e),a&&a.d(),u&&D(o),l&&l.d(u),u&&D(s)}}}function yi(t){let e,n;return e=new ht({props:{id:t[1].path,selected:t[0],glyph:t[4],$$slots:{default:[vi]},$$scope:{ctx:t}}}),e.$on("mousemove",t[8]),e.$on("click",t[9]),{c(){ne(e.$$.fragment)},m(r,i){te(e,r,i),n=!0},p(r,[i]){let o={};i&2&&(o.id=r[1].path),i&1&&(o.selected=r[0]),i&16&&(o.glyph=r[4]),i&1260&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(P(e.$$.fragment,r),n=!0)},o(r){L(e.$$.fragment,r),n=!1},d(r){Y(e,r)}}}function _i(t,e,n){let r,i,o,s,a,l;kn(t,Ce,d=>n(7,l=d));let{selected:u=!1}=e,{note:c}=e;function f(d){ue.call(this,t,d)}function p(d){ue.call(this,t,d)}return t.$$set=d=>{"selected"in d&&n(0,u=d.selected),"note"in d&&n(1,c=d.note)},t.$$.update=()=>{if(t.$$.dirty&2){e:n(2,r=pe(c.foundWords))}if(t.$$.dirty&6){e:n(6,i=Kt(c.content,r))}if(t.$$.dirty&2){e:n(5,o=ut(c.content,c.matches[0]?.offset??-1))}if(t.$$.dirty&2){e:n(4,s=Z(c.path)?.doesNotExist)}if(t.$$.dirty&2){e:n(3,a=y.showShortName?c.basename:c.path)}},[u,c,r,a,s,o,i,l,f,p]}var fr=class extends G{constructor(e){super();X(this,e,_i,yi,U,{selected:0,note:1})}},dr=fr;function hr(t,e){e?e.offsets=typeof e.offsets=="undefined"?!0:e.offsets:e={offsets:!0,tokenize:!0},t||(t="");let n={text:[],offsets:[],exclude:{text:[]}};e.offsets&&(n.offsets=[]);let r={text:[]},i=[],o=/(\S+:'(?:[^'\\]|\\.)*')|(\S+:"(?:[^"\\]|\\.)*")|(-?"(?:[^"\\]|\\.)*")|(-?'(?:[^'\\]|\\.)*')|\S+|\S+:\S+/g,s,a=0;for(;(s=o.exec(t))!==null&&!(++a>100);){let u=s[0],c=u.indexOf(":");if(c!==-1){let f=u.slice(0,c),p=u.slice(c+1);p=(p+"").replace(/\\(.?)/g,function(d,h){switch(h){case"\\":return"\\";case"0":return"\0";case"":return"";default:return h}}),i.push({keyword:f,value:p,offsetStart:s.index,offsetEnd:s.index+u.length})}else{let f=!1;u[0]==="-"&&(f=!0,u=u.slice(1)),u=(u+"").replace(/\\(.?)/g,function(p,d){switch(d){case"\\":return"\\";case"0":return"\0";case"":return"";default:return d}}),f?r.text.push(u):i.push({text:u,offsetStart:s.index,offsetEnd:s.index+u.length})}}i.reverse();let l;for(;l=i.pop();)if(l.text)n.text.push(l.text),e.offsets&&n.offsets.push(l);else if(l.keyword){let u=l.keyword;e.keywords=e.keywords||[];let c=!1,f=!1;if(!/^-/.test(u))c=e.keywords.indexOf(u)!==-1;else if(u[0]==="-"){let d=u.slice(1);c=e.keywords.indexOf(d)!==-1,c&&(u=d,f=!0)}e.ranges=e.ranges||[];let p=e.ranges.indexOf(u)!==-1;if(c){e.offsets&&n.offsets.push({keyword:u,value:l.value,offsetStart:f?l.offsetStart+1:l.offsetStart,offsetEnd:l.offsetEnd});let d=l.value;if(d.length){let h=d.split(",");f?r[u]?r[u]instanceof Array?h.length>1?r[u]=r[u].concat(h):r[u].push(d):(r[u]=[r[u]],r[u].push(d)):h.length>1?r[u]=h:e.alwaysArray?r[u]=[d]:r[u]=d:n[u]?n[u]instanceof Array?h.length>1?n[u]=n[u].concat(h):n[u].push(d):(n[u]=[n[u]],n[u].push(d)):h.length>1?n[u]=h:e.alwaysArray?n[u]=[d]:n[u]=d}}else if(p){e.offsets&&n.offsets.push(l);let d=l.value,h=d.split("-");n[u]={},h.length===2?(n[u].from=h[0],n[u].to=h[1]):n[u].from=d}else{let d=l.keyword+":"+l.value;n.text.push(d),e.offsets&&n.offsets.push({text:d,offsetStart:l.offsetStart,offsetEnd:l.offsetEnd})}}return n.exclude=r,n}var Ae=class{constructor(e=""){this.segments=[];this.exclusions=[];y.ignoreDiacritics&&(e=me(e));let n=hr(e.toLowerCase(),{tokenize:!0});this.exclusions=n.exclude.text.map(this.formatToken).filter(r=>!!r.value),this.segments=n.text.map(this.formatToken)}segmentsToStr(){return this.segments.map(({value:e})=>e).join(" ")}getExactTerms(){return this.segments.filter(({exact:e})=>e).map(({value:e})=>e)}formatToken(e){let n=Ln(e);return{value:n,exact:n!==e}}};var re=[];async function pr(){if(await app.vault.adapter.exists(Ze))try{re=JSON.parse(await app.vault.adapter.read(Ze)),re=re.slice(0,100)}catch(t){console.trace("Could not load search history from the file"),console.error(t),re=[]}else re=[]}async function pt(){await app.vault.adapter.write(Ze,JSON.stringify(re))}function mr(t,e,n){let r=t.slice();return r[23]=e[n],r[25]=n,r}function wi(t){let e,n,r;return{c(){e=C("button"),e.textContent="Create note"},m(i,o){N(i,e,o),n||(r=ie(e,"click",t[4]),n=!0)},p:Q,d(i){i&&D(e),n=!1,r()}}}function Fi(t){let e,n=y.showCreateButton&&wi(t);return{c(){n&&n.c(),e=de()},m(r,i){n&&n.m(r,i),N(r,e,i)},p(r,i){y.showCreateButton&&n.p(r,i)},d(r){n&&n.d(r),r&&D(e)}}}function gr(t){let e,n;function r(...i){return t[7](t[25],...i)}return e=new dr({props:{selected:t[25]===t[0],note:t[23]}}),e.$on("mousemove",r),e.$on("click",t[3]),{c(){ne(e.$$.fragment)},m(i,o){te(e,i,o),n=!0},p(i,o){t=i;let s={};o&1&&(s.selected=t[25]===t[0]),o&4&&(s.note=t[23]),e.$set(s)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){L(e.$$.fragment,i),n=!1},d(i){Y(e,i)}}}function vr(t){let e;return{c(){e=C("div"),e.textContent="We found 0 result for your search here.",nt(e,"text-align","center")},m(n,r){N(n,e,r)},d(n){n&&D(e)}}}function xi(t){let e,n,r,i=t[2],o=[];for(let l=0;l<i.length;l+=1)o[l]=gr(mr(t,i,l));let s=l=>L(o[l],1,1,()=>{o[l]=null}),a=!t[2].length&&t[1]&&vr(t);return{c(){for(let l=0;l<o.length;l+=1)o[l].c();e=$(),a&&a.c(),n=de()},m(l,u){for(let c=0;c<o.length;c+=1)o[c].m(l,u);N(l,e,u),a&&a.m(l,u),N(l,n,u),r=!0},p(l,u){if(u&13){i=l[2];let c;for(c=0;c<i.length;c+=1){let f=mr(l,i,c);o[c]?(o[c].p(f,u),P(o[c],1)):(o[c]=gr(f),o[c].c(),P(o[c],1),o[c].m(e.parentNode,e))}for(xe(),c=i.length;c<o.length;c+=1)s(c);be()}!l[2].length&&l[1]?a||(a=vr(l),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i(l){if(!r){for(let u=0;u<i.length;u+=1)P(o[u]);r=!0}},o(l){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)L(o[u]);r=!1},d(l){tt(o,l),l&&D(e),a&&a.d(l),l&&D(n)}}}function bi(t){let e,n,r,i,o,s,a,l,u,c,f,p,d,h,_,g,F,m,v,S,b,A,T,M,V,x,O,B,z,q,W,se;return e=new ft({props:{value:t[1],placeholder:"Omnisearch - Vault",$$slots:{default:[Fi]},$$scope:{ctx:t}}}),e.$on("input",t[6]),r=new dt({props:{$$slots:{default:[xi]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment),n=$(),ne(r.$$.fragment),i=$(),o=C("div"),s=C("div"),s.innerHTML='<span class="prompt-instruction-command">\u2191\u2193</span><span>to navigate</span>',a=$(),l=C("div"),l.innerHTML=`<span class="prompt-instruction-command">alt \u2191\u2193</span> 
    <span>to cycle history</span>`,u=$(),c=C("div"),c.innerHTML='<span class="prompt-instruction-command">\u21B5</span><span>to open</span>',f=$(),p=C("div"),p.innerHTML=`<span class="prompt-instruction-command">\u21B9</span> 
    <span>to switch to In-File Search</span>`,d=$(),h=C("br"),_=$(),g=C("div"),F=C("span"),F.textContent=`${Rn()} \u21B5`,m=$(),v=C("span"),v.textContent="to open in a new pane",S=$(),b=C("div"),b.innerHTML=`<span class="prompt-instruction-command">shift \u21B5</span> 
    <span>to create</span>`,A=$(),T=C("div"),T.innerHTML=`<span class="prompt-instruction-command">ctrl shift \u21B5</span> 
    <span>to create in a new pane</span>`,M=$(),V=C("br"),x=$(),O=C("div"),O.innerHTML=`<span class="prompt-instruction-command">alt \u21B5</span> 
    <span>to insert a link</span>`,B=$(),z=C("div"),z.innerHTML=`<span class="prompt-instruction-command">ctrl+h</span> 
    <span>to toggle excerpt</span>`,q=$(),W=C("div"),W.innerHTML='<span class="prompt-instruction-command">esc</span><span>to close</span>',E(s,"class","prompt-instruction"),E(l,"class","prompt-instruction"),E(c,"class","prompt-instruction"),E(p,"class","prompt-instruction"),E(F,"class","prompt-instruction-command"),E(g,"class","prompt-instruction"),E(b,"class","prompt-instruction"),E(T,"class","prompt-instruction"),E(O,"class","prompt-instruction"),E(z,"class","prompt-instruction"),E(W,"class","prompt-instruction"),E(o,"class","prompt-instructions")},m(R,ee){te(e,R,ee),N(R,n,ee),te(r,R,ee),N(R,i,ee),N(R,o,ee),w(o,s),w(o,a),w(o,l),w(o,u),w(o,c),w(o,f),w(o,p),w(o,d),w(o,h),w(o,_),w(o,g),w(g,F),w(g,m),w(g,v),w(o,S),w(o,b),w(o,A),w(o,T),w(o,M),w(o,V),w(o,x),w(o,O),w(o,B),w(o,z),w(o,q),w(o,W),se=!0},p(R,[ee]){let gt={};ee&2&&(gt.value=R[1]),ee&67108864&&(gt.$$scope={dirty:ee,ctx:R}),e.$set(gt);let Zt={};ee&67108871&&(Zt.$$scope={dirty:ee,ctx:R}),r.$set(Zt)},i(R){se||(P(e.$$.fragment,R),P(r.$$.fragment,R),se=!0)},o(R){L(e.$$.fragment,R),L(r.$$.fragment,R),se=!1},d(R){Y(e,R),R&&D(n),Y(r,R),R&&D(i),R&&D(o)}}}function Ci(t,e,n){let r,{modal:i}=e,o=0,s=0,a,l=[],u;_e(async()=>{await er(),n(1,a=re[s]),k.enable("vault"),k.on("vault","enter",h),k.on("vault","create-note",v),k.on("vault","open-in-new-pane",_),k.on("vault","insert-link",S),k.on("vault","tab",b),k.on("vault","arrow-up",()=>A(-1)),k.on("vault","arrow-down",()=>A(1)),k.on("vault","prev-search-history",c),k.on("vault","next-search-history",f)}),We(()=>{k.disable("vault")});function c(){++s>=re.length&&(s=0),n(1,a=re[s])}function f(){--s<0&&(s=re.length?re.length-1:0),n(1,a=re[s])}async function p(){u=new Ae(a),n(2,l=(await Le(u)).sort((x,O)=>O.score-x.score)),n(0,o=0),await T()}function d(x){!r||(Je(r,x?.ctrlKey),i.close())}function h(){!r||(F(r),i.close())}function _(){!r||(F(r,!0),i.close())}function g(){re.unshift(a)}function F(x,O=!1){g(),pt(),Je(x,O)}async function m(x){await v()}async function v(x){try{await Jn(a,x?.newLeaf)}catch(O){new ve.Notice(O.message);return}i.close()}function S(){if(!r)return;let x=app.vault.getMarkdownFiles().find(W=>W.path===r.path),O=app.workspace.getActiveFile(),B=app.workspace.getActiveViewOfType(ve.MarkdownView);if(!B?.editor){new ve.Notice("Omnisearch - Error - No active editor",3e3);return}let z;x&&O?z=app.fileManager.generateMarkdownLink(x,O.path):z=`[[${r.basename}.${jn(r.path)}]]`;let q=B.editor.getCursor();B.editor.replaceRange(z,q,q),q.ch+=z.length,B.editor.setCursor(q),i.close()}function b(){if(!r.path.endsWith(".pdf"))if(g(),i.close(),r){let x=app.vault.getAbstractFileByPath(r.path);x&&x instanceof ve.TFile&&new ze(app,x,a).open()}else{let x=app.workspace.getActiveViewOfType(ve.MarkdownView);x&&new ze(app,x.file,a).open()}}function A(x){n(0,o=lt(o+x,l.length)),T()}async function T(){await we(),r&&document.querySelector(`[data-result-id="${r.path}"]`)?.scrollIntoView({behavior:"auto",block:"nearest"})}let M=x=>n(1,a=x.detail),V=(x,O)=>n(0,o=x);return t.$$set=x=>{"modal"in x&&n(5,i=x.modal)},t.$$.update=()=>{if(t.$$.dirty&2){e:a?p():n(2,l=[])}if(t.$$.dirty&5){e:r=l[o]}},[o,a,l,d,m,i,M,V]}var yr=class extends G{constructor(e){super();X(this,e,Ci,bi,U,{modal:5})}},_r=yr;var xr=ae(require("obsidian"));function Ei(t){let e,n=t[2].replace(t[3],he)+"";return{c(){e=C("div"),E(e,"class","omnisearch-result__body")},m(r,i){N(r,e,i),e.innerHTML=n},p(r,i){i&12&&n!==(n=r[2].replace(r[3],he)+"")&&(e.innerHTML=n)},d(r){r&&D(e)}}}function Si(t){let e,n;return e=new ht({props:{id:t[0].toString(),selected:t[1],$$slots:{default:[Ei]},$$scope:{ctx:t}}}),e.$on("mousemove",t[6]),e.$on("click",t[7]),{c(){ne(e.$$.fragment)},m(r,i){te(e,r,i),n=!0},p(r,[i]){let o={};i&1&&(o.id=r[0].toString()),i&2&&(o.selected=r[1]),i&268&&(o.$$scope={dirty:i,ctx:r}),e.$set(o)},i(r){n||(P(e.$$.fragment,r),n=!0)},o(r){L(e.$$.fragment,r),n=!1},d(r){Y(e,r)}}}function Ai(t,e,n){let r,i,{offset:o}=e,{note:s}=e,{index:a=0}=e,{selected:l=!1}=e;function u(f){ue.call(this,t,f)}function c(f){ue.call(this,t,f)}return t.$$set=f=>{"offset"in f&&n(4,o=f.offset),"note"in f&&n(5,s=f.note),"index"in f&&n(0,a=f.index),"selected"in f&&n(1,l=f.selected)},t.$$.update=()=>{if(t.$$.dirty&32){e:n(3,r=pe(s.foundWords))}if(t.$$.dirty&48){e:n(2,i=ut(s?.content??"",o))}},[a,l,i,r,o,s,u,c]}var wr=class extends G{constructor(e){super();X(this,e,Ai,Si,U,{offset:4,note:5,index:0,selected:1})}},Fr=wr;function br(t,e,n){let r=t.slice();return r[15]=e[n],r[17]=n,r}function ki(t){let e;return{c(){e=C("div"),e.textContent="We found 0 result for your search here.",nt(e,"text-align","center")},m(n,r){N(n,e,r)},p:Q,i:Q,o:Q,d(n){n&&D(e)}}}function Di(t){let e,n,r=t[3],i=[];for(let s=0;s<r.length;s+=1)i[s]=Cr(br(t,r,s));let o=s=>L(i[s],1,1,()=>{i[s]=null});return{c(){for(let s=0;s<i.length;s+=1)i[s].c();e=de()},m(s,a){for(let l=0;l<i.length;l+=1)i[l].m(s,a);N(s,e,a),n=!0},p(s,a){if(a&60){r=s[3];let l;for(l=0;l<r.length;l+=1){let u=br(s,r,l);i[l]?(i[l].p(u,a),P(i[l],1)):(i[l]=Cr(u),i[l].c(),P(i[l],1),i[l].m(e.parentNode,e))}for(xe(),l=r.length;l<i.length;l+=1)o(l);be()}},i(s){if(!n){for(let a=0;a<r.length;a+=1)P(i[a]);n=!0}},o(s){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)L(i[a]);n=!1},d(s){tt(i,s),s&&D(e)}}}function Cr(t){let e,n;function r(...i){return t[10](t[17],...i)}return e=new Fr({props:{offset:t[15],note:t[2],index:t[17],selected:t[17]===t[4]}}),e.$on("mousemove",r),e.$on("click",t[5]),{c(){ne(e.$$.fragment)},m(i,o){te(e,i,o),n=!0},p(i,o){t=i;let s={};o&8&&(s.offset=t[15]),o&4&&(s.note=t[2]),o&16&&(s.selected=t[17]===t[4]),e.$set(s)},i(i){n||(P(e.$$.fragment,i),n=!0)},o(i){L(e.$$.fragment,i),n=!1},d(i){Y(e,i)}}}function Ti(t){let e,n,r,i,o=[Di,ki],s=[];function a(l,u){return l[3].length&&l[2]?0:1}return e=a(t,-1),n=s[e]=o[e](t),{c(){n.c(),r=de()},m(l,u){s[e].m(l,u),N(l,r,u),i=!0},p(l,u){let c=e;e=a(l,u),e===c?s[e].p(l,u):(xe(),L(s[c],1,1,()=>{s[c]=null}),be(),n=s[e],n?n.p(l,u):(n=s[e]=o[e](l),n.c()),P(n,1),n.m(r.parentNode,r))},i(l){i||(P(n),i=!0)},o(l){L(n),i=!1},d(l){s[e].d(l),l&&D(r)}}}function Ni(t){let e;return{c(){e=C("span"),e.textContent="to close"},m(n,r){N(n,e,r)},d(n){n&&D(e)}}}function Mi(t){let e;return{c(){e=C("span"),e.textContent="to go back to Vault Search"},m(n,r){N(n,e,r)},d(n){n&&D(e)}}}function Ii(t){let e,n,r,i,o,s,a,l,u,c,f,p,d,h,_;e=new ft({props:{value:t[0],placeholder:"Omnisearch - File"}}),e.$on("input",t[9]),r=new dt({props:{$$slots:{default:[Ti]},$$scope:{ctx:t}}});function g(v,S){return v[1]?Mi:Ni}let F=g(t,-1),m=F(t);return{c(){ne(e.$$.fragment),n=$(),ne(r.$$.fragment),i=$(),o=C("div"),s=C("div"),s.innerHTML='<span class="prompt-instruction-command">\u2191\u2193</span><span>to navigate</span>',a=$(),l=C("div"),l.innerHTML='<span class="prompt-instruction-command">\u21B5</span><span>to open</span>',u=$(),c=C("div"),c.innerHTML=`<span class="prompt-instruction-command">\u21B9</span> 
    <span>to switch to Vault Search</span>`,f=$(),p=C("div"),d=C("span"),d.textContent="esc",h=$(),m.c(),E(s,"class","prompt-instruction"),E(l,"class","prompt-instruction"),E(c,"class","prompt-instruction"),E(d,"class","prompt-instruction-command"),E(p,"class","prompt-instruction"),E(o,"class","prompt-instructions")},m(v,S){te(e,v,S),N(v,n,S),te(r,v,S),N(v,i,S),N(v,o,S),w(o,s),w(o,a),w(o,l),w(o,u),w(o,c),w(o,f),w(o,p),w(p,d),w(p,h),m.m(p,null),_=!0},p(v,[S]){let b={};S&1&&(b.value=v[0]),e.$set(b);let A={};S&262172&&(A.$$scope={dirty:S,ctx:v}),r.$set(A),F!==(F=g(v,S))&&(m.d(1),m=F(v),m&&(m.c(),m.m(p,null)))},i(v){_||(P(e.$$.fragment,v),P(r.$$.fragment,v),_=!0)},o(v){L(e.$$.fragment,v),L(r.$$.fragment,v),_=!1},d(v){Y(e,v),v&&D(n),Y(r,v),v&&D(i),v&&D(o),m.d()}}}var Gt="";function Oi(t,e,n){let r=t.find(i=>i.offset>e);return r?t.filter(i=>i.offset>e&&i.offset<=r.offset+n):[]}function Pi(t,e,n){let{modal:r}=e,{parent:i=null}=e,{singleFilePath:o=""}=e,{searchQuery:s}=e,a=[],l=0,u,c;_e(()=>{Gt&&!s&&n(0,s=Gt),k.enable("infile"),k.on("infile","enter",h),k.on("infile","arrow-up",()=>p(-1)),k.on("infile","arrow-down",()=>p(1)),k.on("infile","tab",_)}),We(()=>{k.disable("infile")});function f(m){let v=[],S=-1,b=0;for(;;){let A=Oi(m,S,Xe);if(!A.length||(S=A.last().offset,v.push(A),++b>100))break}return v}function p(m){n(4,l=lt(l+m,a.length)),d()}async function d(){await we(),document.querySelector(`[data-result-id="${l}"]`)?.scrollIntoView({behavior:"auto",block:"nearest"})}async function h(m){if(u){await pt(),r.close(),i&&i.close(),await Je(u,m?.ctrlKey);let v=app.workspace.getActiveViewOfType(xr.MarkdownView);if(!v)throw new Error("OmniSearch - No active MarkdownView");let S=a[l]??0,b=v.editor.offsetToPos(S);b.ch=0,v.editor.setCursor(b),v.editor.scrollIntoView({from:{line:b.line-10,ch:0},to:{line:b.line+10,ch:0}})}}function _(){new Be(app).open(),r.close()}let g=m=>n(0,s=m.detail),F=(m,v)=>n(4,l=m);return t.$$set=m=>{"modal"in m&&n(6,r=m.modal),"parent"in m&&n(1,i=m.parent),"singleFilePath"in m&&n(7,o=m.singleFilePath),"searchQuery"in m&&n(0,s=m.searchQuery)},t.$$.update=()=>{if(t.$$.dirty&385){e:(async()=>{s&&(n(8,c=new Ae(s)),n(2,u=(await Le(c,{singleFilePath:o}))[0]??null),Gt=s),n(4,l=0),d()})()}if(t.$$.dirty&4){e:if(u){let m=f(u.matches);n(3,a=m.map(v=>Math.round((v.first().offset+v.last().offset)/2)))}}},[s,i,u,a,l,h,r,o,c,g,F]}var Er=class extends G{constructor(e){super();X(this,e,Pi,Ii,U,{modal:6,parent:1,singleFilePath:7,searchQuery:0})}},Sr=Er;var qt=class extends Ar.Modal{constructor(e){super(e);this.modalEl.replaceChildren(),this.modalEl.addClass("omnisearch-modal","prompt"),this.modalEl.tabIndex=-1,this.scope.register([],"ArrowDown",n=>{n.preventDefault(),k.emit("arrow-down")}),this.scope.register([],"ArrowUp",n=>{n.preventDefault(),k.emit("arrow-up")});for(let n of[{k:"j",dir:"down"},{k:"k",dir:"up"}])for(let r of["Ctrl","Meta"])this.scope.register([r],n.k,i=>{y.CtrlJK&&this.app.vault.getConfig("vimMode")&&(i.preventDefault(),k.emit("arrow-"+n.dir))});for(let n of[{k:"n",dir:"down"},{k:"p",dir:"up"}])for(let r of["Ctrl","Meta"])this.scope.register([r],n.k,i=>{y.CtrlNP&&this.app.vault.getConfig("vimMode")&&(i.preventDefault(),k.emit("arrow-"+n.dir))});this.scope.register(["Mod"],"Enter",n=>{n.preventDefault(),k.emit("open-in-new-pane")}),this.scope.register(["Alt"],"Enter",n=>{n.preventDefault(),k.emit("insert-link")}),this.scope.register(["Shift"],"Enter",n=>{n.preventDefault(),k.emit("create-note")}),this.scope.register(["Ctrl","Shift"],"Enter",n=>{n.preventDefault(),k.emit("create-note",{newLeaf:!0})}),this.scope.register([],"Enter",n=>{bn()||(n.preventDefault(),k.emit("enter"))}),this.scope.register([],"Tab",n=>{n.preventDefault(),k.emit("tab")}),this.scope.register(["Alt"],"ArrowDown",n=>{n.preventDefault(),k.emit("next-search-history")}),this.scope.register(["Alt"],"ArrowUp",n=>{n.preventDefault(),k.emit("prev-search-history")}),this.scope.register(["Ctrl"],"h",n=>{n.preventDefault(),k.emit(et.ToggleExcerpts)})}},Be=class extends qt{constructor(e){super(e);let n=new _r({target:this.modalEl,props:{modal:this}});this.onClose=()=>{n.$destroy()}}},ze=class extends qt{constructor(e,n,r="",i){super(e);let o=new Sr({target:this.modalEl,props:{modal:this,singleFilePath:n.path,parent:i,searchQuery:r}});i&&i.containerEl.toggleVisibility(!1),this.onClose=()=>{i&&i.containerEl.toggleVisibility(!0),o.$destroy()}}};function kr(t,e,n){window.PluginApi=window.PluginApi||{},window.PluginApi[t]=e,n.register(()=>{delete window.PluginApi[t]})}function $i(t){return t.map(e=>{let{score:n,path:r,basename:i,foundWords:o,matches:s}=e;return{score:n,path:r,basename:i,foundWords:o,matches:s.map(a=>({match:a.match,offset:a.offset}))}})}async function Li(t){let e=new Ae(t),n=await Le(e);return $i(n)}var Yt={search:Li};function zi(t){kr("omnisearch",Yt,t),app.plugins.plugins.omnisearch.api=Yt,t.register(()=>{delete app.plugins.plugins.omnisearch.api})}var Xt=class extends mt.Plugin{async onload(){await $n(this),await pr(),zi(this),y.ribbonIcon&&this.addRibbonButton(),this.addSettingTab(new zt(this)),k.disable("vault"),k.disable("infile"),k.on("global",et.ToggleExcerpts,()=>{Ce.set(!y.showExcerpt)}),this.addCommand({id:"show-modal",name:"Vault search",callback:()=>{new Be(app).open()}}),this.addCommand({id:"show-modal-infile",name:"In-file search",editorCallback:(e,n)=>{new ze(app,n.file).open()}}),app.workspace.onLayoutReady(async()=>{this.registerEvent(this.app.vault.on("create",e=>{Se(e)})),this.registerEvent(this.app.vault.on("delete",e=>{fe(e.path)})),this.registerEvent(this.app.vault.on("modify",async e=>{Zn(e)})),this.registerEvent(this.app.vault.on("rename",async(e,n)=>{e instanceof mt.TFile&&Ee(e.path)&&(fe(n),await Se(e))})),await tr()})}onunload(){}addRibbonButton(){this.addRibbonIcon("search","Omnisearch",e=>{new Be(app).open()})}};
