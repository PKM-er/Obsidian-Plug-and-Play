var ie=Object.defineProperty;var tt=Object.getOwnPropertyDescriptor;var ot=Object.getOwnPropertyNames;var it=Object.prototype.hasOwnProperty;var nt=(n,i)=>{for(var e in i)ie(n,e,{get:i[e],enumerable:!0})},rt=(n,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let o of ot(i))!it.call(n,o)&&o!==e&&ie(n,o,{get:()=>i[o],enumerable:!(t=tt(i,o))||t.enumerable});return n};var st=n=>rt(ie({},"__esModule",{value:!0}),n);var Ct={};nt(Ct,{default:()=>Y});module.exports=st(Ct);var ee=require("obsidian");var _=require("obsidian");var ne=Symbol.for("v1.to-use.peak-dev.org"),re=Symbol.for("v1.factory.to-use.peak-dev.org"),I,D,g=function(){return Object.defineProperties(n(),{this:{get(){if(I)return I;throw new TypeError("No current context")}},me:{value:ne},factory:{value:re}});function n(o){let r=new Map;r.prev=o;let s=Object.assign(o?l=>{let c=r.get(l);if(!c){for(let h=r.prev;h;h=h.prev)if(c=h.get(l)){c=Object.assign(Object.assign({},c),{s:c.s||1});break}c=c||{s:2,v:e},r.set(l,c)}let u,d,p;for(;;)switch(c.s){case 0:return I===s&&D&&D.push(l),c.v;case 1:if(u=c.d,!u||a(()=>u.k.every(h=>s(h)===u.c(h)))){c.s=0;break}c.v=u.f;case 2:c.s=4;try{i(r,l,0,a(d=c.v,l,p=[])),p.length&&(c.d={c:s,f:d,k:p});break}catch(h){c.s=3,c.v=h,c.d=null}case 3:throw c.v;case 4:throw new Error(`Factory ${String(c.v)} didn't resolve ${String(l)}`)}}:l=>g.this(l),{def(l,c){return i(r,l,2,c),s},set(l,c){return i(r,l,1,c),s},fork(l){let c=n(r);return l!=null?c(l):c}});return o?s.use=s:s;function a(l,c,u){let d=I,p=D;try{return I=s,D=u,l(c)}finally{I=d,D=p}}}function i(o,r,s,a){if(o.has(r)){let l=o.get(r);if(!l.s)throw new Error(`Already read: ${String(r)}`);l.s=s,l.v=a,l.d=null}else o.set(r,{s,v:a})}function e(o){if(typeof o[ne]=="function")return o[ne](o);if(t(o))return typeof o.prototype[re]=="function"?o.prototype[re]():new o;throw new ReferenceError(`No config for ${String(o)}`)}function t(o){return typeof o=="function"&&o.prototype!==void 0&&(Object.getPrototypeOf(o.prototype)!==Object.prototype||Object.getOwnPropertyNames(o.prototype).length>1||o.toString().startsWith("class"))}}();var Ee,M=(Ee=window.queueMicrotask)!=null?Ee:(n=>i=>n.then(i))(Promise.resolve());g.def(_.Plugin,()=>{throw new Error("Plugin not created yet")});var S=class extends _.Component{constructor(){super(...arguments);this.use=g.service(this)}};g.service=function(n){return g(U).addChild(n),g.this};g.plugin=function(n){let i=g.fork().set(_.Plugin,n).set(n.constructor,n);return n.addChild(i.use(U)),i};var U=class extends _.Component{constructor(){super(...arguments);this.children=new Set([this])}onload(){this.loaded=!0}onunload(){this.loaded=!1,this.children.clear()}addChild(e){return this.children.has(e)||(this.children.add(e),this.loaded?M(()=>super.addChild(e)):super.addChild(e)),e}};function z(n,i){n._loaded&&n.removeChild(i)}function Fe(n,i){let e=new _.Component;e.onload=()=>{z(n,e),i()},n.addChild(e)}function E(n,i){let e=Object.keys(i).map(t=>at(n,t,i[t]));return e.length===1?e[0]:function(){e.forEach(t=>t())}}function at(n,i,e){let t=n[i],o=n.hasOwnProperty(i),r=e(t);return t&&Object.setPrototypeOf(r,t),Object.setPrototypeOf(s,r),n[i]=s,a;function s(...l){return r===t&&n[i]===s&&a(),r.apply(this,l)}function a(){n[i]===s&&(o?n[i]=t:delete n[i]),r!==t&&(r=t,Object.setPrototypeOf(s,t||Function))}}var Me=require("obsidian");var Ce=require("obsidian");function q(n){let i=app.workspace;switch(n==null?void 0:n.getRoot()){case i.rootSplit:case i.floatingSplit:case i.leftSplit:case i.rightSplit:return!0;default:return!1}}var se=2,$t=Symbol.for(`v${se}.layout-storage-events.ophidian.peak-dev.org`);var Gt=`ophidian-layout-storage:v${se}:item-load`,Xt=`ophidian-layout-storage:v${se}:item-save`;var ae=require("obsidian");function ke(n,i=window,e="plugin-"+n.use(ae.Plugin).manifest.id.toLowerCase().replace(/[^_a-zA-Z0-9-]/,"-")){let t=i.document.querySelector("body > .app-container"),o=t.find(".status-bar")||t.createDiv("status-bar"),r=o.find(".status-bar-item."+e)||o.createDiv(`status-bar-item ${e.replace(/\./g," ")}`);return t=null,n.register(()=>M(()=>{r=Te(r),o=Te(o)})),n.use(ae.Plugin).register(()=>r&&r.detach()),r}function Te(n){return n&&!n.hasChildNodes()?(n.detach(),null):n}var Pe=require("obsidian");var $=class extends Pe.Component{constructor(e,t){super();this.use=e;this.container=t;this.win=this.container.win}[g.factory](){return new le(this.constructor)}static onload(e){}static onunload(e){}},le=class extends S{constructor(e){super();this.factory=e;this.instances=new Map;this.watching=!1;this.layoutReadyCallbacks=[]}onload(){var e,t;this.registerEvent(app.workspace.on("layout-change",()=>{app.workspace.layoutReady&&this.layoutReadyCallbacks.length&&(this.layoutReadyCallbacks.forEach(M),this.layoutReadyCallbacks=[])})),(t=(e=this.factory).onload)==null||t.call(e,this.use)}onLeafChange(e,t){return this.onLayoutReady(()=>e.call(t,app.workspace.activeLeaf)),app.workspace.on("active-leaf-change",o=>{app.workspace.layoutReady&&e.call(t,o)})}onLayoutReady(e){app.workspace.layoutReady?M(e):this.layoutReadyCallbacks.push(e)}onunload(){var e,t;(t=(e=this.factory).onunload)==null||t.call(e,this.use)}watch(){if(!this._loaded)Fe(this,()=>this.watch());else if(!this.watching){let{workspace:e}=app,t=this;this.watching=!0,this.registerEvent(e.on("window-open",o=>{this.onLayoutReady(()=>this.forContainer(o))})),this.register(E(e,{clearLayout(o){return async function(){try{return await o.call(this)}finally{t.onLayoutReady(()=>t.forAll())}}}})),this.onLayoutReady(()=>this.forAll())}return this}forWindow(e=(o=>(o=window.activeWindow)!=null?o:window)(),t=!0){let r=ct(e);if(r)return this.forContainer(r,t)}forContainer(e,t=!0){e=e.getContainer();let o=this.instances.get(e);return!o&&t&&(o=new this.factory(this.use,e),o&&(this.instances.set(e,o),this.addChild(o),e.component.addChild(o),o.register(()=>{z(this,o),z(e.component,o),this.instances.delete(e)}))),o}forDom(e,t=!0){return this.forWindow(ce(e),t)}forLeaf(e=app.workspace.activeLeaf,t=!0){if(q(e))return this.forContainer(e.getContainer(),t)}forView(e,t=!0){return this.forLeaf(e.leaf,t)}forAll(e=!0){return lt().map(t=>this.forContainer(t,e)).filter(t=>t)}};function lt(){return[app.workspace.rootSplit].concat(app.workspace.floatingSplit.children)}function ce(n){return n.win||(n.ownerDocument||n).defaultView||window}function ct(n){if(n===window)return app.workspace.rootSplit;let{floatingSplit:i}=app.workspace;if(i){for(let e of i.children)if(n===e.win)return e}}var Le=require("obsidian"),G=class extends S{onload(){let i=this,e=this.use(Le.Plugin);this.register(E(e,{loadCSS(t){return async function(){await t.call(this),i.triggerReparse(),this.register(()=>i.triggerReparse())}}}))}triggerReparse(){app.workspace.layoutReady&&app.workspace.trigger("parse-style-settings")}};function R(n,i,e,t,o){return n.on(i,e,t,o),()=>n.off(i,e,t,o)}var Ae={};function O(n,i,e=[],t={}){typeof e=="string"&&(e=[e]),typeof e=="object"&&e.key&&(e=[e]);let o=e.map(function(s){if(typeof s=="object")return s;let a=s.split("+");return{modifiers:a,key:a.pop()||"+"}});Object.assign(t,{id:n,name:i,hotkeys:o});let r=Symbol("cmd:"+n);return Ae[r]=t,r}function Se(n,i=n.constructor.prototype){Object.getOwnPropertySymbols(i).forEach(e=>{let t=Ae[e],o=i[e];t&&n.addCommand(Object.assign({},t,{checkCallback(r){let s=o.call(n);return r||typeof s!="function"?!!s:(s(),!0)}}))})}var ut=require("obsidian");var y=require("obsidian");function pt(n){for(var i=n.split(/([#.])/),e="",t="",o=[],r=0;r<i.length;r++){var s=i[r];s==="#"?t=i[++r]:s==="."?o.push(i[++r]):s.length&&(e=s)}return{tag:e||"div",id:t,className:o.join(" ")}}function Re(n,i){var e=pt(n),t=e.tag,o=e.id,r=e.className,s=i?document.createElementNS(i,t):document.createElement(t);return o&&(s.id=o),r&&(i?s.setAttribute("class",r):s.className=r),s}function T(n,i){var e=m(n),t=m(i);return i===t&&t.__redom_view&&(i=t.__redom_view),t.parentNode&&(Oe(i,t,e),e.removeChild(t)),i}function Oe(n,i,e){var t=i.__redom_lifecycle;if(_e(t)){i.__redom_lifecycle={};return}var o=e;for(i.__redom_mounted&&X(i,"onunmount");o;){var r=o.__redom_lifecycle||{};for(var s in t)r[s]&&(r[s]-=t[s]);_e(r)&&(o.__redom_lifecycle=null),o=o.parentNode}}function _e(n){if(n==null)return!0;for(var i in n)if(n[i])return!1;return!0}var dt=["onmount","onremount","onunmount"],ht=typeof window!="undefined"&&"ShadowRoot"in window;function k(n,i,e,t){var o=m(n),r=m(i);i===r&&r.__redom_view&&(i=r.__redom_view),i!==r&&(r.__redom_view=i);var s=r.__redom_mounted,a=r.parentNode;return s&&a!==o&&Oe(i,r,a),e!=null?t?o.replaceChild(r,m(e)):o.insertBefore(r,m(e)):o.appendChild(r),ft(i,r,o,a),i}function X(n,i){i==="onmount"||i==="onremount"?n.__redom_mounted=!0:i==="onunmount"&&(n.__redom_mounted=!1);var e=n.__redom_lifecycle;if(!!e){var t=n.__redom_view,o=0;t&&t[i]&&t[i]();for(var r in e)r&&o++;if(o)for(var s=n.firstChild;s;){var a=s.nextSibling;X(s,i),s=a}}}function ft(n,i,e,t){for(var o=i.__redom_lifecycle||(i.__redom_lifecycle={}),r=e===t,s=!1,a=0,l=dt;a<l.length;a+=1){var c=l[a];r||n!==i&&c in n&&(o[c]=(o[c]||0)+1),o[c]&&(s=!0)}if(!s){i.__redom_lifecycle={};return}var u=e,d=!1;for((r||u&&u.__redom_mounted)&&(X(i,r?"onremount":"onmount"),d=!0);u;){var p=u.parentNode,h=u.__redom_lifecycle||(u.__redom_lifecycle={});for(var v in o)h[v]=(h[v]||0)+o[v];if(d)break;(u.nodeType===Node.DOCUMENT_NODE||ht&&u instanceof ShadowRoot||p&&p.__redom_mounted)&&(X(u,r?"onremount":"onmount"),d=!0),u=p}}function mt(n,i,e){var t=m(n);if(typeof i=="object")for(var o in i)Ie(t,o,i[o]);else Ie(t,i,e)}function Ie(n,i,e){e==null?n.style[i]="":n.style[i]=e}var He="http://www.w3.org/1999/xlink";function Ne(n,i,e,t){var o=m(n),r=typeof i=="object";if(r)for(var s in i)Ne(o,s,i[s],t);else{var a=o instanceof SVGElement,l=typeof e=="function";if(i==="style"&&typeof e=="object")mt(o,e);else if(a&&l)o[i]=e;else if(i==="dataset")Be(o,e);else if(!a&&(i in o||l)&&i!=="list")o[i]=e;else{if(a&&i==="xlink"){Ve(o,e);return}t&&i==="class"&&(e=o.className+" "+e),e==null?o.removeAttribute(i):o.setAttribute(i,e)}}}function Ve(n,i,e){if(typeof i=="object")for(var t in i)Ve(n,t,i[t]);else e!=null?n.setAttributeNS(He,i,e):n.removeAttributeNS(He,i,e)}function Be(n,i,e){if(typeof i=="object")for(var t in i)Be(n,t,i[t]);else e!=null?n.dataset[i]=e:delete n.dataset[i]}function Ke(n){return document.createTextNode(n!=null?n:"")}function pe(n,i,e){for(var t=0,o=i;t<o.length;t+=1){var r=o[t];if(!(r!==0&&!r)){var s=typeof r;s==="function"?r(n):s==="string"||s==="number"?n.appendChild(Ke(r)):J(m(r))?k(n,r):r.length?pe(n,r,e):s==="object"&&Ne(n,r,null,e)}}}function je(n){return typeof n=="string"?N(n):m(n)}function m(n){return n.nodeType&&n||!n.el&&n||m(n.el)}function J(n){return n&&n.nodeType}var We={};function N(n){for(var i=[],e=arguments.length-1;e-- >0;)i[e]=arguments[e+1];var t,o=typeof n;if(o==="string")t=Ue(n).cloneNode(!1);else if(J(n))t=n.cloneNode(!1);else if(o==="function"){var r=n;t=new(Function.prototype.bind.apply(r,[null].concat(i)))}else throw new Error("At least one argument required");return pe(m(t),i,!0),t}var V=N;N.extend=function(i){for(var e=[],t=arguments.length-1;t-- >0;)e[t]=arguments[t+1];var o=Ue(i);return N.bind.apply(N,[this,o].concat(e))};function Ue(n){return We[n]||(We[n]=Re(n))}function ze(n){for(var i=[],e=arguments.length-1;e-- >0;)i[e]=arguments[e+1];for(var t=m(n),o=qe(n,i,t.firstChild);o;){var r=o.nextSibling;T(n,o),o=r}}function qe(n,i,e){for(var t=e,o=new Array(i.length),r=0;r<i.length;r++)o[r]=i[r]&&m(i[r]);for(var s=0;s<i.length;s++){var a=i[s];if(!!a){var l=o[s];if(l===t){t=t.nextSibling;continue}if(J(l)){var c=t&&t.nextSibling,u=a.__redom_index!=null,d=u&&c===o[s+1];k(n,a,t,d),d&&(t=c);continue}a.length!=null&&(t=qe(n,a,t))}}return t}var $e=function(i,e,t){this.View=i,this.initData=t,this.oldLookup={},this.lookup={},this.oldViews=[],this.views=[],e!=null&&(this.key=typeof e=="function"?e:vt(e))};$e.prototype.update=function(i,e){for(var t=this,o=t.View,r=t.key,s=t.initData,a=r!=null,l=this.lookup,c={},u=new Array(i.length),d=this.views,p=0;p<i.length;p++){var h=i[p],v=void 0;if(a){var x=r(h);v=l[x]||new o(s,h,p,i),c[x]=v,v.__redom_id=x}else v=d[p]||new o(s,h,p,i);v.update&&v.update(h,p,i,e);var te=m(v.el);te.__redom_view=v,u[p]=v}this.oldViews=d,this.views=u,this.oldLookup=l,this.lookup=c};function vt(n){return function(i){return i[n]}}function de(n,i,e,t){return new H(n,i,e,t)}var H=function(i,e,t,o){this.View=e,this.initData=o,this.views=[],this.pool=new $e(e,t,o),this.el=je(i),this.keySet=t!=null};H.prototype.update=function(i,e){i===void 0&&(i=[]);var t=this,o=t.keySet,r=this.views;this.pool.update(i,e);var s=this.pool,a=s.views,l=s.lookup;if(o)for(var c=0;c<r.length;c++){var u=r[c],d=u.__redom_id;l[d]==null&&(u.__redom_index=null,T(this,u))}for(var p=0;p<a.length;p++){var h=a[p];h.__redom_index=p}ze(this,a),o&&(this.lookup=l),this.views=a};H.extend=function(i,e,t,o){return H.bind(H,i,e,t,o)};de.extend=H.extend;var wt=function(i,e){this.el=Ke(""),this.visible=!1,this.view=null,this._placeholder=this.el,i instanceof Node?this._el=i:i.el instanceof Node?(this._el=i,this.view=i):this._View=i,this._initData=e};wt.prototype.update=function(i,e){var t=this._placeholder,o=this.el.parentNode;if(i){if(!this.visible)if(this._el)k(o,this._el,t),T(o,t),this.el=m(this._el),this.visible=i;else{var r=this._View,s=new r(this._initData);this.el=m(s),this.view=s,k(o,s,t),T(o,t)}this.view&&this.view.update&&this.view.update(e)}else if(this.visible){if(this._el){k(o,t,this._el),T(o,this._el),this.el=t,this.visible=i;return}k(o,t,this.view),T(o,this.view),this.el=t,this.view=null}this.visible=i};var gt=function(i,e,t){this.el=je(i),this.Views=e,this.initData=t};gt.prototype.update=function(i,e){if(i!==this.route){var t=this.Views,o=t[i];this.route=i,o&&(o instanceof Node||o.el instanceof Node)?this.view=o:this.view=o&&new o(this.initData,e),ze(this.el,[this.view])}this.view&&this.view.update&&this.view.update(e,i)};var Ge="http://www.w3.org/2000/svg",De={};function ue(n){for(var i=[],e=arguments.length-1;e-- >0;)i[e]=arguments[e+1];var t,o=typeof n;if(o==="string")t=Xe(n).cloneNode(!1);else if(J(n))t=n.cloneNode(!1);else if(o==="function"){var r=n;t=new(Function.prototype.bind.apply(r,[null].concat(i)))}else throw new Error("At least one argument required");return pe(m(t),i,!0),t}ue.extend=function(i){var e=Xe(i);return ue.bind(this,e)};ue.ns=Ge;function Xe(n){return De[n]||(De[n]=Re(n,Ge))}var C=require("obsidian");var w=require("obsidian");var F=class extends w.Menu{constructor(e,t=e instanceof w.App?e:e.app){var r;super(t);this.parent=e;this.app=t;this.match="";this.resetSearchOnTimeout=(0,w.debounce)(()=>{this.match=""},1500,!0);this.visible=!1;this.firstMove=!1;(r=this.setUseNativeMenu)==null||r.call(this,!1),e instanceof F&&e.setChildMenu(this),this.scope=new w.Scope,this.scope.register([],"ArrowUp",this.onArrowUp.bind(this)),this.scope.register([],"ArrowDown",this.onArrowDown.bind(this)),this.scope.register([],"Enter",this.onEnter.bind(this)),this.scope.register([],"Escape",this.onEscape.bind(this)),this.scope.register([],"ArrowLeft",this.onArrowLeft.bind(this)),this.scope.register([],"Home",this.onHome.bind(this)),this.scope.register([],"End",this.onEnd.bind(this)),this.scope.register([],"ArrowRight",this.onArrowRight.bind(this));let o=this;E(this.dom,{contains(s){return function(a){var c;return s.call(this,a)||((c=o.child)==null?void 0:c.dom.contains(a))}}}),this.dom.addClass("qe-popup-menu"),this.onMouseOver&&this.dom.removeEventListener("mouseover",this.onMouseOver)}onEscape(){return this.hide(),!1}onload(){this.scope.register(null,null,this.onKeyDown.bind(this)),super.onload(),this.visible=!0,this.showSelected(),this.firstMove=!0,this.register(yt(this.dom,"mouseover",".menu-item",(e,t)=>{!this.firstMove&&!t.hasClass("is-disabled")&&!this.child&&this.select(this.items.findIndex(o=>o.dom===t),!1),this.firstMove=!1}))}onunload(){this.visible=!1,super.onunload()}addItem(e){let t=new w.MenuItem(this);return this.items.push(t),e(t),this._loaded&&this.sort&&this.sort(),this}onKeyDown(e){let t=w.Keymap.getModifiers(e);if(e.key.length===1&&!e.isComposing&&(!t||t==="Shift")){let o=this.match+e.key;for(;o&&!this.searchFor(o);)o=o.substr(1);this.match=o,this.resetSearchOnTimeout()}return!1}searchFor(e){let t=e.split("").map(bt);return this.find(new RegExp("^"+t.join(""),"ui"))||this.find(new RegExp("^"+t.join(".*"),"ui"))||this.find(new RegExp(t.join(".*"),"ui"))}find(e){var o,r;let t=Math.min(0,this.selected);for(let s=this.items.length;s;++t,s--)if(!((o=this.items[t])!=null&&o.disabled)&&(r=this.items[t])!=null&&r.dom.textContent.match(e))return this.select(t),!0;return!1}onEnter(e){let t=this.items[this.selected];return t&&(t.handleEvent(e),this.child||this.hide()),!1}select(e,t=!0){this.match="",super.select(e),t&&this.showSelected()}showSelected(){var t;let e=(t=this.items[this.selected])==null?void 0:t.dom;if(e){let o=this.dom.getBoundingClientRect(),r=e.getBoundingClientRect();(r.top<o.top||r.bottom>o.bottom)&&e.scrollIntoView()}}unselect(){var e;(e=this.items[this.selected])==null||e.dom.removeClass("selected")}onEnd(e){return this.unselect(),this.selected=this.items.length,this.onArrowUp(e),this.selected===this.items.length&&(this.selected=-1),!1}onHome(e){return this.unselect(),this.selected=-1,this.onArrowDown(e),!1}onArrowLeft(){return this.rootMenu()!==this&&this.hide(),!1}onArrowRight(){return!1}hide(){return this.setChildMenu(),super.hide()}setChildMenu(e){var t;(t=this.child)==null||t.hide(),this.child=e}rootMenu(){return this.parent instanceof w.App?this:this.parent.rootMenu()}cascade(e,t,o,r=15,s=5){var ye,xe;let{left:a,top:l,bottom:c,width:u}=e.getBoundingClientRect(),d=a+(e.matchParent(".menu")?Math.min(150,u/3):0),p=(ye=window.activeWindow)!=null?ye:window,{innerHeight:h,innerWidth:v}=p,x={x:t?t.clientX-r:d,y:c-s};(xe=this.sort)==null||xe.call(this),p.document.body.appendChild(this.dom);let{offsetWidth:te,offsetHeight:oe}=this.dom,be=x.y+oe<h,Ye=l-s-oe>0,et=x.x+te<=v;return be||(Ye?x.y=l-s:x.y=c>h-(c-l)?l+s:h),et||(x.x=oe<c-s||be?v:d),this.showAtPosition(x),e.toggleClass("selected",!0),this.register(()=>{this.parent instanceof w.App?e.toggleClass("selected",!1):this.parent instanceof F&&this.parent.setChildMenu(),o&&o()}),this}};function bt(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function yt(n,i,e,t,o=!1){return n.on(i,e,t,o),()=>n.off(i,e,t,o)}function B(n){return i18next.t(`plugins.file-explorer.menu-opt-${n}`)}var P=class extends F{constructor(i,e){super(i);let{workspace:t}=this.app,o=this.app.internalPlugins.plugins["file-explorer"].enabled;e instanceof C.TFolder&&(this.addItem(r=>r.setTitle(B("new-note")).setIcon("create-new").onClick(async s=>{this.rootMenu().hide();let a=await this.app.fileManager.createNewMarkdownFile(e);a&&await this.app.workspace.getLeaf(C.Keymap.isModEvent(s)).openFile(a,{active:!0,state:{mode:"source"},eState:{rename:"all"}})})),this.addItem(r=>r.setTitle(B("new-folder")).setIcon("folder").setDisabled(!o).onClick(s=>{var a;o?(this.rootMenu().hide(),(a=this.withExplorer(e))==null||a.createAbstractFile("folder",e)):(new C.Notice("The File Explorer core plugin must be enabled to create new folders"),s.stopPropagation())})),this.addItem(r=>r.setTitle(B("set-attachment-folder")).setIcon("image-file").onClick(()=>{this.app.setAttachmentFolder(e)})),this.addSeparator()),this.addItem(r=>{r.setTitle(B("rename")).setIcon("pencil").onClick(s=>{this.app.fileManager.promptForFileRename(e)})}),this.addItem(r=>r.setTitle(B("delete")).setIcon("trash").onClick(()=>{e instanceof C.TFolder?this.app.fileManager.promptForFolderDeletion(e):e instanceof C.TFile&&this.app.fileManager.promptForFileDeletion(e)})),e instanceof C.TFolder&&o&&this.addItem(r=>r.setIcon("folder").setTitle(i18next.t("plugins.file-explorer.action-reveal-file")).onClick(()=>{this.rootMenu().hide(),this.withExplorer(e)})),t.trigger("file-menu",this,e,"quick-explorer")}onEnter(i){return this.rootMenu().hide(),super.onEnter(i)}withExplorer(i){let e=this.app.internalPlugins.plugins["file-explorer"];if(e.enabled)return e.instance.revealInFolder(i),this.app.workspace.getLeavesOfType("file-explorer")[0].view}};var f=require("obsidian");var L=require("obsidian"),fe={markdown:"document",image:"image-file",audio:"audio-file",pdf:"pdf-file"},xt={...fe,excalidraw:"excalidraw-icon"};function Q(n){var i;if(n instanceof L.TFolder)return"folder";if(n instanceof L.TFile){let e=app.viewRegistry.getTypeByExtension(n.extension);if(e)return(i=xt[e])!=null?i:"document"}}function Z(n){return app.vault.getAbstractFileByPath(Et(n))}function Et(n){return`${n.path}/${n.name}.md`}var he=new Intl.Collator(void 0,{usage:"sort",sensitivity:"base",numeric:!0}).compare;function me(n,i=app.vault.getConfig("showUnsupportedFiles")){let{children:e}=n,t=Z(n),o=e.slice().sort((a,l)=>he(a.name,l.name)),r=o.filter(a=>a instanceof L.TFolder),s=o.filter(a=>a instanceof L.TFile&&a!==t&&(i||Q(a)));return r.sort((a,l)=>he(a.name,l.name)),s.sort((a,l)=>he(a.basename,l.basename)),{folderNote:t,folders:r,files:s}}function Je(n,i){let{folderNote:e,folders:t,files:o}=me(n,!1);return(e?[e]:[]).concat(t,o)}function Qe(n,i,e){let t=new Set;for(;(n==null?void 0:n.parent)&&!t.has(n);){t.add(n);let o=Je(n.parent,!1),r=o.indexOf(n);if(r===-1)return;for(e?r+=i:r=i<0?0:o.length-1,n=n.parent;r>=0&&r<o.length;){if(n=o[r],n instanceof L.TFile)return n;n instanceof L.TFolder?(o=Je(n,!1),r=i>0?0:o.length-1):r+=i}}}var b=!0,A=class extends F{constructor(e,t,o,r){super(e);this.parent=e;this.folder=t;this.selectedFile=o;this.crumb=r;this.parentFolder=this.parent instanceof A?this.parent.folder:null;this.fileCount=e=>e instanceof f.TFolder?e.children.map(this.fileCount).reduce((t,o)=>t+o,0):Q(e)?1:0;this.refreshFiles=(0,f.debounce)(()=>this.loadFiles(this.folder,this.currentFile()),100,!0);this.showPopover=(0,f.debounce)(()=>{var e;this.hidePopover(),b&&this.maybeHover((e=this.currentItem())==null?void 0:e.dom,t=>this.app.workspace.trigger("link-hover",this,ce(this.dom).document.body,t.path,""))},50,!0);this.onItemHover=(e,t)=>{b||this.maybeHover(t,o=>this.app.workspace.trigger("hover-link",{event:e,source:K,hoverParent:this,targetEl:t,linktext:o.path}))};this.onItemClick=(e,t)=>{if(e.type==="auxclick"&&!f.Keymap.isModEvent(e))return;let o=this.fileForDom(t);if(!!o&&!this.onClickFile(o,t,e))return e.stopPropagation(),e.preventDefault(),!1};this.onItemMenu=(e,t)=>{let o=this.fileForDom(t);if(o){let r=this.itemForPath(o.path);r>=0&&this.selected!=r&&this.select(r),new P(this,o).cascade(t,e),e.stopPropagation()}};this.loadFiles(t,o),this.scope.register([],"Tab",this.togglePreviewMode.bind(this)),this.scope.register(["Mod"],"Enter",this.onEnter.bind(this)),this.scope.register(["Alt"],"Enter",this.onKeyboardContextMenu.bind(this)),this.scope.register([],"\\",this.onKeyboardContextMenu.bind(this)),this.scope.register([],"ContextMenu",this.onKeyboardContextMenu.bind(this)),this.scope.register([],"F2",this.doRename.bind(this)),this.scope.register(["Shift"],"F2",this.doMove.bind(this)),this.scope.register([],"PageUp",this.doScroll.bind(this,-1,!1)),this.scope.register([],"PageDown",this.doScroll.bind(this,1,!1)),this.scope.register(["Mod"],"Home",this.doScroll.bind(this,0,!0)),this.scope.register(["Mod"],"End",this.doScroll.bind(this,1,!0));let{dom:s}=this,a=".menu-item[data-file-path]";s.on("click",a,this.onItemClick,!0),s.on("auxclick",a,this.onItemClick,!0),s.on("contextmenu",a,this.onItemMenu),s.on("mouseover",a,this.onItemHover),s.on("mousedown",a,c=>{c.stopPropagation()},!0),s.on("dragstart",a,(c,u)=>{ve(this.app,u.dataset.filePath,c)}),this.register(()=>{b&&this.parent instanceof A&&this.parent.showPopover()});let l=this;E(this.dom,{contains(c){return function(u){var p;return c.call(this,u)||((p=l._popover)==null?void 0:p.hoverEl.contains(u))}}})}onArrowLeft(){var e;return super.onArrowLeft(),this.rootMenu()===this&&this.openBreadcrumb((e=this.crumb)==null?void 0:e.prev()),!1}onKeyboardContextMenu(e){var r;if(e.code==="ContextMenu"){let s=function(a){if(a.code==="ContextMenu")return a.preventDefault(),a.view.removeEventListener("keyup",s,{capture:!0}),!1};e.view.addEventListener("keyup",s,{capture:!0})}let t=(r=this.items[this.selected])==null?void 0:r.dom,o=t&&this.fileForDom(t);return o&&new P(this,o).cascade(t),!1}doScroll(e,t,o){var a,l;let r=(a=this.hoverPopover)==null?void 0:a.hoverEl,s=r==null?void 0:r.find((l=this.hoverPopover)!=null&&l.rootSplit?'[data-mode="preview"] .markdown-preview-view, [data-mode="source"] .cm-scroller':".markdown-preview-view");if(s){s.style.scrollBehavior=t?"auto":"smooth";let c=s.scrollTop,u=(t?0:s.scrollTop)+e*(t?s.scrollHeight:s.clientHeight);s.scrollTop=u,t||(u>=s.scrollHeight?this.onArrowDown(o):u<0&&(c>0?s.scrollTop=0:this.onArrowUp(o)))}else b?e>0?this.onArrowDown(o):this.onArrowUp(o):(b=!0,this.showPopover());return!1}doRename(){let e=this.currentFile();return this.rootMenu().hide(),e&&this.app.fileManager.promptForFileRename(e),!1}doMove(){let e=this.app.internalPlugins.plugins["file-explorer"];if(!e.enabled)return new f.Notice("File explorer core plugin must be enabled to move files or folders"),!1;this.rootMenu().hide();let t=e.instance.moveFileModal;return t.setCurrentFile(this.currentFile()),t.open(),!1}currentItem(){return this.items[this.selected]}currentFile(){var e;return this.fileForDom((e=this.currentItem())==null?void 0:e.dom)}fileForDom(e){let{filePath:t}=e==null?void 0:e.dataset;if(t)return this.app.vault.getAbstractFileByPath(t)}itemForPath(e){return this.items.findIndex(t=>t.dom.dataset.filePath===e)}openBreadcrumb(e){if(e&&this.rootMenu()===this)return this.hide(),e.open(),!1}onArrowRight(){var t;let e=this.currentFile();if(e instanceof f.TFolder)e!==this.selectedFile?this.onClickFile(e,this.currentItem().dom):this.openBreadcrumb((t=this.crumb)==null?void 0:t.next());else if(e instanceof f.TFile){let o=this.hoverPopover;o&&o.rootSplit&&this.app.workspace.iterateLeaves(r=>{var s;return r.view instanceof f.FileView&&r.view.file===e&&(o.togglePin(!0),this.onEscape(),r.view instanceof f.MarkdownView?r.setViewState({type:r.view.getViewType(),state:{file:e.path,mode:"source"}}).then(()=>this.app.workspace.setActiveLeaf(r,!1,!0)):((s=this.dom.ownerDocument.activeElement)==null||s.blur(),this.app.workspace.setActiveLeaf(r,!1,!0))),!0},o.rootSplit)}return!1}loadFiles(e,t){this.dom.empty(),this.items=[];let{folderNote:o,folders:r,files:s}=me(e);o&&this.addFile(o),r.length&&(o&&this.addSeparator(),r.map(this.addFile,this)),s.length&&((r.length||o)&&this.addSeparator(),s.map(this.addFile,this)),this.select(t?this.itemForPath(t.path):0)}addFile(e){let t=Q(e);this.addItem(o=>{if(o.setTitle(e.name),o.dom.dataset.filePath=e.path,o.dom.setAttr("draggable","true"),o.dom.addClass(e instanceof f.TFolder?"is-qe-folder":"is-qe-file"),t&&o.setIcon(t),e instanceof f.TFile)o.setTitle(e.basename),e.extension!=="md"&&o.dom.createDiv({text:e.extension,cls:["nav-file-tag","qe-extension"]});else if(e!==this.folder.parent){let r=this.fileCount(e);r&&o.dom.createDiv({text:""+r,cls:"nav-file-tag qe-file-count"})}o.onClick(r=>this.onClickFile(e,o.dom,r))})}togglePreviewMode(){return(b=!b)?this.showPopover():this.hidePopover(),!1}onload(){super.onload(),this.register(R(this.dom.ownerDocument.body,"mousedown",".hover-popover",(e,t)=>{var o,r,s;((o=this.hoverPopover)==null?void 0:o.hoverEl)===t&&((s=(r=this.hoverPopover).togglePin)==null||s.call(r,!0))},{capture:!0})),this.registerEvent(this.app.vault.on("create",e=>{this.folder===e.parent&&this.refreshFiles()})),this.registerEvent(this.app.vault.on("rename",(e,t)=>{if(this.folder===e.parent){let o=this.itemForPath(t)>=0?e:this.currentFile();this.loadFiles(this.folder,o)}else this.removeItemForPath(t)})),this.registerEvent(this.app.vault.on("delete",e=>this.removeItemForPath(e.path))),b&&this.selected!=-1&&this.showPopover()}removeItemForPath(e){let t=this.itemForPath(e);if(t<0)return;let o=this.items[t];this.selected>t&&(this.selected-=1),o.dom.detach(),this.items.remove(o)}onEscape(){return super.onEscape(),this.parent instanceof F&&this.parent.onEscape(),!1}hide(){return this.hidePopover(),super.hide()}setChildMenu(e){super.setChildMenu(e),b&&this.canShowPopover()&&this.showPopover()}select(e,t=!0){let o=this.selected;super.select(e,t),o!==this.selected&&(b?this.showPopover():this.hidePopover())}hidePopover(){this.hoverPopover=null}canShowPopover(){return!this.child&&this.visible}maybeHover(e,t){if(!this.canShowPopover())return;let o=this.fileForDom(e);o instanceof f.TFolder&&(o=Z(o)),o instanceof f.TFile&&fe[this.app.viewRegistry.getTypeByExtension(o.extension)]&&t(o)}get hoverPopover(){return this._popover}set hoverPopover(e){var r;let t=this._popover;if(e===t)return;t&&e!==t&&(this._popover=null,t.onHover=!1,t.isPinned||t.hide()),e&&!this.canShowPopover()&&(e.onHover=!1,e.hide(),e=null),this._popover=e;let o=e==null?void 0:e.targetEl;if(o&&o===o.ownerDocument.body&&(o.removeEventListener("mouseover",e.onMouseIn),o.removeEventListener("mouseout",e.onMouseOut)),b&&e&&this.currentItem()){(r=e.togglePin)==null||r.call(e,!1),Promise.resolve().then(()=>{var a,l;return(l=(a=e.abortController)==null?void 0:a.unload)==null?void 0:l.call(a)});let s=()=>{let a=e.hoverEl;if(!a.parentElement)return;let l=this.dom.getBoundingClientRect(),c=this.currentItem().dom.getBoundingClientRect(),u=a.offsetParent||this.dom.ownerDocument.documentElement,d=a.offsetHeight,p=Math.min(l.right+2,u.clientWidth-a.offsetWidth),h=Math.min(Math.max(0,c.top-d/8),u.clientHeight-d);p<l.left+l.width/3&&l.left>a.offsetWidth&&(p=l.left-a.offsetWidth),e.position({x:p,y:h}),a.style.top=h+"px",a.style.left=p+"px"};"onShowCallback"in e?E(e,{onShowCallback(a){return()=>(e.hoverEl.win.requestAnimationFrame(s),a==null?void 0:a.call(e))}}):this.dom.win.requestAnimationFrame(s)}}onClickFile(e,t,o){var s;this.hidePopover();let r=this.itemForPath(e.path);if(r>=0&&this.selected!=r&&this.select(r),e instanceof f.TFile){if(this.app.viewRegistry.isExtensionRegistered(e.extension))return this.app.workspace.openLinkText(e.path,"",o&&f.Keymap.isModEvent(o)),this.rootMenu().hide(),o==null||o.stopPropagation(),!0;new f.Notice(`.${e.extension} files cannot be opened in Obsidian; Use "Open in Default App" to open them externally`)}else e===this.selectedFile?this.openBreadcrumb((s=this.crumb)==null?void 0:s.next()):new A(this,e,Z(e)).cascade(t,o instanceof MouseEvent?o:void 0)}};var K="quick-explorer:folder-menu";function ve(n,i,e){if(!i||i==="/")return;let t=n.vault.getAbstractFileByPath(i);if(!t)return;let{dragManager:o}=n,r=t instanceof y.TFile?o.dragFile(e,t):o.dragFolder(e,t);o.onDragStart(e,r)}var ge=class{constructor(){this.nameEl=V("span",{class:"explorable-name"});this.sepEl=V("span",{class:"explorable-separator"});this.el=V("span",{draggable:!0,class:"explorable titlebar-button"},this.nameEl,this.sepEl)}update(i,e,t){var a,l;let{file:o,path:r}=i,s=o.name||r;this.sepEl.toggle(e<t.length-1),this.nameEl.textContent=s,this.el.dataset.parentPath=(l=(a=o.parent)==null?void 0:a.path)!=null?l:"/",this.el.dataset.filePath=r}},W=class extends ${constructor(){super(...arguments);this.lastFile=null;this.lastPath=null;this.el=V("div",{id:"quick-explorer"});this.list=de(this.el,ge);this.isOpen=0;this.app=app}onload(){var t,o;if(this.register(()=>{var r;return(r=this.lastMenu)==null?void 0:r.hide()}),(0,y.requireApiVersion)("0.15.6")){let r=this.win.document.body.find(".titlebar .titlebar-inner .titlebar-text"),s=r==null?void 0:r.cloneNode(!0);s&&(s.addClass("qe-replacement"),s.textContent=(o=(t=app.getAppTitle)==null?void 0:t.call(app))!=null?o:this.win.document.title,r.replaceWith(s),this.register(()=>s.replaceWith(r)))}if((0,y.requireApiVersion)("0.16.0")&&this.win.document.body.addClass("obsidian-themepocalypse"),(0,y.requireApiVersion)("0.16.3")){let r=".view-header .view-header-breadcrumb, .view-header .view-header-title-parent";this.register(R(this.win.document.body,"click",r,(s,a)=>{var l;if(!s.target.matches(".view-header-breadcrumb-separator, .is-exploring"))return(l=we(a))==null||l.open(s),s.stopPropagation(),!1},{capture:!0})),this.register(R(this.win.document.body,"contextmenu",".view-header .view-header-breadcrumb",(s,a)=>{var c,u;if(s.target.matches(".view-header-breadcrumb-separator"))return;let l=(u=(c=we(a))==null?void 0:c.file)==null?void 0:u.parent;if(l)return new P(this.app,l).cascade(a,s),s.stopImmediatePropagation(),!1},{capture:!0}))}let e=this.win.document.body.find("body:not(.is-hidden-frameless) .titlebar .titlebar-button-container.mod-left")||ke(this,this.win,"left-region");if(this.register(()=>T(e,this)),k(e,this),this.isCurrent())this.update(this.app.workspace.getActiveFile());else{let r=app.workspace.getMostRecentLeaf(this.container),s=(r==null?void 0:r.view)instanceof y.FileView&&r.view.file;s&&this.update(s)}this.registerEvent(this.app.vault.on("rename",this.onFileChange,this)),this.registerEvent(this.app.vault.on("delete",this.onFileDelete,this)),this.el.on("contextmenu",".explorable",(r,s)=>{let{filePath:a}=s.dataset,l=this.app.vault.getAbstractFileByPath(a);new P(this.app,l).cascade(s,r)}),this.el.on("click",".explorable",(r,s)=>{this.folderMenu(s,r.isTrusted&&r)}),this.el.on("dragstart",".explorable",(r,s)=>{ve(this.app,s.dataset.filePath,r)})}onFileChange(e){e===this.lastFile&&this.update(e)}onFileDelete(e){e===this.lastFile&&this.update()}visibleCrumb(e){let t=Ft(this,e);if(!e.isShown()){let o=app.workspace.getActiveViewOfType(y.FileView).containerEl.find(".view-header .view-header-title-parent");if(o!=null&&o.isShown()){let{file:r}=t;t=we(o),t=t.peers.find(s=>s.file===r)||t}}return t}folderMenu(e=this.el.firstElementChild,t){var o;return this.lastMenu=(o=this.visibleCrumb(e))==null?void 0:o.open(t)}browseVault(){return this.folderMenu()}browseCurrent(){return this.folderMenu(this.el.lastElementChild)}browseFile(e){if(e===this.lastFile)return this.browseCurrent();let t,o=this.el.firstElementChild,r=[],s=e.path.split("/").filter(a=>a);for(;o&&s.length;){if(r.push(s[0]),o.dataset.filePath!==r.join("/")){t=this.folderMenu(o),r.pop();break}s.shift(),o=o.nextElementSibling}for(;t&&s.length;){r.push(s.shift());let a=t.itemForPath(r.join("/"));if(a==-1)break;t.select(a),(s.length||e instanceof y.TFolder)&&(t.onArrowRight(),t=t.child)}return t}isCurrent(){return this===this.use(W).forLeaf(app.workspace.activeLeaf)}update(e){if(this.isOpen||(e!=null||(e=this.app.vault.getAbstractFileByPath("/")),e==this.lastFile&&e.path==this.lastPath))return;this.lastFile=e,this.lastPath=e.path;let t=Ze(e);this.list.update(t)}},j=class{constructor(i,e,t,o,r){this.peers=i;this.el=e;this.file=t;this.onOpen=o;this.onClose=r;i.push(this)}next(){let i=this.peers.indexOf(this);if(i>-1)return this.peers[i+1]}prev(){let i=this.peers.indexOf(this);if(i>0)return this.peers[i-1]}open(i){var t;let e=this.file;if(e){(t=this.onOpen)==null||t.call(this,this);let o=this.file.parent||e;return new A(app,o,e,this).cascade(this.el,i&&i.isTrusted&&i,()=>this.onClose(this))}}};function we(n){var u;let i=[],e=n.matchParent(".workspace-leaf"),t,o;app.workspace.iterateAllLeaves(d=>d.containerEl===e&&(t=d)&&!0);let r=(u=t==null?void 0:t.view)==null?void 0:u.file,s=Ze(r),a=n.matchParent(".view-header-title-parent");o=new j(i,a,s.shift().file,l,c);for(let d of a.findAll(".view-header-breadcrumb"))new j(i,d,s.shift().file,l,c),d===n&&(o=i[i.length-1]);return o;function l(d){d.el.toggleClass("is-exploring",!0)}function c(d){d.el.toggleClass("is-exploring",!1)}}function Ft(n,i){let e=[],t=i.matchParent("#quick-explorer"),o;for(let a of t.findAll(".explorable"))new j(e,a,app.vault.getAbstractFileByPath(a.dataset.filePath),r,s),a===i&&(o=e[e.length-1]);return o;function r(){n.isOpen++}function s(){n.isOpen--,n.lastMenu=null,!n.isOpen&&n.isCurrent()&&n.update(app.workspace.getActiveFile())}}function Ze(n){let i=[];for(;n;)i.unshift({file:n,path:n.path}),n=n.parent;return i.length>1&&i.shift(),i}var Y=class extends ee.Plugin{constructor(){super(...arguments);this.use=g.plugin(this);this.explorers=this.use(W).watch();this.ss=this.use(G)}updateCurrent(e=this.app.workspace.activeLeaf,t=this.app.workspace.getActiveFile()){q(e)&&this.explorers.forLeaf(e).update(t)}onload(){this.app.workspace.registerHoverLinkSource(K,{display:"Quick Explorer",defaultMod:!0}),this.registerEvent(this.app.workspace.on("file-open",()=>this.updateCurrent())),this.registerEvent(this.explorers.onLeafChange(e=>this.updateCurrent(e))),this.addCommand({id:"browse-vault",name:"Browse vault",callback:()=>{var e;(e=this.explorers.forWindow())==null||e.browseVault()}}),this.addCommand({id:"browse-current",name:"Browse current folder",callback:()=>{var e;(e=this.explorers.forWindow())==null||e.browseCurrent()}}),Se(this),this.registerEvent(this.app.workspace.on("file-menu",(e,t,o)=>{let r;if(o!=="quick-explorer"&&e.addItem(s=>{var a;s.setIcon("folder").setTitle("Show in Quick Explorer").onClick(l=>{var c;(c=this.explorers.forDom(r.dom))==null||c.browseFile(t)}),r=s,(a=r.setSection)==null||a.call(r,"view")}),r){let s=i18next.t("plugins.file-explorer.action-reveal-file"),a=e.items.findIndex(l=>{var c;return((c=l.titleEl)==null?void 0:c.textContent)===s});a>-1&&(e.sections||e.dom.insertBefore(r.dom,e.items[a].dom),e.items.remove(r),e.items.splice(a,0,r))}})),Object.defineProperty(ee.TFolder.prototype,"basename",{get(){return this.name},configurable:!0})}[O("go-next","Go to next file in folder")](){return this.goFile(1,!0)}[O("go-prev","Go to previous file in folder")](){return this.goFile(-1,!0)}[O("go-first","Go to first file in folder")](){return this.goFile(-1,!1)}[O("go-last","Go to last file in folder")](){return this.goFile(1,!1)}goFile(e,t){return()=>{let o=app.workspace.getActiveFile(),r=o&&Qe(o,e,t);r&&r!==o&&app.workspace.activeLeaf.openFile(r)}}onunload(){this.app.workspace.unregisterHoverLinkSource(K)}};
