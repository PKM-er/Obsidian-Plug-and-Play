var X=Object.defineProperty;var He=Object.getOwnPropertyDescriptor;var De=Object.getOwnPropertyNames;var Re=Object.prototype.hasOwnProperty;var Ke=(r,o)=>{for(var e in o)X(r,e,{get:o[e],enumerable:!0})},Ne=(r,o,e,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of De(o))!Re.call(r,i)&&i!==e&&X(r,i,{get:()=>o[i],enumerable:!(t=He(o,i))||t.enumerable});return r};var Oe=r=>Ne(X({},"__esModule",{value:!0}),r);var tt={};Ke(tt,{default:()=>q});module.exports=Oe(tt);var $=require("obsidian");var S=require("obsidian");var G=Symbol.for("v1.to-use.peak-dev.org"),J=Symbol.for("v1.factory.to-use.peak-dev.org"),k,I,g=function(){return Object.defineProperties(r(),{this:{get(){if(k)return k;throw new TypeError("No current context")}},me:{value:G},factory:{value:J}});function r(i){let n=new Map;n.prev=i;let s=Object.assign(i?c=>{let l=n.get(c);if(!l){for(let f=n.prev;f;f=f.prev)if(l=f.get(c)){l=Object.assign(Object.assign({},l),{s:l.s||1});break}l=l||{s:2,v:e},n.set(c,l)}let u,p,h;for(;;)switch(l.s){case 0:return k===s&&I&&I.push(c),l.v;case 1:if(u=l.d,!u||a(()=>u.k.every(f=>s(f)===u.c(f)))){l.s=0;break}l.v=u.f;case 2:l.s=4;try{o(n,c,0,a(p=l.v,c,h=[])),h.length&&(l.d={c:s,f:p,k:h});break}catch(f){l.s=3,l.v=f,l.d=null}case 3:throw l.v;case 4:throw new Error(`Factory ${String(l.v)} didn't resolve ${String(c)}`)}}:c=>g.this(c),{def(c,l){return o(n,c,2,l),s},set(c,l){return o(n,c,1,l),s},fork(c){let l=r(n);return c!=null?l(c):l}});return i?s.use=s:s;function a(c,l,u){let p=k,h=I;try{return k=s,I=u,c(l)}finally{k=p,I=h}}}function o(i,n,s,a){if(i.has(n)){let c=i.get(n);if(!c.s)throw new Error(`Already read: ${String(n)}`);c.s=s,c.v=a,c.d=null}else i.set(n,{s,v:a})}function e(i){if(typeof i[G]=="function")return i[G](i);if(t(i))return typeof i.prototype[J]=="function"?i.prototype[J]():new i;throw new ReferenceError(`No config for ${String(i)}`)}function t(i){return typeof i=="function"&&i.prototype!==void 0&&(Object.getPrototypeOf(i.prototype)!==Object.prototype||Object.getOwnPropertyNames(i.prototype).length>1||i.toString().startsWith("class"))}}();var ce,P=(ce=window.queueMicrotask)!=null?ce:(r=>o=>r.then(o))(Promise.resolve());g.def(S.Plugin,()=>{throw new Error("Plugin not created yet")});var W=class extends S.Component{constructor(){super(...arguments);this.use=g.service(this)}};g.service=function(r){return g(V).addChild(r),g.this};g.plugin=function(r){let o=g.fork().set(S.Plugin,r).set(r.constructor,r);return r.addChild(o.use(V)),o};var V=class extends S.Component{constructor(){super(...arguments);this.children=new Set([this])}onload(){this.loaded=!0}onunload(){this.loaded=!1,this.children.clear()}addChild(e){return this.children.has(e)||(this.children.add(e),this.loaded?P(()=>super.addChild(e)):super.addChild(e)),e}};function H(r,o){let e=Object.keys(o).map(t=>Ve(r,t,o[t]));return e.length===1?e[0]:function(){e.forEach(t=>t())}}function Ve(r,o,e){let t=r[o],i=r.hasOwnProperty(o),n=e(t);return t&&Object.setPrototypeOf(n,t),Object.setPrototypeOf(s,n),r[o]=s,a;function s(...c){return n===t&&r[o]===s&&a(),n.apply(this,c)}function a(){r[o]===s&&(i?r[o]=t:delete r[o]),n!==t&&(n=t,Object.setPrototypeOf(s,t||Function))}}var ue=require("obsidian");var Q=2,wt=Symbol.for(`v${Q}.layout-storage-events.ophidian.peak-dev.org`);var gt=`ophidian-layout-storage:v${Q}:item-load`,yt=`ophidian-layout-storage:v${Q}:item-save`;var he=require("obsidian");var pe=require("obsidian");var B=class extends pe.Component{constructor(e,t){super();this.use=e;this.win=t}get container(){return je(this.win)}[g.factory](){return new Y(this.constructor)}},Y=class extends W{constructor(e){super();this.factory=e;this.instances=new WeakMap;this.watching=!1}watch(){if(!this._loaded)this.onload=()=>this.watch();else if(!this.watching){let{workspace:e}=app;this.watching=!0,this.registerEvent(e.on("window-open",(t,i)=>{e.onLayoutReady(()=>P(()=>this.forWindow(i)))})),e.onLayoutReady(()=>P(()=>this.forAll()))}return this}forWindow(e=(i=>(i=window.activeWindow)!=null?i:window)(),t=!0){let n=this.instances.get(e);return!n&&t&&(n=new this.factory(this.use,e),n&&(this.instances.set(e,n),n.registerDomEvent(e,"beforeunload",()=>{this.removeChild(n),this.instances.delete(e)}),this.addChild(n))),n||void 0}forDom(e,t=!0){return this.forWindow(Z(e),t)}forLeaf(e,t=!0){return this.forDom(e.containerEl,t)}forView(e,t=!0){return this.forLeaf(e.leaf,t)}forAll(e=!0){return Be().map(t=>this.forWindow(t,e)).filter(t=>t)}};function Be(){let r=[window],{floatingSplit:o}=app.workspace;if(o)for(let e of o.children)e.win&&r.push(e.win);return r}function Z(r){return r.win||(r.ownerDocument||r).defaultView||window}function je(r){if(r===window)return app.workspace.rootSplit;let{floatingSplit:o}=app.workspace;if(o){for(let e of o.children)if(r===e.win)return e}}function de(r,o,e,t,i){return r.on(o,e,t,i),()=>r.off(o,e,t,i)}var z=require("obsidian");function Ue(r){for(var o=r.split(/([#.])/),e="",t="",i=[],n=0;n<o.length;n++){var s=o[n];s==="#"?t=o[++n]:s==="."?i.push(o[++n]):s.length&&(e=s)}return{tag:e||"div",id:t,className:i.join(" ")}}function ye(r,o){var e=Ue(r),t=e.tag,i=e.id,n=e.className,s=o?document.createElementNS(o,t):document.createElement(t);return i&&(s.id=i),n&&(o?s.setAttribute("class",n):s.className=n),s}function E(r,o){var e=v(r),t=v(o);return o===t&&t.__redom_view&&(o=t.__redom_view),t.parentNode&&(be(o,t,e),e.removeChild(t)),o}function be(r,o,e){var t=o.__redom_lifecycle;if(fe(t)){o.__redom_lifecycle={};return}var i=e;for(o.__redom_mounted&&j(o,"onunmount");i;){var n=i.__redom_lifecycle||{};for(var s in t)n[s]&&(n[s]-=t[s]);fe(n)&&(i.__redom_lifecycle=null),i=i.parentNode}}function fe(r){if(r==null)return!0;for(var o in r)if(r[o])return!1;return!0}var ze=["onmount","onremount","onunmount"],qe=typeof window!="undefined"&&"ShadowRoot"in window;function F(r,o,e,t){var i=v(r),n=v(o);o===n&&n.__redom_view&&(o=n.__redom_view),o!==n&&(n.__redom_view=o);var s=n.__redom_mounted,a=n.parentNode;return s&&a!==i&&be(o,n,a),e!=null?t?i.replaceChild(n,v(e)):i.insertBefore(n,v(e)):i.appendChild(n),$e(o,n,i,a),o}function j(r,o){o==="onmount"||o==="onremount"?r.__redom_mounted=!0:o==="onunmount"&&(r.__redom_mounted=!1);var e=r.__redom_lifecycle;if(!!e){var t=r.__redom_view,i=0;t&&t[o]&&t[o]();for(var n in e)n&&i++;if(i)for(var s=r.firstChild;s;){var a=s.nextSibling;j(s,o),s=a}}}function $e(r,o,e,t){for(var i=o.__redom_lifecycle||(o.__redom_lifecycle={}),n=e===t,s=!1,a=0,c=ze;a<c.length;a+=1){var l=c[a];n||r!==o&&l in r&&(i[l]=(i[l]||0)+1),i[l]&&(s=!0)}if(!s){o.__redom_lifecycle={};return}var u=e,p=!1;for((n||u&&u.__redom_mounted)&&(j(o,n?"onremount":"onmount"),p=!0);u;){var h=u.parentNode,f=u.__redom_lifecycle||(u.__redom_lifecycle={});for(var m in i)f[m]=(f[m]||0)+i[m];if(p)break;(u.nodeType===Node.DOCUMENT_NODE||qe&&u instanceof ShadowRoot||h&&h.__redom_mounted)&&(j(u,n?"onremount":"onmount"),p=!0),u=h}}function Xe(r,o,e){var t=v(r);if(typeof o=="object")for(var i in o)me(t,i,o[i]);else me(t,o,e)}function me(r,o,e){e==null?r.style[o]="":r.style[o]=e}var ve="http://www.w3.org/1999/xlink";function xe(r,o,e,t){var i=v(r),n=typeof o=="object";if(n)for(var s in o)xe(i,s,o[s],t);else{var a=i instanceof SVGElement,c=typeof e=="function";if(o==="style"&&typeof e=="object")Xe(i,e);else if(a&&c)i[o]=e;else if(o==="dataset")Fe(i,e);else if(!a&&(o in i||c)&&o!=="list")i[o]=e;else{if(a&&o==="xlink"){Ee(i,e);return}t&&o==="class"&&(e=i.className+" "+e),e==null?i.removeAttribute(o):i.setAttribute(o,e)}}}function Ee(r,o,e){if(typeof o=="object")for(var t in o)Ee(r,t,o[t]);else e!=null?r.setAttributeNS(ve,o,e):r.removeAttributeNS(ve,o,e)}function Fe(r,o,e){if(typeof o=="object")for(var t in o)Fe(r,t,o[t]);else e!=null?r.dataset[o]=e:delete r.dataset[o]}function Me(r){return document.createTextNode(r!=null?r:"")}function te(r,o,e){for(var t=0,i=o;t<i.length;t+=1){var n=i[t];if(!(n!==0&&!n)){var s=typeof n;s==="function"?n(r):s==="string"||s==="number"?r.appendChild(Me(n)):U(v(n))?F(r,n):n.length?te(r,n,e):s==="object"&&xe(r,n,null,e)}}}function Te(r){return typeof r=="string"?D(r):v(r)}function v(r){return r.nodeType&&r||!r.el&&r||v(r.el)}function U(r){return r&&r.nodeType}var we={};function D(r){for(var o=[],e=arguments.length-1;e-- >0;)o[e]=arguments[e+1];var t,i=typeof r;if(i==="string")t=Le(r).cloneNode(!1);else if(U(r))t=r.cloneNode(!1);else if(i==="function"){var n=r;t=new(Function.prototype.bind.apply(n,[null].concat(o)))}else throw new Error("At least one argument required");return te(v(t),o,!0),t}var R=D;D.extend=function(o){for(var e=[],t=arguments.length-1;t-- >0;)e[t]=arguments[t+1];var i=Le(o);return D.bind.apply(D,[this,i].concat(e))};function Le(r){return we[r]||(we[r]=ye(r))}function ke(r){for(var o=[],e=arguments.length-1;e-- >0;)o[e]=arguments[e+1];for(var t=v(r),i=Pe(r,o,t.firstChild);i;){var n=i.nextSibling;E(r,i),i=n}}function Pe(r,o,e){for(var t=e,i=new Array(o.length),n=0;n<o.length;n++)i[n]=o[n]&&v(o[n]);for(var s=0;s<o.length;s++){var a=o[s];if(!!a){var c=i[s];if(c===t){t=t.nextSibling;continue}if(U(c)){var l=t&&t.nextSibling,u=a.__redom_index!=null,p=u&&l===i[s+1];F(r,a,t,p),p&&(t=l);continue}a.length!=null&&(t=Pe(r,a,t))}}return t}var Se=function(o,e,t){this.View=o,this.initData=t,this.oldLookup={},this.lookup={},this.oldViews=[],this.views=[],e!=null&&(this.key=typeof e=="function"?e:Ge(e))};Se.prototype.update=function(o,e){for(var t=this,i=t.View,n=t.key,s=t.initData,a=n!=null,c=this.lookup,l={},u=new Array(o.length),p=this.views,h=0;h<o.length;h++){var f=o[h],m=void 0;if(a){var T=n(f);m=c[T]||new i(s,f,h,o),l[T]=m,m.__redom_id=T}else m=p[h]||new i(s,f,h,o);m.update&&m.update(f,h,o,e);var O=v(m.el);O.__redom_view=m,u[h]=m}this.oldViews=p,this.views=u,this.oldLookup=c,this.lookup=l};function Ge(r){return function(o){return o[r]}}function ie(r,o,e,t){return new C(r,o,e,t)}var C=function(o,e,t,i){this.View=e,this.initData=i,this.views=[],this.pool=new Se(e,t,i),this.el=Te(o),this.keySet=t!=null};C.prototype.update=function(o,e){o===void 0&&(o=[]);var t=this,i=t.keySet,n=this.views;this.pool.update(o,e);var s=this.pool,a=s.views,c=s.lookup;if(i)for(var l=0;l<n.length;l++){var u=n[l],p=u.__redom_id;c[p]==null&&(u.__redom_index=null,E(this,u))}for(var h=0;h<a.length;h++){var f=a[h];f.__redom_index=h}ke(this,a),i&&(this.lookup=c),this.views=a};C.extend=function(o,e,t,i){return C.bind(C,o,e,t,i)};ie.extend=C.extend;var Je=function(o,e){this.el=Me(""),this.visible=!1,this.view=null,this._placeholder=this.el,o instanceof Node?this._el=o:o.el instanceof Node?(this._el=o,this.view=o):this._View=o,this._initData=e};Je.prototype.update=function(o,e){var t=this._placeholder,i=this.el.parentNode;if(o){if(!this.visible)if(this._el)F(i,this._el,t),E(i,t),this.el=v(this._el),this.visible=o;else{var n=this._View,s=new n(this._initData);this.el=v(s),this.view=s,F(i,s,t),E(i,t)}this.view&&this.view.update&&this.view.update(e)}else if(this.visible){if(this._el){F(i,t,this._el),E(i,this._el),this.el=t,this.visible=o;return}F(i,t,this.view),E(i,this.view),this.el=t,this.view=null}this.visible=o};var Qe=function(o,e,t){this.el=Te(o),this.Views=e,this.initData=t};Qe.prototype.update=function(o,e){if(o!==this.route){var t=this.Views,i=t[o];this.route=o,i&&(i instanceof Node||i.el instanceof Node)?this.view=i:this.view=i&&new i(this.initData,e),ke(this.el,[this.view])}this.view&&this.view.update&&this.view.update(e,o)};var Ce="http://www.w3.org/2000/svg",ge={};function ee(r){for(var o=[],e=arguments.length-1;e-- >0;)o[e]=arguments[e+1];var t,i=typeof r;if(i==="string")t=_e(r).cloneNode(!1);else if(U(r))t=r.cloneNode(!1);else if(i==="function"){var n=r;t=new(Function.prototype.bind.apply(n,[null].concat(o)))}else throw new Error("At least one argument required");return te(v(t),o,!0),t}ee.extend=function(o){var e=_e(o);return ee.bind(this,e)};ee.ns=Ce;function _e(r){return ge[r]||(ge[r]=ye(r,Ce))}var x=require("obsidian");var w=require("obsidian");var b=class extends w.Menu{constructor(e,t=e instanceof w.App?e:e.app){super(t);this.parent=e;this.app=t;this.match="";this.resetSearchOnTimeout=(0,w.debounce)(()=>{this.match=""},1500,!0);this.visible=!1;this.firstMove=!1;e instanceof b&&e.setChildMenu(this),this.scope=new w.Scope,this.scope.register([],"ArrowUp",this.onArrowUp.bind(this)),this.scope.register([],"ArrowDown",this.onArrowDown.bind(this)),this.scope.register([],"Enter",this.onEnter.bind(this)),this.scope.register([],"Escape",this.onEscape.bind(this)),this.scope.register([],"ArrowLeft",this.onArrowLeft.bind(this)),this.scope.register([],"Home",this.onHome.bind(this)),this.scope.register([],"End",this.onEnd.bind(this)),this.scope.register([],"ArrowRight",this.onArrowRight.bind(this));let i=this;H(this.dom,{contains(n){return function(s){var c;return n.call(this,s)||((c=i.child)==null?void 0:c.dom.contains(s))}}}),this.dom.addClass("qe-popup-menu")}onEscape(){return this.hide(),!1}onload(){this.scope.register(null,null,this.onKeyDown.bind(this)),super.onload(),this.visible=!0,this.showSelected(),this.firstMove=!0,this.register(Ze(this.dom,"mouseover",".menu-item",(e,t)=>{!this.firstMove&&!t.hasClass("is-disabled")&&!this.child&&this.select(this.items.findIndex(i=>i.dom===t),!1),this.firstMove=!1}))}onunload(){this.visible=!1,super.onunload()}addItem(e){let t=new w.MenuItem(this);return this.items.push(t),e(t),this._loaded&&this.sort&&this.sort(),this}onKeyDown(e){let t=w.Keymap.getModifiers(e);if(e.key.length===1&&!e.isComposing&&(!t||t==="Shift")){let i=this.match+e.key;for(;i&&!this.searchFor(i);)i=i.substr(1);this.match=i,this.resetSearchOnTimeout()}return!1}searchFor(e){let t=e.split("").map(Ye);return this.find(new RegExp("^"+t.join(""),"ui"))||this.find(new RegExp("^"+t.join(".*"),"ui"))||this.find(new RegExp(t.join(".*"),"ui"))}find(e){var i,n;let t=Math.min(0,this.selected);for(let s=this.items.length;s;++t,s--)if(!((i=this.items[t])!=null&&i.disabled)&&(n=this.items[t])!=null&&n.dom.textContent.match(e))return this.select(t),!0;return!1}onEnter(e){let t=this.items[this.selected];return t&&(t.handleEvent(e),this.child||this.hide()),!1}select(e,t=!0){this.match="",super.select(e),t&&this.showSelected()}showSelected(){var t;let e=(t=this.items[this.selected])==null?void 0:t.dom;if(e){let i=this.dom.getBoundingClientRect(),n=e.getBoundingClientRect();(n.top<i.top||n.bottom>i.bottom)&&e.scrollIntoView()}}unselect(){var e;(e=this.items[this.selected])==null||e.dom.removeClass("selected")}onEnd(e){return this.unselect(),this.selected=this.items.length,this.onArrowUp(e),this.selected===this.items.length&&(this.selected=-1),!1}onHome(e){return this.unselect(),this.selected=-1,this.onArrowDown(e),!1}onArrowLeft(){return this.rootMenu()!==this&&this.hide(),!1}onArrowRight(){return!1}hide(){return this.setChildMenu(),super.hide()}setChildMenu(e){var t;(t=this.child)==null||t.hide(),this.child=e}rootMenu(){return this.parent instanceof w.App?this:this.parent.rootMenu()}cascade(e,t,i,n=15,s=5){var le;let{left:a,right:c,top:l,bottom:u,width:p}=e.getBoundingClientRect(),h=a+Math.min(150,p/3),f=(l+u)/2,m=(le=window.activeWindow)!=null?le:window,{innerHeight:T,innerWidth:O}=m,A={x:t?t.clientX-n:h,y:u-s};m.document.body.appendChild(this.dom);let{offsetWidth:Ie,offsetHeight:se}=this.dom,ae=A.y+se<T,We=A.x+Ie<=O;return ae||(A.y=u>T-(u-l)?l+s:T),We||(A.x=se<u-s||ae?O:h),this.showAtPosition(A),e.toggleClass("selected",!0),this.register(()=>{this.parent instanceof w.App?e.toggleClass("selected",!1):this.parent instanceof b&&this.parent.setChildMenu(),i&&i()}),this}};function Ye(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ze(r,o,e,t,i=!1){return r.on(o,e,t,i),()=>r.off(o,e,t,i)}function K(r){return i18next.t(`plugins.file-explorer.menu-opt-${r}`)}var L=class extends b{constructor(o,e){super(o);let{workspace:t}=this.app,i=this.app.internalPlugins.plugins["file-explorer"].enabled;e instanceof x.TFolder&&(this.addItem(n=>n.setTitle(K("new-note")).setIcon("create-new").onClick(async s=>{this.rootMenu().hide();let a=await this.app.fileManager.createNewMarkdownFile(e);a&&await this.app.workspace.getLeaf(x.Keymap.isModEvent(s)).openFile(a,{active:!0,state:{mode:"source"},eState:{rename:"all"}})})),this.addItem(n=>n.setTitle(K("new-folder")).setIcon("folder").setDisabled(!i).onClick(s=>{var a;i?(this.rootMenu().hide(),(a=this.withExplorer(e))==null||a.createAbstractFile("folder",e)):(new x.Notice("The File Explorer core plugin must be enabled to create new folders"),s.stopPropagation())})),this.addItem(n=>n.setTitle(K("set-attachment-folder")).setIcon("image-file").onClick(()=>{this.app.setAttachmentFolder(e)})),this.addSeparator()),this.addItem(n=>{n.setTitle(K("rename")).setIcon("pencil").onClick(s=>{this.app.fileManager.promptForFileRename(e)})}),this.addItem(n=>n.setTitle(K("delete")).setIcon("trash").onClick(()=>{e instanceof x.TFolder?this.app.fileManager.promptForFolderDeletion(e):e instanceof x.TFile&&this.app.fileManager.promptForFileDeletion(e)})),e instanceof x.TFolder&&i&&this.addItem(n=>n.setIcon("folder").setTitle(i18next.t("plugins.file-explorer.action-reveal-file")).onClick(()=>{this.rootMenu().hide(),this.withExplorer(e)})),t.trigger("file-menu",this,e,"quick-explorer")}onEnter(o){return this.rootMenu().hide(),super.onEnter(o)}withExplorer(o){let e=this.app.internalPlugins.plugins["file-explorer"];if(e.enabled)return e.instance.revealInFolder(o),this.app.workspace.getLeavesOfType("file-explorer")[0].view}};var d=require("obsidian");var oe=new Intl.Collator(void 0,{usage:"sort",sensitivity:"base",numeric:!0}).compare,Ae={markdown:"document",image:"image-file",audio:"audio-file",pdf:"pdf-file"},et={...Ae,excalidraw:"excalidraw-icon"},y=!0,M=class extends b{constructor(e,t,i,n){super(e);this.parent=e;this.folder=t;this.selectedFile=i;this.opener=n;this.parentFolder=this.parent instanceof M?this.parent.folder:null;this.fileCount=e=>e instanceof d.TFolder?e.children.map(this.fileCount).reduce((t,i)=>t+i,0):this.fileIcon(e)?1:0;this.refreshFiles=(0,d.debounce)(()=>this.loadFiles(this.folder,this.currentFile()),100,!0);this.showPopover=(0,d.debounce)(()=>{var e;this.hidePopover(),y&&this.maybeHover((e=this.currentItem())==null?void 0:e.dom,t=>this.app.workspace.trigger("link-hover",this,Z(this.dom).document.body,t.path,""))},50,!0);this.onItemHover=(e,t)=>{y||this.maybeHover(t,i=>this.app.workspace.trigger("hover-link",{event:e,source:N,hoverParent:this,targetEl:t,linktext:i.path}))};this.onItemClick=(e,t)=>{let i=this.fileForDom(t);if(!!i&&!this.onClickFile(i,t,e))return e.stopPropagation(),e.preventDefault(),!1};this.onItemMenu=(e,t)=>{let i=this.fileForDom(t);if(i){let n=this.itemForPath(i.path);n>=0&&this.selected!=n&&this.select(n),new L(this,i).cascade(t,e),e.stopPropagation()}};this.loadFiles(t,i),this.scope.register([],"Tab",this.togglePreviewMode.bind(this)),this.scope.register(["Mod"],"Enter",this.onEnter.bind(this)),this.scope.register(["Alt"],"Enter",this.onKeyboardContextMenu.bind(this)),this.scope.register([],"\\",this.onKeyboardContextMenu.bind(this)),this.scope.register([],"F2",this.doRename.bind(this)),this.scope.register(["Shift"],"F2",this.doMove.bind(this)),this.scope.register([],"PageUp",this.doScroll.bind(this,-1,!1)),this.scope.register([],"PageDown",this.doScroll.bind(this,1,!1)),this.scope.register(["Mod"],"Home",this.doScroll.bind(this,0,!0)),this.scope.register(["Mod"],"End",this.doScroll.bind(this,1,!0));let{dom:s}=this,a=".menu-item[data-file-path]";s.on("click",a,this.onItemClick,!0),s.on("auxclick",a,this.onItemClick,!0),s.on("contextmenu",a,this.onItemMenu),s.on("mouseover",a,this.onItemHover),s.on("mousedown",a,l=>{l.stopPropagation()},!0),s.on("dragstart",a,(l,u)=>{ne(this.app,u.dataset.filePath,l)}),this.register(()=>{y&&this.parent instanceof M&&this.parent.showPopover()});let c=this;H(this.dom,{contains(l){return function(u){var h;return l.call(this,u)||((h=c._popover)==null?void 0:h.hoverEl.contains(u))}}})}onArrowLeft(){var e;return super.onArrowLeft(),this.rootMenu()===this&&this.openBreadcrumb((e=this.opener)==null?void 0:e.previousElementSibling),!1}onKeyboardContextMenu(){var i;let e=(i=this.items[this.selected])==null?void 0:i.dom,t=e&&this.fileForDom(e);return t&&new L(this,t).cascade(e),!1}doScroll(e,t,i){var a,c;let n=(a=this.hoverPopover)==null?void 0:a.hoverEl,s=n==null?void 0:n.find((c=this.hoverPopover)!=null&&c.rootSplit?'[data-mode="preview"] .markdown-preview-view, [data-mode="source"] .cm-scroller':".markdown-preview-view");if(s){s.style.scrollBehavior=t?"auto":"smooth";let l=s.scrollTop,u=(t?0:s.scrollTop)+e*(t?s.scrollHeight:s.clientHeight);s.scrollTop=u,t||(u>=s.scrollHeight?this.onArrowDown(i):u<0&&(l>0?s.scrollTop=0:this.onArrowUp(i)))}else y?e>0?this.onArrowDown(i):this.onArrowUp(i):(y=!0,this.showPopover());return!1}doRename(){let e=this.currentFile();return this.rootMenu().hide(),e&&this.app.fileManager.promptForFileRename(e),!1}doMove(){let e=this.app.internalPlugins.plugins["file-explorer"];if(!e.enabled)return new d.Notice("File explorer core plugin must be enabled to move files or folders"),!1;this.rootMenu().hide();let t=e.instance.moveFileModal;return t.setCurrentFile(this.currentFile()),t.open(),!1}currentItem(){return this.items[this.selected]}currentFile(){var e;return this.fileForDom((e=this.currentItem())==null?void 0:e.dom)}fileForDom(e){let{filePath:t}=e==null?void 0:e.dataset;if(t)return this.app.vault.getAbstractFileByPath(t)}itemForPath(e){return this.items.findIndex(t=>t.dom.dataset.filePath===e)}openBreadcrumb(e){if(e&&this.rootMenu()===this){let t=this.opener.previousElementSibling;return e.click(),!1}}onArrowRight(){var t;let e=this.currentFile();if(e instanceof d.TFolder)e!==this.selectedFile?this.onClickFile(e,this.currentItem().dom):this.openBreadcrumb((t=this.opener)==null?void 0:t.nextElementSibling);else if(e instanceof d.TFile){let i=this.hoverPopover;i&&i.rootSplit&&this.app.workspace.iterateLeaves(n=>{var s;return n.view instanceof d.FileView&&n.view.file===e&&(i.togglePin(!0),this.onEscape(),n.view instanceof d.MarkdownView?n.setViewState({type:n.view.getViewType(),state:{file:e.path,mode:"source"}}).then(()=>this.app.workspace.setActiveLeaf(n,!1,!0)):((s=this.dom.ownerDocument.activeElement)==null||s.blur(),this.app.workspace.setActiveLeaf(n,!1,!0))),!0},i.rootSplit)}return!1}loadFiles(e,t){let i=this.folderNote(this.folder);this.dom.empty(),this.items=[];let n=this.app.vault.getConfig("showUnsupportedFiles"),{children:s,parent:a}=e,c=s.slice().sort((p,h)=>oe(p.name,h.name)),l=c.filter(p=>p instanceof d.TFolder),u=c.filter(p=>p instanceof d.TFile&&p!==i&&(n||this.fileIcon(p)));l.sort((p,h)=>oe(p.name,h.name)),u.sort((p,h)=>oe(p.basename,h.basename)),i&&this.addFile(i),l.length&&(i&&this.addSeparator(),l.map(this.addFile,this)),u.length&&((l.length||i)&&this.addSeparator(),u.map(this.addFile,this)),this.select(t?this.itemForPath(t.path):0)}fileIcon(e){var t;if(e instanceof d.TFolder)return"folder";if(e instanceof d.TFile){let i=this.app.viewRegistry.getTypeByExtension(e.extension);if(i)return(t=et[i])!=null?t:"document"}}addFile(e){let t=this.fileIcon(e);this.addItem(i=>{if(i.setTitle(e.name),i.dom.dataset.filePath=e.path,i.dom.setAttr("draggable","true"),i.dom.addClass(e instanceof d.TFolder?"is-qe-folder":"is-qe-file"),t&&i.setIcon(t),e instanceof d.TFile)i.setTitle(e.basename),e.extension!=="md"&&i.dom.createDiv({text:e.extension,cls:["nav-file-tag","qe-extension"]});else if(e!==this.folder.parent){let n=this.fileCount(e);n&&i.dom.createDiv({text:""+n,cls:"nav-file-tag qe-file-count"})}i.onClick(n=>this.onClickFile(e,i.dom,n))})}togglePreviewMode(){return(y=!y)?this.showPopover():this.hidePopover(),!1}onload(){super.onload(),this.register(de(this.dom.ownerDocument.body,"mousedown",".hover-popover",(e,t)=>{var i,n,s;((i=this.hoverPopover)==null?void 0:i.hoverEl)===t&&((s=(n=this.hoverPopover).togglePin)==null||s.call(n,!0))},{capture:!0})),this.registerEvent(this.app.vault.on("create",e=>{this.folder===e.parent&&this.refreshFiles()})),this.registerEvent(this.app.vault.on("rename",(e,t)=>{if(this.folder===e.parent){let i=this.itemForPath(t)>=0?e:this.currentFile();this.loadFiles(this.folder,i)}else this.removeItemForPath(t)})),this.registerEvent(this.app.vault.on("delete",e=>this.removeItemForPath(e.path))),y&&this.selected!=-1&&this.showPopover()}removeItemForPath(e){let t=this.itemForPath(e);if(t<0)return;let i=this.items[t];this.selected>t&&(this.selected-=1),i.dom.detach(),this.items.remove(i)}onEscape(){return super.onEscape(),this.parent instanceof b&&this.parent.onEscape(),!1}hide(){return this.hidePopover(),super.hide()}setChildMenu(e){super.setChildMenu(e),y&&this.canShowPopover()&&this.showPopover()}select(e,t=!0){let i=this.selected;super.select(e,t),i!==this.selected&&(y?this.showPopover():this.hidePopover())}hidePopover(){this.hoverPopover=null}canShowPopover(){return!this.child&&this.visible}maybeHover(e,t){if(!this.canShowPopover())return;let i=this.fileForDom(e);i instanceof d.TFolder&&(i=this.folderNote(i)),i instanceof d.TFile&&Ae[this.app.viewRegistry.getTypeByExtension(i.extension)]&&t(i)}folderNote(e){return this.app.vault.getAbstractFileByPath(this.folderNotePath(e))}folderNotePath(e){return`${e.path}/${e.name}.md`}get hoverPopover(){return this._popover}set hoverPopover(e){var n;let t=this._popover;t&&e!==t&&(this._popover=null,t.onHover=!1,t.isPinned||t.hide()),e&&!this.canShowPopover()&&(e.onHover=!1,e.hide(),e=null),this._popover=e;let i=e==null?void 0:e.targetEl;if(i&&i===i.ownerDocument.body&&(i.removeEventListener("mouseover",e.onMouseIn),i.removeEventListener("mouseout",e.onMouseOut)),y&&e&&this.currentItem()){(n=e.togglePin)==null||n.call(e,!1),Promise.resolve().then(()=>{var f,m;return(m=(f=e.abortController)==null?void 0:f.unload)==null?void 0:m.call(f)});let s=e.hoverEl;s.show();let a=this.dom.getBoundingClientRect(),c=this.currentItem().dom.getBoundingClientRect(),l=s.offsetParent||this.dom.ownerDocument.documentElement,u=s.offsetHeight,p=Math.min(a.right+2,l.clientWidth-s.offsetWidth),h=Math.min(Math.max(0,c.top-u/8),l.clientHeight-u);s.style.top=h+"px",s.style.left=p+"px"}}onClickFile(e,t,i){var s;this.hidePopover();let n=this.itemForPath(e.path);if(n>=0&&this.selected!=n&&this.select(n),e instanceof d.TFile){if(this.app.viewRegistry.isExtensionRegistered(e.extension))return this.app.workspace.openLinkText(e.path,"",i&&d.Keymap.isModEvent(i)),this.rootMenu().hide(),i==null||i.stopPropagation(),!0;new d.Notice(`.${e.extension} files cannot be opened in Obsidian; Use "Open in Default App" to open them externally`)}else e===this.selectedFile?this.openBreadcrumb((s=this.opener)==null?void 0:s.nextElementSibling):new M(this,e,this.folderNote(e)).cascade(t,i instanceof MouseEvent?i:void 0)}};var N="quick-explorer:folder-menu";function ne(r,o,e){if(!o||o==="/")return;let t=r.vault.getAbstractFileByPath(o);if(!t)return;let{dragManager:i}=r,n=t instanceof z.TFile?i.dragFile(e,t):i.dragFolder(e,t);i.onDragStart(e,n)}var re=class{constructor(){this.nameEl=R("span",{class:"explorable-name"});this.sepEl=R("span",{class:"explorable-separator"});this.el=R("span",{draggable:!0,class:"explorable titlebar-button"},this.nameEl,this.sepEl)}update(o,e,t){var a,c;let{file:i,path:n}=o,s=i.name||n;this.sepEl.toggle(e<t.length-1),this.nameEl.textContent=s,this.el.dataset.parentPath=(c=(a=i.parent)==null?void 0:a.path)!=null?c:"/",this.el.dataset.filePath=n}},_=class extends B{constructor(){super(...arguments);this.lastFile=null;this.lastPath=null;this.el=R("div",{id:"quick-explorer"});this.list=ie(this.el,re);this.isOpen=0;this.app=app}onload(){let e=this.win.document.body.find(".titlebar .titlebar-button-container.mod-left");this.register(()=>E(e,this)),F(e,this),this.isCurrent()&&this.update(this.app.workspace.getActiveFile()),this.registerEvent(this.app.vault.on("rename",this.onFileChange,this)),this.registerEvent(this.app.vault.on("delete",this.onFileDelete,this)),this.el.on("contextmenu",".explorable",(t,i)=>{let{filePath:n}=i.dataset,s=this.app.vault.getAbstractFileByPath(n);new L(this.app,s).cascade(i,t)}),this.el.on("click",".explorable",(t,i)=>{this.folderMenu(i,t.isTrusted&&t)}),this.el.on("dragstart",".explorable",(t,i)=>{ne(this.app,i.dataset.filePath,t)})}onFileChange(e){e===this.lastFile&&this.update(e)}onFileDelete(e){e===this.lastFile&&this.update()}folderMenu(e=this.el.firstElementChild,t){let{filePath:i,parentPath:n}=e.dataset,s=this.app.vault.getAbstractFileByPath(i),a=this.app.vault.getAbstractFileByPath(n);return this.isOpen++,new M(this.app,a,s,e).cascade(e,t,()=>{this.isOpen--,!this.isOpen&&this.isCurrent()&&this.update(this.app.workspace.getActiveFile())})}browseVault(){return this.folderMenu()}browseCurrent(){return this.folderMenu(this.el.lastElementChild)}browseFile(e){if(e===this.lastFile)return this.browseCurrent();let t,i=this.el.firstElementChild,n=[],s=e.path.split("/").filter(a=>a);for(;i&&s.length;){if(n.push(s[0]),i.dataset.filePath!==n.join("/")){t=this.folderMenu(i),n.pop();break}s.shift(),i=i.nextElementSibling}for(;t&&s.length;){n.push(s.shift());let a=t.itemForPath(n.join("/"));if(a==-1)break;t.select(a),(s.length||e instanceof z.TFolder)&&(t.onArrowRight(),t=t.child)}return t}isCurrent(){return this===this.use(_).forLeaf(app.workspace.activeLeaf)}update(e){if(this.isOpen||(e!=null||(e=this.app.vault.getAbstractFileByPath("/")),e==this.lastFile&&e.path==this.lastPath))return;this.lastFile=e,this.lastPath=e.path;let t=[];for(;e;)t.unshift({file:e,path:e.path}),e=e.parent;t.length>1&&t.shift(),this.list.update(t)}};var q=class extends $.Plugin{constructor(){super(...arguments);this.use=g.plugin(this);this.explorers=this.use(_)}updateCurrent(e=this.app.workspace.activeLeaf,t=this.app.workspace.getActiveFile()){this.explorers.forLeaf(e).update(t)}onload(){this.app.workspace.registerHoverLinkSource(N,{display:"Quick Explorer",defaultMod:!0}),this.registerEvent(this.app.workspace.on("file-open",()=>this.updateCurrent())),this.registerEvent(this.app.workspace.on("active-leaf-change",e=>this.updateCurrent(e))),this.app.workspace.onLayoutReady(()=>this.updateCurrent()),this.addCommand({id:"browse-vault",name:"Browse vault",callback:()=>{var e;(e=this.explorers.forWindow())==null||e.browseVault()}}),this.addCommand({id:"browse-current",name:"Browse current folder",callback:()=>{var e;(e=this.explorers.forWindow())==null||e.browseCurrent()}}),this.registerEvent(this.app.workspace.on("file-menu",(e,t,i)=>{let n;if(i!=="quick-explorer"&&e.addItem(s=>{var a;s.setIcon("folder").setTitle("Show in Quick Explorer").onClick(c=>{var l;(l=this.explorers.forDom(n.dom))==null||l.browseFile(t)}),n=s,(a=n.setSection)==null||a.call(n,"view")}),n){let s=i18next.t("plugins.file-explorer.action-reveal-file"),a=e.items.findIndex(c=>{var l;return((l=c.titleEl)==null?void 0:l.textContent)===s});a>-1&&(e.sections||e.dom.insertBefore(n.dom,e.items[a].dom),e.items.remove(n),e.items.splice(a,0,n))}})),Object.defineProperty($.TFolder.prototype,"basename",{get(){return this.name},configurable:!0})}onunload(){this.app.workspace.unregisterHoverLinkSource(N)}};
