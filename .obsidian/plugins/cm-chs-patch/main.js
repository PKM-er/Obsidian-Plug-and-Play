/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source visit the plugins github repository
*/

"use strict";var le=Object.defineProperty;var at=Object.getOwnPropertyDescriptor;var ut=Object.getOwnPropertyNames;var ct=Object.prototype.hasOwnProperty;var dt=(i,n)=>{for(var e in n)le(i,e,{get:n[e],enumerable:!0})},ft=(i,n,e,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let t of ut(n))!ct.call(i,t)&&t!==e&&le(i,t,{get:()=>n[t],enumerable:!(r=at(n,t))||r.enumerable});return i};var ht=i=>ft(le({},"__esModule",{value:!0}),i);var zt={};dt(zt,{default:()=>oe});module.exports=ht(zt);var st=require("obsidian");function O(i,n){let e=Object.keys(n).map(r=>mt(i,r,n[r]));return e.length===1?e[0]:function(){e.forEach(r=>r())}}function mt(i,n,e){let r=i[n],t=i.hasOwnProperty(n),o=e(r);return r&&Object.setPrototypeOf(o,r),Object.setPrototypeOf(l,o),i[n]=l,s;function l(...a){return o===r&&i[n]===l&&s(),o.apply(this,a)}function s(){i[n]===l&&(t?i[n]=r:delete i[n]),o!==r&&(o=r,Object.setPrototypeOf(l,r||Function))}}var gt=i=>window.CodeMirror?.prototype?O(window.CodeMirror.prototype,{findWordAt:n=>function(e){let r=n.call(this,e),t=this.indexFromPos(e),o=r.from(),l=this.indexFromPos(o),s=r.to(),a=this.indexFromPos(s),u=this.getRange(o,s),c=i.getSegRangeFromCursor(t,{from:l,to:a,text:u});if(c){let{from:d,to:f}=c;r.anchor=this.posFromIndex(d),r.head=this.posFromIndex(f)}return r}}):null,pt=i=>{let n=gt(i);n&&i.register(n)},De=pt;var J=require("@codemirror/state"),$e=require("@codemirror/view");var U=require("@codemirror/state"),Je=require("@codemirror/view");var Pe=require("@codemirror/state"),bt=(i,n,e,r)=>{if(!e)return null;let{from:t,to:o}=e,l=r.doc.sliceString(t,o),s=i.getSegRangeFromCursor(n,{from:t,to:o,text:l});return s?Pe.EditorSelection.range(s.from,s.to):null},F=bt;function H(i){return i.nodeType==3?ce(i,0,i.nodeValue.length).getClientRects():i.nodeType==1?i.getClientRects():[]}function se(i){for(var n=0;;n++)if(i=i.previousSibling,!i)return n}function Ve(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}var ae={left:0,right:0,top:0,bottom:0};function ue(i,n){let e=n?i.left:i.right;return{left:e,right:e,top:i.top,bottom:i.bottom}}var Oe;function ce(i,n,e=n){let r=Oe||(Oe=document.createRange());return r.setEnd(i,e),r.setStart(i,n),r}function W(i){for(;i.attributes.length;)i.removeAttributeNode(i.attributes[0])}var y=class{constructor(n,e,r=!0){this.node=n;this.offset=e;this.precise=r}static before(n,e){return new y(n.parentNode,se(n),e)}static after(n,e){return new y(n.parentNode,se(n)+1,e)}},j=[],p=class{constructor(){this.parent=null;this.dom=null;this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(n){let e=this.posAtStart;for(let r of this.children){if(r==n)return e;e+=r.length+r.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(n){return this.posBefore(n)+n.length}coordsAt(n,e){return null}sync(n){if(this.dirty&2){let e=this.dom,r=null,t;for(let o of this.children){if(o.dirty){if(!o.dom&&(t=r?r.nextSibling:e.firstChild)){let l=p.get(t);(!l||!l.parent&&l.canReuseDOM(o))&&o.reuseDOM(t)}o.sync(n),o.dirty=0}if(t=r?r.nextSibling:e.firstChild,n&&!n.written&&n.node==e&&t!=o.dom&&(n.written=!0),o.dom.parentNode==e)for(;t&&t!=o.dom;)t=ve(t);else e.insertBefore(o.dom,t);r=o.dom}for(t=r?r.nextSibling:e.firstChild,t&&n&&n.node==e&&(n.written=!0);t;)t=ve(t)}else if(this.dirty&1)for(let e of this.children)e.dirty&&(e.sync(n),e.dirty=0)}reuseDOM(n){}localPosFromDOM(n,e){let r;if(n==this.dom)r=this.dom.childNodes[e];else{let t=Ve(n)==0?0:e==0?-1:1;for(;;){let o=n.parentNode;if(o==this.dom)break;t==0&&o.firstChild!=o.lastChild&&(n==o.firstChild?t=-1:t=1),n=o}t<0?r=n:r=n.nextSibling}if(r==this.dom.firstChild)return 0;for(;r&&!p.get(r);)r=r.nextSibling;if(!r)return this.length;for(let t=0,o=0;;t++){let l=this.children[t];if(l.dom==r)return o;o+=l.length+l.breakAfter}}domBoundsAround(n,e,r=0){let t=-1,o=-1,l=-1,s=-1;for(let a=0,u=r,c=r;a<this.children.length;a++){let d=this.children[a],f=u+d.length;if(u<n&&f>e)return d.domBoundsAround(n,e,u);if(f>=n&&t==-1&&(t=a,o=u),u>e&&d.dom.parentNode==this.dom){l=a,s=c;break}c=f,u=f+d.breakAfter}return{from:o,to:s<0?r+this.length:s,startDOM:(t?this.children[t-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:l<this.children.length&&l>=0?this.children[l].dom:null}}markDirty(n=!1){this.dirty|=2,this.markParentsDirty(n)}markParentsDirty(n){for(let e=this.parent;e;e=e.parent){if(n&&(e.dirty|=2),e.dirty&1)return;e.dirty|=1,n=!1}}setParent(n){this.parent!=n&&(this.parent=n,this.dirty&&this.markParentsDirty(!0))}setDOM(n){this.dom&&(this.dom.cmView=null),this.dom=n,n.cmView=this}get rootView(){for(let n=this;;){let e=n.parent;if(!e)return n;n=e}}replaceChildren(n,e,r=j){this.markDirty();for(let t=n;t<e;t++){let o=this.children[t];o.parent==this&&o.destroy()}this.children.splice(n,e-n,...r);for(let t=0;t<r.length;t++)r[t].setParent(this)}ignoreMutation(n){return!1}ignoreEvent(n){return!1}childCursor(n=this.length){return new de(this.children,n,this.children.length)}childPos(n,e=1){return this.childCursor().findPos(n,e)}toString(){let n=this.constructor.name.replace("View","");return n+(this.children.length?"("+this.children.join()+")":this.length?"["+(n=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(n){return n.cmView}get isEditable(){return!0}merge(n,e,r,t,o,l){return!1}become(n){return!1}canReuseDOM(n){return n.constructor==this.constructor}getSide(){return 0}destroy(){this.parent=null}};p.prototype.breakAfter=0;function ve(i){let n=i.nextSibling;return i.parentNode.removeChild(i),n}var de=class{constructor(n,e,r){this.children=n;this.pos=e;this.i=r;this.off=0}findPos(n,e=1){for(;;){if(n>this.pos||n==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=n-this.pos,this;let r=this.children[--this.i];this.pos-=r.length+r.breakAfter}}};function yt(i,n,e,r,t,o,l,s,a){let{children:u}=i,c=u.length?u[n]:null,d=o.length?o[o.length-1]:null,f=d?d.breakAfter:l;if(!(n==r&&c&&!l&&!f&&o.length<2&&c.merge(e,t,o.length?d:null,e==0,s,a))){if(r<u.length){let h=u[r];h&&t<h.length?(n==r&&(h=h.split(t),t=0),!f&&d&&h.merge(0,t,d,!0,0,a)?o[o.length-1]=h:(t&&h.merge(0,t,null,!1,0,a),o.push(h))):h?.breakAfter&&(d?d.breakAfter=1:l=1),r++}for(c&&(c.breakAfter=l,e>0&&(!l&&o.length&&c.merge(e,c.length,o[0],!1,s,0)?c.breakAfter=o.shift().breakAfter:(e<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(e,c.length,null,!1,s,0),n++));n<r&&o.length;)if(u[r-1].become(o[o.length-1]))r--,o.pop(),a=o.length?0:s;else if(u[n].become(o[0]))n++,o.shift(),s=o.length?0:a;else break;!o.length&&n&&r<u.length&&!u[n-1].breakAfter&&u[r].merge(0,0,u[n-1],!1,s,a)&&n--,(n<r||o.length)&&i.replaceChildren(n,r,o)}}function z(i,n,e,r,t,o){let l=i.childCursor(),{i:s,off:a}=l.findPos(e,1),{i:u,off:c}=l.findPos(n,-1),d=n-e;for(let f of r)d+=f.length;i.length+=d,yt(i,u,c,s,a,r,0,t,o)}var G=require("@codemirror/state");var b=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},he=typeof document<"u"?document:{documentElement:{style:{}}},me=/Edge\/(\d+)/.exec(b.userAgent),He=/MSIE \d/.test(b.userAgent),ge=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(b.userAgent),I=!!(He||ge||me),Le=!I&&/gecko\/(\d+)/i.test(b.userAgent),fe=!I&&/Chrome\/(\d+)/.exec(b.userAgent),Be="webkitFontSmoothing"in he.documentElement.style,We=!I&&/Apple Computer/.test(b.vendor),Fe=We&&(/Mobile\/\w+/.test(b.userAgent)||b.maxTouchPoints>2),E={mac:Fe||/Mac/.test(b.platform),windows:/Win/.test(b.platform),linux:/Linux|X11/.test(b.platform),ie:I,ie_version:He?he.documentMode||6:ge?+ge[1]:me?+me[1]:0,gecko:Le,gecko_version:Le?+(/Firefox\/(\d+)/.exec(b.userAgent)||[0,0])[1]:0,chrome:!!fe,chrome_version:fe?+fe[1]:0,ios:Fe,android:/Android\b/.test(b.userAgent),webkit:Be,safari:We,webkit_version:Be?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:he.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};var Ct=256,w=class extends p{constructor(e){super();this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,r,t){return t&&(!(t instanceof w)||this.length-(r-e)+t.length>Ct)?!1:(this.text=this.text.slice(0,e)+(t?t.text:"")+this.text.slice(r),this.markDirty(),!0)}split(e){let r=new w(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),r}localPosFromDOM(e,r){return e==this.dom?r:r?this.text.length:0}domAtPos(e){return new y(this.dom,e)}domBoundsAround(e,r,t){return{from:t,to:t+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,r){return xt(this.dom,e,r)}},C=class extends p{constructor(e,r=[],t=0){super();this.mark=e;this.children=r;this.length=t;for(let o of r)o.setParent(this)}setAttrs(e){if(W(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let r in this.mark.attrs)e.setAttribute(r,this.mark.attrs[r]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,r,t,o,l,s){return t&&(!(t instanceof C&&t.mark.eq(this.mark))||e&&l<=0||r<this.length&&s<=0)?!1:(z(this,e,r,t?t.children:[],l-1,s-1),this.markDirty(),!0)}split(e){let r=[],t=0,o=-1,l=0;for(let a of this.children){let u=t+a.length;u>e&&r.push(t<e?a.split(e-t):a),o<0&&t>=e&&(o=l),t=u,l++}let s=this.length-e;return this.length=e,o>-1&&(this.children.length=o,this.markDirty()),new C(this.mark,r,s)}domAtPos(e){return pe(this,e)}coordsAt(e,r){return ye(this,e,r)}};function xt(i,n,e){let r=i.nodeValue.length;n>r&&(n=r);let t=n,o=n,l=0;n==0&&e<0||n==r&&e>=0?E.chrome||E.gecko||(n?(t--,l=1):o<r&&(o++,l=-1)):e<0?t--:o<r&&o++;let s=ce(i,t,o).getClientRects();if(!s.length)return ae;let a=s[(l?l<0:e>=0)?0:s.length-1];return E.safari&&!l&&a.width==0&&(a=Array.prototype.find.call(s,u=>u.width)||a),l?ue(a,l<0):a||null}var _=class extends p{constructor(e,r,t){super();this.widget=e;this.length=r;this.side=t;this.prevWidget=null}static create(e,r,t){return new(e.customView||_)(e,r,t)}split(e){let r=_.create(this.widget,this.length-e,this.side);return this.length-=e,r}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,r,t,o,l,s){return t&&(!(t instanceof _)||!this.widget.compare(t.widget)||e>0&&l<=0||r<this.length&&s<=0)?!1:(this.length=e+(t?t.length:0)+(this.length-r),!0)}become(e){return e.length==this.length&&e instanceof _&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.eq(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return G.Text.empty;let e=this;for(;e.parent;)e=e.parent;let r=e.editorView,t=r&&r.state.doc,o=this.posAtStart;return t?t.slice(o,o+this.length):G.Text.empty}domAtPos(e){return e==0?y.before(this.dom):y.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,r){let t=this.dom.getClientRects(),o=null;if(!t.length)return ae;for(let l=e>0?t.length-1:0;o=t[l],!(e>0?l==0:l==t.length-1||o.top<o.bottom);l+=e>0?-1:1);return ue(o,this.side>0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}};var R=class extends p{constructor(e){super();this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof R&&e.side==this.side}split(){return new R(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return y.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){let r=this.dom.getBoundingClientRect(),t=At(this,this.side>0?-1:1);return t&&t.top<r.bottom&&t.bottom>r.top?{left:r.left,right:r.right,top:t.top,bottom:t.bottom}:r}get overrideDOMText(){return G.Text.empty}};w.prototype.children=_.prototype.children=R.prototype.children=j;function At(i,n){let e=i.parent,r=e?e.children.indexOf(i):-1;for(;e&&r>=0;)if(n<0?r>0:r<e.children.length){let t=e.children[r+n];if(t instanceof w){let o=t.coordsAt(n<0?t.length:0,n);if(o)return o}r+=n}else if(e instanceof C&&e.parent)r=e.parent.children.indexOf(e)+(n<0?0:1),e=e.parent;else{let t=e.dom.lastChild;if(t&&t.nodeName=="BR")return t.getClientRects()[0];break}}function pe(i,n){let e=i.dom,{children:r}=i,t=0;for(let o=0;t<r.length;t++){let l=r[t],s=o+l.length;if(!(s==o&&l.getSide()<=0)){if(n>o&&n<s&&l.dom.parentNode==e)return l.domAtPos(n-o);if(n<=o)break;o=s}}for(let o=t;o>0;o--){let l=r[o-1];if(l.dom.parentNode==e)return l.domAtPos(l.length)}for(let o=t;o<r.length;o++){let l=r[o];if(l.dom.parentNode==e)return l.domAtPos(0)}return new y(e,0)}function be(i,n,e){let r,{children:t}=i;e>0&&n instanceof C&&t.length&&(r=t[t.length-1])instanceof C&&r.mark.eq(n.mark)?be(r,n.children[0],e-1):(t.push(n),n.setParent(i)),i.length+=n.length}function ye(i,n,e){return i.children.length?(e<=0?je:ze)(i,n):_t(i)}function je(i,n){let e=null,r=-1;function t(o,l){for(let s=0,a=0;s<o.children.length&&a<=l;s++){let u=o.children[s],c=a+u.length;if(c>=l){if(u.children.length){if(t(u,l-a))return!0}else if(c>=l){if(c==l&&u.getSide()>0)return!0;e=u,r=l-a}}a=c}}return t(i,n),e?e.coordsAt(Math.max(0,r),-1):ze(i,n)}function ze(i,n){let e=null,r=-1;function t(o,l){for(let s=o.children.length-1,a=o.length;s>=0&&a>=l;s--){let u=o.children[s];if(a-=u.length,a<=l){if(u.children.length){if(t(u,l-a))return!0}else if(a<=l){if(a==l&&u.getSide()<0)return!0;e=u,r=l-a}}}}return t(i,n),e?e.coordsAt(Math.max(0,r),1):je(i,n)}function _t(i){let n=i.dom.lastChild;if(!n)return i.dom.getBoundingClientRect();let e=H(n);return e[e.length-1]||null}function we(i,n){for(let e in i)e=="class"&&n.class?n.class+=" "+i.class:e=="style"&&n.style?n.style+=";"+i.style:n[e]=i[e];return n}function Ie(i,n){if(i==n)return!0;if(!i||!n)return!1;let e=Object.keys(i),r=Object.keys(n);if(e.length!=r.length)return!1;for(let t of e)if(r.indexOf(t)==-1||i[t]!==n[t])return!1;return!0}function Ge(i,n,e){let r=null;if(n)for(let t in n)e&&t in e||i.removeAttribute(r=t);if(e)for(let t in e)n&&n[t]==e[t]||i.setAttribute(r=t,e[t]);return!!r}var Tt=require("@codemirror/state"),T=class extends p{constructor(){super(...arguments);this.children=[];this.length=0;this.prevAttrs=void 0;this.attrs=null;this.breakAfter=0}merge(e,r,t,o,l,s){if(t){if(!(t instanceof T))return!1;this.dom||t.transferDOM(this)}return o&&this.setDeco(t?t.attrs:null),z(this,e,r,t?t.children:[],l,s),!0}split(e){let r=new T;if(r.breakAfter=this.breakAfter,this.length==0)return r;let{i:t,off:o}=this.childPos(e);o&&(r.append(this.children[t].split(o),0),this.children[t].merge(o,this.children[t].length,null,!1,0,0),t++);for(let l=t;l<this.children.length;l++)r.append(this.children[l],0);for(;t>0&&this.children[t-1].length==0;)this.children[--t].destroy();return this.children.length=t,this.markDirty(),this.length=e,r}transferDOM(e){!this.dom||(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){Ie(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,r){be(this,e,r)}addLineDeco(e){let r=e.spec.attributes,t=e.spec.class;r&&(this.attrs=we(r,this.attrs||{})),t&&(this.attrs=we({class:t},this.attrs||{}))}domAtPos(e){return pe(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?this.dirty&4&&(W(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Ge(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let r=this.dom.lastChild;for(;r&&p.get(r)instanceof C;)r=r.lastChild;if(!r||!this.length||r.nodeName!="BR"&&p.get(r)?.isEditable==!1&&(!E.ios||!this.children.some(t=>t instanceof w))){let t=document.createElement("BR");t.cmIgnore=!0,this.dom.appendChild(t)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0;for(let r of this.children){if(!(r instanceof w)||/[^ -~]/.test(r.text))return null;let t=H(r.dom);if(t.length!=1)return null;e+=t[0].width}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}:null}coordsAt(e,r){return ye(this,e,r)}become(e){return!1}get type(){return 0}static find(e,r){for(let t=0,o=0;t<e.children.length;t++){let l=e.children[t],s=o+l.length;if(s>=r){if(l instanceof T)return l;if(s>r)break}o=s+l.breakAfter}return null}};var x=require("@codemirror/state");function Ce(i,n,e=1){let r=i.charCategorizer(n),t=i.doc.lineAt(n),o=n-t.from;if(t.length==0)return x.EditorSelection.cursor(n);o==0?e=1:o==t.length&&(e=-1);let l=o,s=o;e<0?l=(0,x.findClusterBreak)(t.text,o,!1):s=(0,x.findClusterBreak)(t.text,o);let a=r(t.text.slice(l,s));for(;l>0;){let u=(0,x.findClusterBreak)(t.text,l,!1);if(r(t.text.slice(u,l))!=a)break;l=u}for(;s<t.length;){let u=(0,x.findClusterBreak)(t.text,s);if(r(t.text.slice(s,u))!=a)break;s=u}return x.EditorSelection.range(l+t.from,s+t.from)}var Ke=(i,n)=>i>=n.top&&i<=n.bottom,Ue=(i,n,e)=>Ke(n,e)&&i>=e.left&&i<=e.right;function St(i,n,e,r){let t=T.find(i.docView,n);if(!t)return 1;let o=n-t.posAtStart;if(o==0)return 1;if(o==t.length)return-1;let l=t.coordsAt(o,-1);if(l&&Ue(e,r,l))return-1;let s=t.coordsAt(o,1);return s&&Ue(e,r,s)?1:l&&Ke(r,l)?-1:1}function xe(i,n){let e=i.posAtCoords({x:n.clientX,y:n.clientY},!1);return{pos:e,bias:St(i,e,n.clientX,n.clientY)}}var qe=i=>{let n=(r,t,o,l)=>{let s=Ce(r.state,t,o);return F(i,t,s,r.state)??s};return Je.EditorView.mouseSelectionStyle.of((r,t)=>{if(t.button!==0||t.detail!==2)return null;let o=xe(r,t),l=t.detail,s=r.state.selection,a=o,u=t;return{update(c){c.docChanged&&(o&&(o.pos=c.changes.mapPos(o.pos)),s=s.map(c.changes),u=null)},get(c,d,f){let h;if(u&&c.clientX==u.clientX&&c.clientY==u.clientY?h=a:(h=a=xe(r,c),u=c),!h||!o)return s;let m=n(r,h.pos,h.bias,l);if(o.pos!=h.pos&&!d){let P=n(r,o.pos,o.bias,l),M=Math.min(P.from,m.from),Ne=Math.max(P.to,m.to);m=M<m.from?U.EditorSelection.range(M,Ne):U.EditorSelection.range(Ne,M)}return d?s.replaceRange(s.main.extend(m.from,m.to)):f?s.addRange(m):U.EditorSelection.create([m])}}})};var K=require("@codemirror/state"),k=require("@codemirror/view"),Ye=i=>{function n(l,s){if(l.state.readOnly)return!1;let a="delete.selection",{state:u}=l,c=u.changeByRange(d=>{let{from:f,to:h}=d;if(f==h){let m=s(f);m<f?(a="delete.backward",m=e(l,m,!1)):m>f&&(a="delete.forward",m=e(l,m,!0)),f=Math.min(f,m),h=Math.max(h,m)}else f=e(l,f,!1),h=e(l,f,!0);return f==h?{range:d}:{changes:{from:f,to:h},range:K.EditorSelection.cursor(f)}});return c.changes.empty?!1:(l.dispatch(u.update(c,{scrollIntoView:!0,userEvent:a,effects:a=="delete.selection"?k.EditorView.announce.of(u.phrase("Selection deleted")):void 0})),!0)}function e(l,s,a){if(l instanceof k.EditorView)for(let u of l.state.facet(k.EditorView.atomicRanges).map(c=>c(l)))u.between(s,s,(c,d)=>{c<s&&d>s&&(s=a?d:c)});return s}let r=(l,s)=>n(l,a=>{let u=a,{state:c}=l,d=c.doc.lineAt(u),f=c.charCategorizer(u);for(let h=null;;){if(u==(s?d.to:d.from)){u==a&&d.number!=(s?c.doc.lines:1)&&(u+=s?1:-1);break}let m=(0,K.findClusterBreak)(d.text,u-d.from,s)+d.from,P=d.text.slice(Math.min(u,m)-d.from,Math.max(u,m)-d.from),M=f(P);if(h!=null&&M!=h)break;(P!=" "||u!=a)&&(h=M),u=m}return u=i.getSegRangeFromGroup(a,u,c.sliceDoc.bind(c))??u,u}),t=l=>r(l,!1),o=l=>r(l,!0);return k.keymap.of([{key:"Ctrl-Alt-h",run:t},{key:"Mod-Backspace",mac:"Alt-Backspace",run:t},{key:"Mod-Delete",mac:"Alt-Delete",run:o}])};var Xe=i=>[qe(i),Ye(i)];var Mt=i=>{i.registerEditorExtension(Xe(i)),i.register(O(J.EditorState.prototype,{wordAt:n=>function(e){let r=n.call(this,e);return F(i,e,n.call(this,e),this)??r}})),i.register(O($e.EditorView.prototype,{moveByGroup:n=>function(e,r){let t=n.call(this,e,r);if(t.empty&&e.empty){let o=i.getSegRangeFromGroup(e.from,t.from,this.state.sliceDoc.bind(this.state));if(o)return J.EditorSelection.range(o,o)}return t}}))},Qe=Mt;var q=class extends Error{},Ae=class extends q{},_e=class extends q{},Et=(i,n=",")=>i.join(n),Rt={accept:"*",multiple:!1,strict:!1},Ze=i=>{let{accept:n,multiple:e,strict:r}={...Rt,...i},t=Dt({multiple:e,accept:Array.isArray(n)?Et(n):n});return new Promise(o=>{t.onchange=()=>{o(kt(t.files,e,r)),t.remove()},t.click()})},kt=(i,n,e)=>new Promise((r,t)=>{if(!i)return t(new Ae);let o=Nt(i,n,e);if(!o)return t(new _e);r(o)}),Nt=(i,n,e)=>!n&&e?i.length===1?i[0]:null:i.length?i:null,Dt=({accept:i,multiple:n})=>{let e=document.createElement("input");return e.type="file",e.multiple=n,e.accept=i,e};var et=require("obsidian"),Pt="var(--background-modifier-success)",Ot="var(--background-modifier-cover)",V=class extends et.Modal{constructor(e){super(e.app);this.plugin=e;this.reloadButton=null;this.selectButton=null;this.downloadLink=`https://github.com/aidenlx/cm-chs-patch/blob/master/assets/jiaba-wasm/${this.libName}.zip?raw=true`;this.lanzoumLink="https://wwe.lanzoum.com/igUPR00jp02h";this.modalEl.addClass("zt-install-guide")}get libName(){return this.plugin.libName}onOpen(){this.contentEl.createEl("h1",{text:"\u5B89\u88C5\u7ED3\u5DF4\u5206\u8BCD"}),this.contentEl.createDiv({},e=>{e.appendText("\u65B0\u7248\u5206\u8BCD\u63D2\u4EF6\u9700\u8981\u5B89\u88C5 jieba-wasm\uFF0C\u8BF7\u6309\u7167\u4E0B\u9762\u7684\u6B65\u9AA4\u5B89\u88C5\uFF1A"),e.createEl("ol",{},r=>{r.createEl("li",{},t=>{t.appendText("\u70B9\u51FB\u94FE\u63A5\u4E0B\u8F7D "),t.createEl("code",{text:this.libName+".zip"}),t.createEl("br"),t.appendText("\u4ECE "),t.createEl("a",{href:this.downloadLink,text:"GitHub"}),t.appendText(" \u6216 "),t.createEl("a",{href:this.lanzoumLink,text:"\u84DD\u594F\u4E91"}),t.appendText(" \u4E0B\u8F7D")}),r.createEl("li",{},t=>{t.appendText("\u89E3\u538B\u7F29zip\u5305\u5F97\u5230 "),t.createEl("code",{text:this.libName})}),r.createEl("li",{},t=>{t.appendText("\u5728\u5F39\u51FA\u7684\u7A97\u53E3\u9009\u62E9 "),t.createEl("code",{text:this.libName}),this.selectButton=t.createEl("button",{text:"\u9009\u62E9\u6587\u4EF6"},o=>o.onclick=this.onSelectingFile.bind(this))}),r.createEl("li",{},t=>{t.appendText("\u91CD\u65B0\u52A0\u8F7D\u5206\u8BCD\u63D2\u4EF6: "),this.reloadButton=t.createEl("button",{text:"\u91CD\u65B0\u52A0\u8F7D"},o=>{o.disabled=!0,o.style.backgroundColor=Ot,o.onclick=this.onReloadPlugin.bind(this)})})})})}onClose(){this.contentEl.empty()}async onSelectingFile(){let e=await Ze({multiple:!1,accept:".wasm",strict:!0});!e||(await this.app.vault.adapter.writeBinary(this.plugin.libPath,await e.arrayBuffer()),this.selectButton&&(this.selectButton.setText("\u7ED3\u5DF4\u5206\u8BCD\u5BFC\u5165\u6210\u529F"),this.selectButton.style.backgroundColor=Pt),this.reloadButton&&(this.reloadButton.disabled=!1,this.reloadButton.style.backgroundColor=""))}async onReloadPlugin(){await this.app.plugins.disablePlugin(this.plugin.manifest.id),this.close(),await this.app.plugins.enablePlugin(this.plugin.manifest.id)}};var Ht={},g,tt=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});tt.decode();var Y=null;function Q(){return(Y===null||Y.buffer!==g.memory.buffer)&&(Y=new Uint8Array(g.memory.buffer)),Y}function Te(i,n){return tt.decode(Q().subarray(i,i+n))}var A=new Array(32).fill(void 0);A.push(void 0,null,!0,!1);var B=A.length;function v(i){B===A.length&&A.push(A.length+1);let n=B;return B=A[n],A[n]=i,n}function Z(i){return A[i]}function Vt(i){i<36||(A[i]=B,B=i)}function L(i){let n=Z(i);return Vt(i),n}function Me(i){let n=typeof i;if(n=="number"||n=="boolean"||i==null)return`${i}`;if(n=="string")return`"${i}"`;if(n=="symbol"){let t=i.description;return t==null?"Symbol":`Symbol(${t})`}if(n=="function"){let t=i.name;return typeof t=="string"&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(i)){let t=i.length,o="[";t>0&&(o+=Me(i[0]));for(let l=1;l<t;l++)o+=", "+Me(i[l]);return o+="]",o}let e=/\[object ([^\]]+)\]/.exec(toString.call(i)),r;if(e.length>1)r=e[1];else return toString.call(i);if(r=="Object")try{return"Object("+JSON.stringify(i)+")"}catch{return"Object"}return i instanceof Error?`${i.name}: ${i.message}
${i.stack}`:r}var N=0,ee=new TextEncoder("utf-8"),vt=typeof ee.encodeInto=="function"?function(i,n){return ee.encodeInto(i,n)}:function(i,n){let e=ee.encode(i);return n.set(e),{read:i.length,written:e.length}};function te(i,n,e){if(e===void 0){let s=ee.encode(i),a=n(s.length);return Q().subarray(a,a+s.length).set(s),N=s.length,a}let r=i.length,t=n(r),o=Q(),l=0;for(;l<r;l++){let s=i.charCodeAt(l);if(s>127)break;o[t+l]=s}if(l!==r){l!==0&&(i=i.slice(l)),t=e(t,r,r=l+i.length*3);let s=Q().subarray(t+l,t+r);l+=vt(i,s).written}return N=l,t}var X=null;function ne(){return(X===null||X.buffer!==g.memory.buffer)&&(X=new Int32Array(g.memory.buffer)),X}var $=null;function Lt(){return($===null||$.buffer!==g.memory.buffer)&&($=new Uint32Array(g.memory.buffer)),$}function Bt(i,n){let r=Lt().subarray(i/4,i/4+n),t=[];for(let o=0;o<r.length;o++)t.push(L(r[o]));return t}function Ee(i,n){try{let s=g.__wbindgen_add_to_stack_pointer(-16);var e=te(i,g.__wbindgen_malloc,g.__wbindgen_realloc),r=N;g.cut(s,e,r,n);var t=ne()[s/4+0],o=ne()[s/4+1],l=Bt(t,o).slice();return g.__wbindgen_free(t,o*4),l}finally{g.__wbindgen_add_to_stack_pointer(16)}}function Se(i){return i==null}function re(i,n,e){var r=te(i,g.__wbindgen_malloc,g.__wbindgen_realloc),t=N,o=Se(e)?0:te(e,g.__wbindgen_malloc,g.__wbindgen_realloc),l=N,s=g.add_word(r,t,!Se(n),Se(n)?0:n,o,l);return s>>>0}async function Ft(i,n){if(typeof Response=="function"&&i instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(i,n)}catch(r){if(i.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let e=await i.arrayBuffer();return await WebAssembly.instantiate(e,n)}else{let e=await WebAssembly.instantiate(i,n);return e instanceof WebAssembly.Instance?{instance:e,module:i}:e}}async function nt(i){typeof i>"u"&&(i=new URL("jieba_rs_wasm_bg.wasm",Ht.url));let n={};n.wbg={},n.wbg.__wbindgen_string_new=function(t,o){var l=Te(t,o);return v(l)},n.wbg.__wbindgen_object_drop_ref=function(t){L(t)},n.wbg.__wbg_new_68adb0d58759a4ed=function(){var t=new Object;return v(t)},n.wbg.__wbindgen_number_new=function(t){var o=t;return v(o)},n.wbg.__wbg_set_2e79e744454afade=function(t,o,l){Z(t)[L(o)]=L(l)},n.wbg.__wbindgen_object_clone_ref=function(t){var o=Z(t);return v(o)},n.wbg.__wbg_new_7031805939a80203=function(t,o){var l=new Error(Te(t,o));return v(l)},n.wbg.__wbindgen_debug_string=function(t,o){var l=Me(Z(o)),s=te(l,g.__wbindgen_malloc,g.__wbindgen_realloc),a=N;ne()[t/4+1]=a,ne()[t/4+0]=s},n.wbg.__wbindgen_throw=function(t,o){throw new Error(Te(t,o))},n.wbg.__wbindgen_rethrow=function(t){throw L(t)},(typeof i=="string"||typeof Request=="function"&&i instanceof Request||typeof URL=="function"&&i instanceof URL)&&(i=fetch(i));let{instance:e,module:r}=await Ft(await i,n);return g=e.exports,nt.__wbindgen_wasm_module=r,g}var rt=nt;var Wt=i=>i&&Number.isInteger(+i)?+i:void 0,it=i=>i&&i in jt?i:void 0,Re=!1,ot=async(i,n)=>{if(Re)return;let e=[];if(await rt(i),n)for(let r of n.split(/\r?\n/)){let[t,o,l]=r.trim().split(/\s+/),s,a;if(!t){e.push(r);continue}!o&&!l?re(t):(a=it(o))?re(t,void 0,a):(a=it(l),s=Wt(o),re(t,s,a))}Ee("",!0),Re=!0},lt=(i,n=!1)=>{if(!Re)throw new Error("jieba not loaded");return Ee(i,n)},jt={n:void 0,f:void 0,s:void 0,t:void 0,nr:void 0,ns:void 0,nt:void 0,nw:void 0,nz:void 0,v:void 0,vd:void 0,vn:void 0,a:void 0,ad:void 0,an:void 0,d:void 0,m:void 0,q:void 0,r:void 0,p:void 0,c:void 0,u:void 0,xc:void 0,w:void 0,PER:void 0,LOC:void 0,ORG:void 0,TIME:void 0};var S=require("obsidian"),ke={useJieba:!1,hmm:!1,dict:""},ie=class extends S.PluginSettingTab{constructor(e){super(e.app,e);this.plugin=e}display(){let{containerEl:e}=this;e.empty(),this.addToggle(e,"useJieba").setName("\u4F7F\u7528\u7ED3\u5DF4\u5206\u8BCD").setDesc("\u652F\u6301\u65B0\u8BCD\u53D1\u73B0\u3001\u81EA\u5B9A\u4E49\u8BCD\u5178\uFF0C\u9700\u8981\u989D\u5916\u4E0B\u8F7D\uFF0C\u91CD\u542Fobsidian\u751F\u6548"),(this.plugin.settings.useJieba||!window.Intl?.Segmenter)&&(this.addToggle(e,"hmm").setName("\u65B0\u8BCD\u53D1\u73B0\u529F\u80FD").setDesc("\u91C7\u7528\u57FA\u4E8E\u6C49\u5B57\u6210\u8BCD\u80FD\u529B\u7684 HMM \u6A21\u578B\uFF0C\u4F7F\u7528 Viterbi \u7B97\u6CD5\u63A8\u7B97\u672A\u5B58\u5728\u4E8E\u8BCD\u5E93\u5185\u7684\u8BCD\u3002\u82E5\u6548\u679C\u4E0D\u7406\u60F3\uFF0C\u53EF\u9009\u62E9\u5173\u95ED\u6B64\u9009\u9879"),this.addTextField(e,{get:"dict",set:"dict"},{cols:30,rows:5}).setName("\u7528\u6237\u81EA\u5B9A\u4E49\u8BCD\u5178").setDesc(createFragment(r=>{r.appendText("\u901A\u8FC7\u7528\u6237\u81EA\u5B9A\u4E49\u8BCD\u5178\u6765\u589E\u5F3A\u6B67\u4E49\u7EA0\u9519\u80FD\u529B"),r.createEl("br"),r.appendText("\u8BCD\u5178\u683C\u5F0F\uFF1A\u4E00\u4E2A\u8BCD\u5360\u4E00\u884C\uFF1B\u6BCF\u4E00\u884C\u5206\u4E09\u90E8\u5206\uFF1A\u8BCD\u8BED\u3001\u8BCD\u9891\uFF08\u53EF\u7701\u7565\uFF09\u3001\u8BCD\u6027\uFF08\u53EF\u7701\u7565\uFF09\uFF0C\u7528\u7A7A\u683C\u9694\u5F00\uFF0C\u987A\u5E8F\u4E0D\u53EF\u98A0\u5012"),r.createEl("br"),r.appendText("\u6309\u4E0B\u6309\u94AE\u751F\u6548")})).addButton(r=>r.setIcon("reset").setTooltip("\u91CD\u65B0\u52A0\u8F7D\u8BCD\u5178").onClick(async()=>{await this.app.plugins.disablePlugin(this.plugin.manifest.id),await this.app.plugins.enablePlugin(this.plugin.manifest.id),this.app.setting.openTabById(this.plugin.manifest.id)})))}addToggle(e,r){return new S.Setting(e).addToggle(t=>{t.setValue(this.plugin.settings[r]).onChange(o=>(this.plugin.settings[r]=o,this.plugin.saveSettings()))})}addTextField(e,r,t={},o=500){return new S.Setting(e).addTextArea(l=>{let{get:s,set:a}=r,u=typeof s=="function"?s:()=>this.plugin.settings[s],c=typeof a=="function"?a:f=>this.plugin.settings[a]=f,d=async f=>{c(f),await this.plugin.saveSettings()};l.setValue(u()).onChange((0,S.debounce)(d,o,!0)),Object.assign(l.inputEl,{cols:30,rows:5,...t})})}};var D=6,oe=class extends st.Plugin{constructor(){super(...arguments);this.libName="jieba_rs_wasm_bg.wasm";this.settings=ke}get libPath(){return this.app.vault.configDir+"/"+this.libName}async onload(){this.addSettingTab(new ie(this)),await this.loadSettings(),await this.loadSegmenter()&&(De(this),Qe(this),console.info("editor word splitting patched"))}async loadSegmenter(){let{vault:e}=this.app;return!this.settings.useJieba&&window.Intl?.Segmenter?(this.segmenter=new Intl.Segmenter("zh-CN",{granularity:"word"}),!0):await e.adapter.exists(this.libPath,!0)?(await ot(this.app.vault.adapter.readBinary(this.libPath),this.settings.dict),console.info("Jieba loaded"),!0):(new V(this).open(),!1)}async loadSettings(){this.settings={...ke,...await this.loadData()}}async saveSettings(){await this.saveData(this.settings)}cut(e){return!this.settings.useJieba&&this.segmenter?Array.from(this.segmenter.segment(e)).map(r=>r.segment):lt(e,this.settings.hmm)}getSegRangeFromCursor(e,{from:r,to:t,text:o}){if(/[\u4e00-\u9fa5]/.test(o)){if(e-r>D){let c=e-D;o=o.slice(c-r),r=c}if(t-e>D){let c=e+D;o=o.slice(0,c-t),t=c}let l=this.cut(o);if(e===t){let c=l.last();return{from:t-c.length,to:t}}let s=0,a=0,u=e-r;for(let c of l){if(a=s+c.length,u>=s&&u<a)break;s+=c.length}return t=a+r,r+=s,{from:r,to:t}}else return null}getSegRangeFromGroup(e,r,t){let o=e<r;Math.abs(e-r)>D&&(r=e+D*(o?1:-1));let l=o?t(e,r):t(r,e);if(!/[\u4e00-\u9fa5]/.test(l))return null;let s=this.cut(l);return s.length===0?null:o?e+s.first().length:e-s.last().length}};
