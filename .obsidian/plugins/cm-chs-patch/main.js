/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source visit the plugins github repository
*/

var kn=Object.create;var Q=Object.defineProperty;var vn=Object.getOwnPropertyDescriptor;var Cn=Object.getOwnPropertyNames,pt=Object.getOwnPropertySymbols,Sn=Object.getPrototypeOf,bt=Object.prototype.hasOwnProperty,An=Object.prototype.propertyIsEnumerable;var wt=(r,e,t)=>e in r?Q(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ee=(r,e)=>{for(var t in e||(e={}))bt.call(e,t)&&wt(r,t,e[t]);if(pt)for(var t of pt(e))An.call(e,t)&&wt(r,t,e[t]);return r};var xt=r=>Q(r,"__esModule",{value:!0});var En=(r,e)=>{xt(r);for(var t in e)Q(r,t,{get:e[t],enumerable:!0})},Mn=(r,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Cn(e))!bt.call(r,n)&&n!=="default"&&Q(r,n,{get:()=>e[n],enumerable:!(t=vn(e,n))||t.enumerable});return r},k=r=>Mn(xt(Q(r!=null?kn(Sn(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var C=(r,e,t)=>new Promise((n,i)=>{var s=h=>{try{o(t.next(h))}catch(a){i(a)}},l=h=>{try{o(t.throw(h))}catch(a){i(a)}},o=h=>h.done?n(h.value):Promise.resolve(h.value).then(s,l);o((t=t.apply(r,e)).next())});En(exports,{default:()=>gt});var yn=k(require("obsidian"));function te(r,e){let t=Object.keys(e).map(n=>Rn(r,n,e[n]));return t.length===1?t[0]:function(){t.forEach(n=>n())}}function Rn(r,e,t){let n=r[e],i=r.hasOwnProperty(e),s=t(n);return n&&Object.setPrototypeOf(s,n),Object.setPrototypeOf(l,s),r[e]=l,o;function l(...h){return s===n&&r[e]===l&&o(),s.apply(this,h)}function o(){r[e]===l&&(i?r[e]=n:delete r[e]),s!==n&&(s=n,Object.setPrototypeOf(l,n||Function))}}var Pn=r=>{var e;return((e=window.CodeMirror)==null?void 0:e.prototype)?te(window.CodeMirror.prototype,{findWordAt:t=>function(n){let i=t.call(this,n),s=this.indexFromPos(n),l=i.from(),o=this.indexFromPos(l),h=i.to(),a=this.indexFromPos(h),u=this.getRange(l,h),c=r.getSegRangeFromCursor(s,{from:o,to:a,text:u});if(c){let{from:d,to:f}=c;i.anchor=this.posFromIndex(d),i.head=this.posFromIndex(f)}return i}}):null},Tn=r=>{let e=Pn(r);e&&r.register(e)},yt=Tn;var Me=k(require("@codemirror/state")),hn=k(require("@codemirror/view"));var Ae=k(require("@codemirror/state")),$t=k(require("@codemirror/view"));var kt=k(require("@codemirror/state")),In=(r,e,t,n)=>{if(!t)return null;let{from:i,to:s}=t,l=n.doc.sliceString(i,s),o=r.getSegRangeFromCursor(e,{from:i,to:s,text:l});return o?kt.EditorSelection.range(o.from,o.to):null},fe=In;function de(r){return r.nodeType==3?We(r,0,r.nodeValue.length).getClientRects():r.nodeType==1?r.getClientRects():[]}function Le(r){for(var e=0;;e++)if(r=r.previousSibling,!r)return e}function vt(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}var Fe={left:0,right:0,top:0,bottom:0};function me(r,e){let t=e?r.left:r.right;return{left:t,right:t,top:r.top,bottom:r.bottom}}var Ct;function We(r,e,t=e){let n=Ct||(Ct=document.createRange());return n.setEnd(r,t),n.setStart(r,e),n}function ge(r){for(;r.attributes.length;)r.removeAttributeNode(r.attributes[0])}var w;(function(i){i[i.Not=0]="Not",i[i.Child=1]="Child",i[i.Node=2]="Node",i[i.Attrs=4]="Attrs"})(w||(w={}));var A=class{constructor(e,t,n=!0){this.node=e;this.offset=t;this.precise=n}static before(e,t){return new A(e.parentNode,Le(e),t)}static after(e,t){return new A(e.parentNode,Le(e)+1,t)}},pe=[],v=class{constructor(){this.parent=null;this.dom=null;this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let n of this.children){if(n==e)return t;t+=n.length+n.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}coordsAt(e,t){return null}sync(e){if(this.dirty&2){let t=this.dom,n=t.firstChild;for(let i of this.children){if(i.dirty){if(!i.dom&&n){let s=v.get(n);(!s||!s.parent&&s.constructor==i.constructor)&&i.reuseDOM(n)}i.sync(e),i.dirty=0}if(e&&!e.written&&e.node==t&&n!=i.dom&&(e.written=!0),i.dom.parentNode==t){for(;n&&n!=i.dom;)n=St(n);n=i.dom.nextSibling}else t.insertBefore(i.dom,n)}for(n&&e&&e.node==t&&(e.written=!0);n;)n=St(n)}else if(this.dirty&1)for(let t of this.children)t.dirty&&(t.sync(e),t.dirty=0)}reuseDOM(e){}localPosFromDOM(e,t){let n;if(e==this.dom)n=this.dom.childNodes[t];else{let i=vt(e)==0?0:t==0?-1:1;for(;;){let s=e.parentNode;if(s==this.dom)break;i==0&&s.firstChild!=s.lastChild&&(e==s.firstChild?i=-1:i=1),e=s}i<0?n=e:n=e.nextSibling}if(n==this.dom.firstChild)return 0;for(;n&&!v.get(n);)n=n.nextSibling;if(!n)return this.length;for(let i=0,s=0;;i++){let l=this.children[i];if(l.dom==n)return s;s+=l.length+l.breakAfter}}domBoundsAround(e,t,n=0){let i=-1,s=-1,l=-1,o=-1;for(let h=0,a=n,u=n;h<this.children.length;h++){let c=this.children[h],d=a+c.length;if(a<e&&d>t)return c.domBoundsAround(e,t,a);if(d>=e&&i==-1&&(i=h,s=a),a>t&&c.dom.parentNode==this.dom){l=h,o=u;break}u=d,a=d+c.breakAfter}return{from:s,to:o<0?n+this.length:o,startDOM:(i?this.children[i-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:l<this.children.length&&l>=0?this.children[l].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.dirty|=2),t.dirty&1)return;t.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,n=pe){this.markDirty();for(let i=e;i<t;i++){let s=this.children[i];s.parent==this&&s.destroy()}this.children.splice(e,t-e,...n);for(let i=0;i<n.length;i++)n[i].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new At(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}merge(e,t,n,i,s,l){return!1}become(e){return!1}getSide(){return 0}destroy(){this.parent=null}};v.prototype.breakAfter=0;function St(r){let e=r.nextSibling;return r.parentNode.removeChild(r),e}var At=class{constructor(e,t,n){this.children=e;this.pos=t;this.i=n;this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let n=this.children[--this.i];this.pos-=n.length+n.breakAfter}}};function _n(r,e,t,n,i,s,l,o,h){let{children:a}=r,u=a.length?a[e]:null,c=s.length?s[s.length-1]:null,d=c?c.breakAfter:l;if(!(e==n&&u&&!l&&!d&&s.length<2&&u.merge(t,i,s.length?c:null,t==0,o,h))){if(n<a.length){let f=a[n];f&&i<f.length?(e==n&&(f=f.split(i),i=0),!d&&c&&f.merge(0,i,c,!0,0,h)?s[s.length-1]=f:(i&&f.merge(0,i,null,!1,0,h),s.push(f))):f?.breakAfter&&(c?c.breakAfter=1:l=1),n++}for(u&&(u.breakAfter=l,t>0&&(!l&&s.length&&u.merge(t,u.length,s[0],!1,o,0)?u.breakAfter=s.shift().breakAfter:(t<u.length||u.children.length&&u.children[u.children.length-1].length==0)&&u.merge(t,u.length,null,!1,o,0),e++));e<n&&s.length;)if(a[n-1].become(s[s.length-1]))n--,s.pop(),h=s.length?0:o;else if(a[e].become(s[0]))e++,s.shift(),o=s.length?0:h;else break;!s.length&&e&&n<a.length&&!a[e-1].breakAfter&&a[n].merge(0,0,a[e-1],!1,o,h)&&e--,(e<n||s.length)&&r.replaceChildren(e,n,s)}}function be(r,e,t,n,i,s){let l=r.childCursor(),{i:o,off:h}=l.findPos(t,1),{i:a,off:u}=l.findPos(e,-1),c=e-t;for(let d of n)c+=d.length;r.length+=c,_n(r,a,u,o,h,n,0,i,s)}var W="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(r=>r?parseInt(r,36):1);for(let r=1;r<W.length;r++)W[r]+=W[r-1];function Dn(r){for(let e=1;e<W.length;e+=2)if(W[e]>r)return W[e-1]<=r;return!1}function Et(r){return r>=127462&&r<=127487}var Mt=8205;function ne(r,e,t=!0,n=!0){return(t?Rt:Nn)(r,e,n)}function Rt(r,e,t){if(e==r.length)return e;e&&Pt(r.charCodeAt(e))&&Tt(r.charCodeAt(e-1))&&e--;let n=He(r,e);for(e+=It(n);e<r.length;){let i=He(r,e);if(n==Mt||i==Mt||t&&Dn(i))e+=It(i),n=i;else if(Et(i)){let s=0,l=e-2;for(;l>=0&&Et(He(r,l));)s++,l-=2;if(s%2==0)break;e+=2}else break}return e}function Nn(r,e,t){for(;e>0;){let n=Rt(r,e-2,t);if(n<e)return n;e--}return 0}function Pt(r){return r>=56320&&r<57344}function Tt(r){return r>=55296&&r<56320}function He(r,e){let t=r.charCodeAt(e);if(!Tt(t)||e+1==r.length)return t;let n=r.charCodeAt(e+1);return Pt(n)?(t-55296<<10)+(n-56320)+65536:t}function It(r){return r<65536?1:2}var E=class{constructor(){}lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,n){let i=[];return this.decompose(0,e,i,2),n.length&&n.decompose(0,n.length,i,1|2),this.decompose(t,this.length,i,1),M.from(i,this.length-(t-e)+n.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){let n=[];return this.decompose(e,t,n,0),M.from(n,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),n=this.length-this.scanIdentical(e,-1),i=new H(this),s=new H(e);for(let l=t,o=t;;){if(i.next(l),s.next(l),l=0,i.lineBreak!=s.lineBreak||i.done!=s.done||i.value!=s.value)return!1;if(o+=i.value.length,i.done||o>=n)return!0}}iter(e=1){return new H(this,e)}iterRange(e,t=this.length){return new je(this,e,t)}iterLines(e,t){let n;if(e==null)n=this.iter();else{t==null&&(t=this.lines+1);let i=this.line(e).from;n=this.iterRange(i,Math.max(i,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new qe(n)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?E.empty:e.length<=32?new g(e):M.from(g.split(e,[]))}},g=class extends E{constructor(e,t=Bn(e)){super();this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,n,i){for(let s=0;;s++){let l=this.text[s],o=i+l.length;if((t?n:o)>=e)return new Dt(i,o,n,l);i=o+1,n++}}decompose(e,t,n,i){let s=e<=0&&t>=this.length?this:new g(_t(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(i&1){let l=n.pop(),o=we(s.text,l.text.slice(),0,s.length);if(o.length<=32)n.push(new g(o,l.length+s.length));else{let h=o.length>>1;n.push(new g(o.slice(0,h)),new g(o.slice(h)))}}else n.push(s)}replace(e,t,n){if(!(n instanceof g))return super.replace(e,t,n);let i=we(this.text,we(n.text,_t(this.text,0,e)),t),s=this.length+n.length-(t-e);return i.length<=32?new g(i,s):M.from(g.split(i,[]),s)}sliceString(e,t=this.length,n=`
`){let i="";for(let s=0,l=0;s<=t&&l<this.text.length;l++){let o=this.text[l],h=s+o.length;s>e&&l&&(i+=n),e<h&&t>s&&(i+=o.slice(Math.max(0,e-s),t-s)),s=h+1}return i}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let n=[],i=-1;for(let s of e)n.push(s),i+=s.length+1,n.length==32&&(t.push(new g(n,i)),n=[],i=-1);return i>-1&&t.push(new g(n,i)),t}},M=class extends E{constructor(e,t){super();this.children=e,this.length=t,this.lines=0;for(let n of e)this.lines+=n.lines}lineInner(e,t,n,i){for(let s=0;;s++){let l=this.children[s],o=i+l.length,h=n+l.lines-1;if((t?h:o)>=e)return l.lineInner(e,t,n,i);i=o+1,n=h+1}}decompose(e,t,n,i){for(let s=0,l=0;l<=t&&s<this.children.length;s++){let o=this.children[s],h=l+o.length;if(e<=h&&t>=l){let a=i&((l<=e?1:0)|(h>=t?2:0));l>=e&&h<=t&&!a?n.push(o):o.decompose(e-l,t-l,n,a)}l=h+1}}replace(e,t,n){if(n.lines<this.lines)for(let i=0,s=0;i<this.children.length;i++){let l=this.children[i],o=s+l.length;if(e>=s&&t<=o){let h=l.replace(e-s,t-s,n),a=this.lines-l.lines+h.lines;if(h.lines<a>>5-1&&h.lines>a>>5+1){let u=this.children.slice();return u[i]=h,new M(u,this.length-(t-e)+n.length)}return super.replace(s,o,h)}s=o+1}return super.replace(e,t,n)}sliceString(e,t=this.length,n=`
`){let i="";for(let s=0,l=0;s<this.children.length&&l<=t;s++){let o=this.children[s],h=l+o.length;l>e&&s&&(i+=n),e<h&&t>l&&(i+=o.sliceString(e-l,t-l,n)),l=h+1}return i}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof M))return 0;let n=0,[i,s,l,o]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;i+=t,s+=t){if(i==l||s==o)return n;let h=this.children[i],a=e.children[s];if(h!=a)return n+h.scanIdentical(a,t);n+=h.length+1}}static from(e,t=e.reduce((n,i)=>n+i.length+1,-1)){let n=0;for(let f of e)n+=f.lines;if(n<32){let f=[];for(let m of e)m.flatten(f);return new g(f,t)}let i=Math.max(32,n>>5),s=i<<1,l=i>>1,o=[],h=0,a=-1,u=[];function c(f){let m;if(f.lines>s&&f instanceof M)for(let P of f.children)c(P);else f.lines>l&&(h>l||!h)?(d(),o.push(f)):f instanceof g&&h&&(m=u[u.length-1])instanceof g&&f.lines+m.lines<=32?(h+=f.lines,a+=f.length+1,u[u.length-1]=new g(m.text.concat(f.text),m.length+1+f.length)):(h+f.lines>i&&d(),h+=f.lines,a+=f.length+1,u.push(f))}function d(){h!=0&&(o.push(u.length==1?u[0]:M.from(u,a)),a=-1,h=u.length=0)}for(let f of e)c(f);return d(),o.length==1?o[0]:new M(o,t)}};E.empty=new g([""],0);function Bn(r){let e=-1;for(let t of r)e+=t.length+1;return e}function we(r,e,t=0,n=1e9){for(let i=0,s=0,l=!0;s<r.length&&i<=n;s++){let o=r[s],h=i+o.length;h>=t&&(h>n&&(o=o.slice(0,n-i)),i<t&&(o=o.slice(t-i)),l?(e[e.length-1]+=o,l=!1):e.push(o)),i=h+1}return e}function _t(r,e,t){return we(r,[""],e,t)}var H=class{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof g?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let n=this.nodes.length-1,i=this.nodes[n],s=this.offsets[n],l=s>>1,o=i instanceof g?i.text.length:i.children.length;if(l==(t>0?o:0)){if(n==0)return this.done=!0,this.value="",this;t>0&&this.offsets[n-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(t>0?0:1)){if(this.offsets[n]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(i instanceof g){let h=i.text[l+(t<0?-1:0)];if(this.offsets[n]+=t,h.length>Math.max(0,e))return this.value=e==0?h:t>0?h.slice(e):h.slice(0,h.length-e),this;e-=h.length}else{let h=i.children[l+(t<0?-1:0)];e>h.length?(e-=h.length,this.offsets[n]+=t):(t<0&&this.offsets[n]--,this.nodes.push(h),this.offsets.push(t>0?1:(h instanceof g?h.text.length:h.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}},je=class{constructor(e,t,n){this.value="",this.done=!1,this.cursor=new H(e,t>n?-1:1),this.pos=t>n?e.length:0,this.from=Math.min(t,n),this.to=Math.max(t,n)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let n=t<0?this.pos-this.from:this.to-this.pos;e>n&&(e=n),n-=e;let{value:i}=this.cursor.next(e);return this.pos+=(i.length+e)*t,this.value=i.length<=n?i:t<0?i.slice(i.length-n):i.slice(0,n),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},qe=class{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:n,value:i}=this.inner.next(e);return t?(this.done=!0,this.value=""):n?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=i,this.afterBreak=!1),this}get lineBreak(){return!1}};typeof Symbol!="undefined"&&(E.prototype[Symbol.iterator]=function(){return this.iter()},H.prototype[Symbol.iterator]=je.prototype[Symbol.iterator]=qe.prototype[Symbol.iterator]=function(){return this});var Dt=class{constructor(e,t,n,i){this.from=e,this.to=t,this.number=n,this.text=i}get length(){return this.to-this.from}};var S=typeof navigator!="undefined"?navigator:{userAgent:"",vendor:"",platform:""},ze=typeof document!="undefined"?document:{documentElement:{style:{}}},Ge=/Edge\/(\d+)/.exec(S.userAgent),Nt=/MSIE \d/.test(S.userAgent),Je=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(S.userAgent),xe=!!(Nt||Je||Ge),Bt=!xe&&/gecko\/(\d+)/i.test(S.userAgent),$e=!xe&&/Chrome\/(\d+)/.exec(S.userAgent),Ot="webkitFontSmoothing"in ze.documentElement.style,Vt=!xe&&/Apple Computer/.test(S.vendor),Lt=Vt&&(/Mobile\/\w+/.test(S.userAgent)||S.maxTouchPoints>2),j={mac:Lt||/Mac/.test(S.platform),windows:/Win/.test(S.platform),linux:/Linux|X11/.test(S.platform),ie:xe,ie_version:Nt?ze.documentMode||6:Je?+Je[1]:Ge?+Ge[1]:0,gecko:Bt,gecko_version:Bt?+(/Firefox\/(\d+)/.exec(S.userAgent)||[0,0])[1]:0,chrome:!!$e,chrome_version:$e?+$e[1]:0,ios:Lt,android:/Android\b/.test(S.userAgent),webkit:Ot,safari:Vt,webkit_version:Ot?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:ze.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};var On=256,I=class extends v{constructor(e){super();this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,n){return n&&(!(n instanceof I)||this.length-(t-e)+n.length>On)?!1:(this.text=this.text.slice(0,e)+(n?n.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new I(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new A(this.dom,e)}domBoundsAround(e,t,n){return{from:n,to:n+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return Vn(this.dom,e,t)}},_=class extends v{constructor(e,t=[],n=0){super();this.mark=e;this.children=t;this.length=n;for(let i of t)i.setParent(this)}setAttrs(e){if(ge(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=w.Attrs|w.Node)}sync(e){this.dom?this.dirty&w.Attrs&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,t,n,i,s,l){return n&&(!(n instanceof _&&n.mark.eq(this.mark))||e&&s<=0||t<this.length&&l<=0)?!1:(be(this,e,t,n?n.children:[],s-1,l-1),this.markDirty(),!0)}split(e){let t=[],n=0,i=-1,s=0;for(let o of this.children){let h=n+o.length;h>e&&t.push(n<e?o.split(e-n):o),i<0&&n>=e&&(i=s),n=h,s++}let l=this.length-e;return this.length=e,i>-1&&(this.children.length=i,this.markDirty()),new _(this.mark,t,l)}domAtPos(e){return Ue(this.dom,this.children,e)}coordsAt(e,t){return Ye(this,e,t)}};function Vn(r,e,t){let n=r.nodeValue.length;e>n&&(e=n);let i=e,s=e,l=0;e==0&&t<0||e==n&&t>=0?j.chrome||j.gecko||(e?(i--,l=1):(s++,l=-1)):t<0?i--:s++;let o=We(r,i,s).getClientRects();if(!o.length)return Fe;let h=o[(l?l<0:t>=0)?0:o.length-1];return j.safari&&!l&&h.width==0&&(h=Array.prototype.find.call(o,a=>a.width)||h),l?me(h,l<0):h||null}var D=class extends v{constructor(e,t,n){super();this.widget=e;this.length=t;this.side=n;this.prevWidget=null}static create(e,t,n){return new(e.customView||D)(e,t,n)}split(e){let t=D.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,t,n,i,s,l){return n&&(!(n instanceof D)||!this.widget.compare(n.widget)||e>0&&s<=0||t<this.length&&l<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-t),!0)}become(e){return e.length==this.length&&e instanceof D&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.eq(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return E.empty;let e=this;for(;e.parent;)e=e.parent;let t=e.editorView,n=t&&t.state.doc,i=this.posAtStart;return n?n.slice(i,i+this.length):E.empty}domAtPos(e){return e==0?A.before(this.dom):A.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let n=this.dom.getClientRects(),i=null;if(!n.length)return Fe;for(let s=e>0?n.length-1:0;i=n[s],!(e>0?s==0:s==n.length-1||i.top<i.bottom);s+=e>0?-1:1);return e==0&&t>0||e==this.length&&t<=0?i:me(i,e==0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}};var ie=class extends v{constructor(e){super();this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof ie&&e.side==this.side}split(){return new ie(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return A.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return E.empty}};I.prototype.children=D.prototype.children=ie.prototype.children=pe;function Ue(r,e,t){let n=0;for(let i=0;n<e.length;n++){let s=e[n],l=i+s.length;if(!(l==i&&s.getSide()<=0)){if(t>i&&t<l&&s.dom.parentNode==r)return s.domAtPos(t-i);if(t<=i)break;i=l}}for(;n>0;n--){let i=e[n-1].dom;if(i.parentNode==r)return A.after(i)}return new A(r,0)}function Ke(r,e,t){let n,{children:i}=r;t>0&&e instanceof _&&i.length&&(n=i[i.length-1])instanceof _&&n.mark.eq(e.mark)?Ke(n,e.children[0],t-1):(i.push(e),e.setParent(r)),r.length+=e.length}function Ye(r,e,t){for(let s=0,l=0;l<r.children.length;l++){let o=r.children[l],h=s+o.length,a;if((t<=0||h==r.length||o.getSide()>0?h>=e:h>e)&&(e<h||l+1==r.children.length||(a=r.children[l+1]).length||a.getSide()>0)){let u=0;if(h==s){if(o.getSide()<=0)continue;u=t=-o.getSide()}let c=o.coordsAt(Math.max(0,e-s),t);return u&&c?me(c,t<0):c}s=h}let n=r.dom.lastChild;if(!n)return r.dom.getBoundingClientRect();let i=de(n);return i[i.length-1]||null}var le=k(require("@codemirror/state"));var Ft=k(require("@codemirror/state")),N=class{eq(e){return this==e}range(e,t=e){return new ye(e,t,this)}};N.prototype.startSide=N.prototype.endSide=0;N.prototype.point=!1;N.prototype.mapMode=Ft.MapMode.TrackDel;var ye=class{constructor(e,t,n){this.from=e,this.to=t,this.value=n}};function Xe(r,e){return r.from-e.from||r.value.startSide-e.value.startSide}var ke=class{constructor(e,t,n,i){this.from=e,this.to=t,this.value=n,this.maxPoint=i}get length(){return this.to[this.to.length-1]}findIndex(e,t,n,i=0){let s=n?this.to:this.from;for(let l=i,o=s.length;;){if(l==o)return l;let h=l+o>>1,a=s[h]-e||(n?this.value[h].endSide:this.value[h].startSide)-t;if(h==l)return a>=0?l:o;a>=0?o=h:l=h+1}}between(e,t,n,i){for(let s=this.findIndex(t,-1e9,!0),l=this.findIndex(n,1e9,!1,s);s<l;s++)if(i(this.from[s]+e,this.to[s]+e,this.value[s])===!1)return!1}map(e,t){let n=[],i=[],s=[],l=-1,o=-1;for(let h=0;h<this.value.length;h++){let a=this.value[h],u=this.from[h]+e,c=this.to[h]+e,d,f;if(u==c){let m=t.mapPos(u,a.startSide,a.mapMode);if(m==null||(d=f=m,a.startSide!=a.endSide&&(f=t.mapPos(u,a.endSide),f<d)))continue}else if(d=t.mapPos(u,a.startSide),f=t.mapPos(c,a.endSide),d>f||d==f&&a.startSide>0&&a.endSide<=0)continue;(f-d||a.endSide-a.startSide)<0||(l<0&&(l=d),a.point&&(o=Math.max(o,f-d)),n.push(a),i.push(d-l),s.push(f-l))}return{mapped:n.length?new ke(i,s,n,o):null,pos:l}}},y=class{constructor(e,t,n=y.empty,i){this.chunkPos=e,this.chunk=t,this.nextLayer=n,this.maxPoint=i}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:n=!1,filterFrom:i=0,filterTo:s=this.length}=e,l=e.filter;if(t.length==0&&!l)return this;if(n&&(t=t.slice().sort(Xe)),this.isEmpty)return t.length?y.of(t):this;let o=new Ze(this,null,-1).goto(0),h=0,a=[],u=new re;for(;o.value||h<t.length;)if(h<t.length&&(o.from-t[h].from||o.startSide-t[h].value.startSide)>=0){let c=t[h++];u.addInner(c.from,c.to,c.value)||a.push(c)}else o.rangeIndex==1&&o.chunkIndex<this.chunk.length&&(h==t.length||this.chunkEnd(o.chunkIndex)<t[h].from)&&(!l||i>this.chunkEnd(o.chunkIndex)||s<this.chunkPos[o.chunkIndex])&&u.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!l||i>o.to||s<o.from||l(o.from,o.to,o.value))&&(u.addInner(o.from,o.to,o.value)||a.push(new ye(o.from,o.to,o.value))),o.next());return u.finishInner(this.nextLayer.isEmpty&&!a.length?y.empty:this.nextLayer.update({add:a,filter:l,filterFrom:i,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],n=[],i=-1;for(let l=0;l<this.chunk.length;l++){let o=this.chunkPos[l],h=this.chunk[l],a=e.touchesRange(o,o+h.length);if(a===!1)i=Math.max(i,h.maxPoint),t.push(h),n.push(e.mapPos(o));else if(a===!0){let{mapped:u,pos:c}=h.map(o,e);u&&(i=Math.max(i,u.maxPoint),t.push(u),n.push(c))}}let s=this.nextLayer.map(e);return t.length==0?s:new y(n,t,s,i)}between(e,t,n){if(!this.isEmpty){for(let i=0;i<this.chunk.length;i++){let s=this.chunkPos[i],l=this.chunk[i];if(t>=s&&e<=s+l.length&&l.between(s,e-s,t-s,n)===!1)return}this.nextLayer.between(e,t,n)}}iter(e=0){return q.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return q.from(e).goto(t)}static compare(e,t,n,i,s=-1){let l=e.filter(c=>c.maxPoint>0||!c.isEmpty&&c.maxPoint>=s),o=t.filter(c=>c.maxPoint>0||!c.isEmpty&&c.maxPoint>=s),h=Wt(l,o,n),a=new z(l,h,s),u=new z(o,h,s);n.iterGaps((c,d,f)=>Ht(a,c,u,d,f,i)),n.empty&&n.length==0&&Ht(a,0,u,0,0,i)}static eq(e,t,n=0,i){i==null&&(i=1e9);let s=e.filter(u=>!u.isEmpty&&t.indexOf(u)<0),l=t.filter(u=>!u.isEmpty&&e.indexOf(u)<0);if(s.length!=l.length)return!1;if(!s.length)return!0;let o=Wt(s,l),h=new z(s,o,0).goto(n),a=new z(l,o,0).goto(n);for(;;){if(h.to!=a.to||!et(h.active,a.active)||h.point&&(!a.point||!h.point.eq(a.point)))return!1;if(h.to>i)return!0;h.next(),a.next()}}static spans(e,t,n,i,s=-1){var l;let o=new z(e,null,s,(l=i.filterPoint)===null||l===void 0?void 0:l.bind(i)).goto(t),h=t,a=o.openStart;for(;;){let u=Math.min(o.to,n);if(o.point?(i.point(h,u,o.point,o.activeForPoint(o.to),a),a=o.openEnd(u)+(o.to>u?1:0)):u>h&&(i.span(h,u,o.active,a),a=o.openEnd(u)),o.to>n)break;h=o.to,o.next()}return a}static of(e,t=!1){let n=new re;for(let i of e instanceof ye?[e]:t?Ln(e):e)n.add(i.from,i.to,i.value);return n.finish()}};y.empty=new y([],[],null,-1);function Ln(r){if(r.length>1)for(let e=r[0],t=1;t<r.length;t++){let n=r[t];if(Xe(e,n)>0)return r.slice().sort(Xe);e=n}return r}y.empty.nextLayer=y.empty;var re=class{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(e){this.chunks.push(new ke(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}add(e,t,n){this.addInner(e,t,n)||(this.nextLayer||(this.nextLayer=new re)).add(e,t,n)}addInner(e,t,n){let i=e-this.lastTo||n.startSide-this.last.endSide;if(i<=0&&(e-this.lastFrom||n.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return i<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=n,this.lastFrom=e,this.lastTo=t,this.value.push(n),n.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let n=t.value.length-1;return this.last=t.value[n],this.lastFrom=t.from[n]+e,this.lastTo=t.to[n]+e,!0}finish(){return this.finishInner(y.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=new y(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}};function Wt(r,e,t){let n=new Map;for(let s of r)for(let l=0;l<s.chunk.length;l++)s.chunk[l].maxPoint<=0&&n.set(s.chunk[l],s.chunkPos[l]);let i=new Set;for(let s of e)for(let l=0;l<s.chunk.length;l++){let o=n.get(s.chunk[l]);o!=null&&(t?t.mapPos(o):o)==s.chunkPos[l]&&!(t==null?void 0:t.touchesRange(o,o+s.chunk[l].length))&&i.add(s.chunk[l])}return i}var Ze=class{constructor(e,t,n,i=0){this.layer=e,this.skip=t,this.minPoint=n,this.rank=i}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,n){for(;this.chunkIndex<this.layer.chunk.length;){let i=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(i)||this.layer.chunkEnd(this.chunkIndex)<e||i.maxPoint<this.minPoint))break;this.chunkIndex++,n=!1}if(this.chunkIndex<this.layer.chunk.length){let i=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!n||this.rangeIndex<i)&&this.setRangeIndex(i)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],n=e+t.from[this.rangeIndex];if(this.from=n,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.to-e.to||this.endSide-e.endSide}},q=class{constructor(e){this.heap=e}static from(e,t=null,n=-1){let i=[];for(let s=0;s<e.length;s++)for(let l=e[s];!l.isEmpty;l=l.nextLayer)l.maxPoint>=n&&i.push(new Ze(l,t,n,s));return i.length==1?i[0]:new q(i)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let n of this.heap)n.goto(e,t);for(let n=this.heap.length>>1;n>=0;n--)Qe(this.heap,n);return this.next(),this}forward(e,t){for(let n of this.heap)n.forward(e,t);for(let n=this.heap.length>>1;n>=0;n--)Qe(this.heap,n);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Qe(this.heap,0)}}};function Qe(r,e){for(let t=r[e];;){let n=(e<<1)+1;if(n>=r.length)break;let i=r[n];if(n+1<r.length&&i.compare(r[n+1])>=0&&(i=r[n+1],n++),t.compare(i)<0)break;r[n]=t,r[e]=i,e=n}}var z=class{constructor(e,t,n,i=()=>!0){this.minPoint=n,this.filterPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=q.from(e,t,n)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){ve(this.active,e),ve(this.activeTo,e),ve(this.activeRank,e),this.minActive=jt(this.active,this.activeTo)}addActive(e){let t=0,{value:n,to:i,rank:s}=this.cursor;for(;t<this.activeRank.length&&this.activeRank[t]<=s;)t++;Ce(this.active,t,n),Ce(this.activeTo,t,i),Ce(this.activeRank,t,s),e&&Ce(e,t,this.cursor.from),this.minActive=jt(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let n=this.openStart<0?[]:null,i=0;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>e){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),n&&ve(n,s)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let l=this.cursor.value;if(!l.point)this.addActive(n),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else if(!this.filterPoint(this.cursor.from,this.cursor.to,this.cursor.value,this.cursor.rank))this.cursor.next();else{this.point=l,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=l.endSide,this.cursor.from<e&&(i=1),this.cursor.next(),this.to>e&&this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(n){let s=0;for(;s<n.length&&n[s]<e;)s++;this.openStart=s+i}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let n=this.active.length-1;n>=0&&!(this.activeRank[n]<this.pointRank);n--)(this.activeTo[n]>e||this.activeTo[n]==e&&this.active[n].endSide>=this.point.endSide)&&t.push(this.active[n]);return t.reverse()}openEnd(e){let t=0;for(let n=this.activeTo.length-1;n>=0&&this.activeTo[n]>e;n--)t++;return t}};function Ht(r,e,t,n,i,s){r.goto(e),t.goto(n);let l=n+i,o=n,h=n-e;for(;;){let a=r.to+h-t.to||r.endSide-t.endSide,u=a<0?r.to+h:t.to,c=Math.min(u,l);if(r.point||t.point?r.point&&t.point&&(r.point==t.point||r.point.eq(t.point))&&et(r.activeForPoint(r.to+h),t.activeForPoint(t.to))||s.comparePoint(o,c,r.point,t.point):c>o&&!et(r.active,t.active)&&s.compareRange(o,c,r.active,t.active),u>l)break;o=u,a<=0&&r.next(),a>=0&&t.next()}}function et(r,e){if(r.length!=e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!=e[t]&&!r[t].eq(e[t]))return!1;return!0}function ve(r,e){for(let t=e,n=r.length-1;t<n;t++)r[t]=r[t+1];r.pop()}function Ce(r,e,t){for(let n=r.length-1;n>=e;n--)r[n+1]=r[n];r[e]=t}function jt(r,e){let t=-1,n=1e9;for(let i=0;i<e.length;i++)(e[i]-n||r[i].endSide-r[t].endSide)<0&&(t=i,n=e[i]);return t}function tt(r,e){for(let t in r)t=="class"&&e.class?e.class+=" "+r.class:t=="style"&&e.style?e.style+=";"+r.style:e[t]=r[t];return e}function se(r,e){if(r==e)return!0;if(!r||!e)return!1;let t=Object.keys(r),n=Object.keys(e);if(t.length!=n.length)return!1;for(let i of t)if(n.indexOf(i)==-1||r[i]!==e[i])return!1;return!0}function qt(r,e,t){if(e)for(let n in e)t&&n in t||r.removeAttribute(n);if(t)for(let n in t)e&&e[n]==t[n]||r.setAttribute(n,t[n])}var x;(function(c){c[c.NonIncEnd=-5e8]="NonIncEnd",c[c.BlockBefore=-4e8]="BlockBefore",c[c.BlockIncStart=-3e8]="BlockIncStart",c[c.Line=-2e8]="Line",c[c.InlineBefore=-1e8]="InlineBefore",c[c.InlineIncStart=-1]="InlineIncStart",c[c.InlineIncEnd=1]="InlineIncEnd",c[c.InlineAfter=1e8]="InlineAfter",c[c.BlockIncEnd=2e8]="BlockIncEnd",c[c.BlockAfter=3e8]="BlockAfter",c[c.NonIncStart=4e8]="NonIncStart"})(x||(x={}));var B;(function(i){i[i.Text=0]="Text",i[i.WidgetBefore=1]="WidgetBefore",i[i.WidgetAfter=2]="WidgetAfter",i[i.WidgetRange=3]="WidgetRange"})(B||(B={}));var oe=class extends N{constructor(e,t,n,i){super();this.startSide=e;this.endSide=t;this.widget=n;this.spec=i}get heightRelevant(){return!1}static mark(e){return new he(e)}static widget(e){let t=e.side||0,n=!!e.block;return t+=n?t>0?3e8:-4e8:t>0?1e8:-1e8,new J(e,t,t,n,e.widget||null,!1)}static replace(e){let t=!!e.block,{start:n,end:i}=zt(e,t),s=(n?t?-3e8:-1:4e8)-1,l=(i?t?2e8:1:-5e8)+1;return new J(e,s,l,t,e.widget||null,!0)}static line(e){return new G(e)}static set(e,t=!1){return y.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}};oe.none=y.empty;var he=class extends oe{constructor(e){let{start:t,end:n}=zt(e);super(t?-1:4e8,n?1:-5e8,null,e);this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof he&&this.tagName==e.tagName&&this.class==e.class&&se(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}};he.prototype.point=!1;var G=class extends oe{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof G&&se(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}};G.prototype.mapMode=le.MapMode.TrackBefore;G.prototype.point=!0;var J=class extends oe{constructor(e,t,n,i,s,l){super(t,n,s,e);this.block=i;this.isReplace=l;this.mapMode=i?t<=0?le.MapMode.TrackBefore:le.MapMode.TrackAfter:le.MapMode.TrackDel}get type(){return this.startSide<this.endSide?3:this.startSide<=0?1:2}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof J&&Fn(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}};J.prototype.point=!0;function zt(r,e=!1){let{inclusiveStart:t,inclusiveEnd:n}=r;return t==null&&(t=r.inclusive),n==null&&(n=r.inclusive),{start:t??e,end:n??e}}function Fn(r,e){return r==e||!!(r&&e&&r.compare(e))}var Wn=k(require("@codemirror/state")),O=class extends v{constructor(){super(...arguments);this.children=[];this.length=0;this.prevAttrs=void 0;this.attrs=null;this.breakAfter=0}merge(e,t,n,i,s,l){if(n){if(!(n instanceof O))return!1;this.dom||n.transferDOM(this)}return i&&this.setDeco(n?n.attrs:null),be(this,e,t,n?n.children:[],s,l),!0}split(e){let t=new O;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i:n,off:i}=this.childPos(e);i&&(t.append(this.children[n].split(i),0),this.children[n].merge(i,this.children[n].length,null,!1,0,0),n++);for(let s=n;s<this.children.length;s++)t.append(this.children[s],0);for(;n>0&&this.children[n-1].length==0;)this.children[--n].destroy();return this.children.length=n,this.markDirty(),this.length=e,t}transferDOM(e){!this.dom||(e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){se(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){Ke(this,e,t)}addLineDeco(e){let t=e.spec.attributes,n=e.spec.class;t&&(this.attrs=tt(t,this.attrs||{})),n&&(this.attrs=tt({class:n},this.attrs||{}))}domAtPos(e){return Ue(this.dom,this.children,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=w.Attrs|w.Node)}sync(e){this.dom?this.dirty&w.Attrs&&(ge(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(qt(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let t=this.dom.lastChild;for(;t&&v.get(t)instanceof _;)t=t.lastChild;if(!t||t.nodeName!="BR"&&v.get(t)?.isEditable==!1&&(!j.ios||!this.children.some(n=>n instanceof I))){let n=document.createElement("BR");n.cmIgnore=!0,this.dom.appendChild(n)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0;for(let t of this.children){if(!(t instanceof I))return null;let n=de(t.dom);if(n.length!=1)return null;e+=n[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}}coordsAt(e,t){return Ye(this,e,t)}become(e){return!1}get type(){return B.Text}static find(e,t){for(let n=0,i=0;n<e.children.length;n++){let s=e.children[n],l=i+s.length;if(l>=t){if(s instanceof O)return s;if(l>t)break}i=l+s.breakAfter}return null}};var Se=k(require("@codemirror/state"));function nt(r,e,t=1){let n=r.charCategorizer(e),i=r.doc.lineAt(e),s=e-i.from;if(i.length==0)return Se.EditorSelection.cursor(e);s==0?t=1:s==i.length&&(t=-1);let l=s,o=s;t<0?l=ne(i.text,s,!1):o=ne(i.text,s);let h=n(i.text.slice(l,o));for(;l>0;){let a=ne(i.text,l,!1);if(n(i.text.slice(a,l))!=h)break;l=a}for(;o<i.length;){let a=ne(i.text,o);if(n(i.text.slice(o,a))!=h)break;o=a}return Se.EditorSelection.range(l+i.from,o+i.from)}var Gt=(r,e)=>r>=e.top&&r<=e.bottom,Jt=(r,e,t)=>Gt(e,t)&&r>=t.left&&r<=t.right;function Hn(r,e,t,n){let i=O.find(r.docView,e);if(!i)return 1;let s=e-i.posAtStart;if(s==0)return 1;if(s==i.length)return-1;let l=i.coordsAt(s,-1);if(l&&Jt(t,n,l))return-1;let o=i.coordsAt(s,1);return o&&Jt(t,n,o)?1:l&&Gt(n,l)?-1:1}function it(r,e){let t=r.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:Hn(r,t,e.clientX,e.clientY)}}var Ut=r=>{let e=(n,i,s,l)=>{var h;let o=nt(n.state,i,s);return(h=fe(r,i,o,n.state))!=null?h:o};return $t.EditorView.mouseSelectionStyle.of((n,i)=>{if(i.button!==0||i.detail!==2)return null;let s=it(n,i),l=i.detail,o=n.state.selection,h=s,a=i;return{update(u){u.docChanged&&(s&&(s.pos=u.changes.mapPos(s.pos)),o=o.map(u.changes),a=null)},get(u,c,d){let f;if(a&&u.clientX==a.clientX&&u.clientY==a.clientY?f=h:(f=h=it(n,u),a=u),!f||!s)return o;let m=e(n,f.pos,f.bias,l);if(s.pos!=f.pos&&!c){let P=e(n,s.pos,s.bias,l),F=Math.min(P.from,m.from),Z=Math.max(P.to,m.to);m=F<m.from?Ae.EditorSelection.range(F,Z):Ae.EditorSelection.range(Z,F)}return c?o.replaceRange(o.main.extend(m.from,m.to)):d?o.addRange(m):Ae.EditorSelection.create([m])}}})};var sn=k(require("@codemirror/state"));var $="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(r=>r?parseInt(r,36):1);for(let r=1;r<$.length;r++)$[r]+=$[r-1];function jn(r){for(let e=1;e<$.length;e+=2)if($[e]>r)return $[e-1]<=r;return!1}function Kt(r){return r>=127462&&r<=127487}var Yt=8205;function Xt(r,e,t=!0,n=!0){return(t?Zt:qn)(r,e,n)}function Zt(r,e,t){if(e==r.length)return e;e&&Qt(r.charCodeAt(e))&&en(r.charCodeAt(e-1))&&e--;let n=rt(r,e);for(e+=tn(n);e<r.length;){let i=rt(r,e);if(n==Yt||i==Yt||t&&jn(i))e+=tn(i),n=i;else if(Kt(i)){let s=0,l=e-2;for(;l>=0&&Kt(rt(r,l));)s++,l-=2;if(s%2==0)break;e+=2}else break}return e}function qn(r,e,t){for(;e>0;){let n=Zt(r,e-2,t);if(n<e)return n;e--}return 0}function Qt(r){return r>=56320&&r<57344}function en(r){return r>=55296&&r<56320}function rt(r,e){let t=r.charCodeAt(e);if(!en(t)||e+1==r.length)return t;let n=r.charCodeAt(e+1);return Qt(n)?(t-55296<<10)+(n-56320)+65536:t}function tn(r){return r<65536?1:2}var V=class{constructor(){}lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,n){let i=[];return this.decompose(0,e,i,2),n.length&&n.decompose(0,n.length,i,1|2),this.decompose(t,this.length,i,1),R.from(i,this.length-(t-e)+n.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){let n=[];return this.decompose(e,t,n,0),R.from(n,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),n=this.length-this.scanIdentical(e,-1),i=new U(this),s=new U(e);for(let l=t,o=t;;){if(i.next(l),s.next(l),l=0,i.lineBreak!=s.lineBreak||i.done!=s.done||i.value!=s.value)return!1;if(o+=i.value.length,i.done||o>=n)return!0}}iter(e=1){return new U(this,e)}iterRange(e,t=this.length){return new st(this,e,t)}iterLines(e,t){let n;if(e==null)n=this.iter();else{t==null&&(t=this.lines+1);let i=this.line(e).from;n=this.iterRange(i,Math.max(i,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new lt(n)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?V.empty:e.length<=32?new p(e):R.from(p.split(e,[]))}},p=class extends V{constructor(e,t=zn(e)){super();this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,n,i){for(let s=0;;s++){let l=this.text[s],o=i+l.length;if((t?n:o)>=e)return new rn(i,o,n,l);i=o+1,n++}}decompose(e,t,n,i){let s=e<=0&&t>=this.length?this:new p(nn(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(i&1){let l=n.pop(),o=Ee(s.text,l.text.slice(),0,s.length);if(o.length<=32)n.push(new p(o,l.length+s.length));else{let h=o.length>>1;n.push(new p(o.slice(0,h)),new p(o.slice(h)))}}else n.push(s)}replace(e,t,n){if(!(n instanceof p))return super.replace(e,t,n);let i=Ee(this.text,Ee(n.text,nn(this.text,0,e)),t),s=this.length+n.length-(t-e);return i.length<=32?new p(i,s):R.from(p.split(i,[]),s)}sliceString(e,t=this.length,n=`
`){let i="";for(let s=0,l=0;s<=t&&l<this.text.length;l++){let o=this.text[l],h=s+o.length;s>e&&l&&(i+=n),e<h&&t>s&&(i+=o.slice(Math.max(0,e-s),t-s)),s=h+1}return i}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let n=[],i=-1;for(let s of e)n.push(s),i+=s.length+1,n.length==32&&(t.push(new p(n,i)),n=[],i=-1);return i>-1&&t.push(new p(n,i)),t}},R=class extends V{constructor(e,t){super();this.children=e,this.length=t,this.lines=0;for(let n of e)this.lines+=n.lines}lineInner(e,t,n,i){for(let s=0;;s++){let l=this.children[s],o=i+l.length,h=n+l.lines-1;if((t?h:o)>=e)return l.lineInner(e,t,n,i);i=o+1,n=h+1}}decompose(e,t,n,i){for(let s=0,l=0;l<=t&&s<this.children.length;s++){let o=this.children[s],h=l+o.length;if(e<=h&&t>=l){let a=i&((l<=e?1:0)|(h>=t?2:0));l>=e&&h<=t&&!a?n.push(o):o.decompose(e-l,t-l,n,a)}l=h+1}}replace(e,t,n){if(n.lines<this.lines)for(let i=0,s=0;i<this.children.length;i++){let l=this.children[i],o=s+l.length;if(e>=s&&t<=o){let h=l.replace(e-s,t-s,n),a=this.lines-l.lines+h.lines;if(h.lines<a>>5-1&&h.lines>a>>5+1){let u=this.children.slice();return u[i]=h,new R(u,this.length-(t-e)+n.length)}return super.replace(s,o,h)}s=o+1}return super.replace(e,t,n)}sliceString(e,t=this.length,n=`
`){let i="";for(let s=0,l=0;s<this.children.length&&l<=t;s++){let o=this.children[s],h=l+o.length;l>e&&s&&(i+=n),e<h&&t>l&&(i+=o.sliceString(e-l,t-l,n)),l=h+1}return i}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof R))return 0;let n=0,[i,s,l,o]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;i+=t,s+=t){if(i==l||s==o)return n;let h=this.children[i],a=e.children[s];if(h!=a)return n+h.scanIdentical(a,t);n+=h.length+1}}static from(e,t=e.reduce((n,i)=>n+i.length+1,-1)){let n=0;for(let f of e)n+=f.lines;if(n<32){let f=[];for(let m of e)m.flatten(f);return new p(f,t)}let i=Math.max(32,n>>5),s=i<<1,l=i>>1,o=[],h=0,a=-1,u=[];function c(f){let m;if(f.lines>s&&f instanceof R)for(let P of f.children)c(P);else f.lines>l&&(h>l||!h)?(d(),o.push(f)):f instanceof p&&h&&(m=u[u.length-1])instanceof p&&f.lines+m.lines<=32?(h+=f.lines,a+=f.length+1,u[u.length-1]=new p(m.text.concat(f.text),m.length+1+f.length)):(h+f.lines>i&&d(),h+=f.lines,a+=f.length+1,u.push(f))}function d(){h!=0&&(o.push(u.length==1?u[0]:R.from(u,a)),a=-1,h=u.length=0)}for(let f of e)c(f);return d(),o.length==1?o[0]:new R(o,t)}};V.empty=new p([""],0);function zn(r){let e=-1;for(let t of r)e+=t.length+1;return e}function Ee(r,e,t=0,n=1e9){for(let i=0,s=0,l=!0;s<r.length&&i<=n;s++){let o=r[s],h=i+o.length;h>=t&&(h>n&&(o=o.slice(0,n-i)),i<t&&(o=o.slice(t-i)),l?(e[e.length-1]+=o,l=!1):e.push(o)),i=h+1}return e}function nn(r,e,t){return Ee(r,[""],e,t)}var U=class{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof p?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let n=this.nodes.length-1,i=this.nodes[n],s=this.offsets[n],l=s>>1,o=i instanceof p?i.text.length:i.children.length;if(l==(t>0?o:0)){if(n==0)return this.done=!0,this.value="",this;t>0&&this.offsets[n-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(t>0?0:1)){if(this.offsets[n]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(i instanceof p){let h=i.text[l+(t<0?-1:0)];if(this.offsets[n]+=t,h.length>Math.max(0,e))return this.value=e==0?h:t>0?h.slice(e):h.slice(0,h.length-e),this;e-=h.length}else{let h=i.children[l+(t<0?-1:0)];e>h.length?(e-=h.length,this.offsets[n]+=t):(t<0&&this.offsets[n]--,this.nodes.push(h),this.offsets.push(t>0?1:(h instanceof p?h.text.length:h.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}},st=class{constructor(e,t,n){this.value="",this.done=!1,this.cursor=new U(e,t>n?-1:1),this.pos=t>n?e.length:0,this.from=Math.min(t,n),this.to=Math.max(t,n)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let n=t<0?this.pos-this.from:this.to-this.pos;e>n&&(e=n),n-=e;let{value:i}=this.cursor.next(e);return this.pos+=(i.length+e)*t,this.value=i.length<=n?i:t<0?i.slice(i.length-n):i.slice(0,n),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},lt=class{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:n,value:i}=this.inner.next(e);return t?(this.done=!0,this.value=""):n?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=i,this.afterBreak=!1),this}get lineBreak(){return!1}};typeof Symbol!="undefined"&&(V.prototype[Symbol.iterator]=function(){return this.iter()},U.prototype[Symbol.iterator]=st.prototype[Symbol.iterator]=lt.prototype[Symbol.iterator]=function(){return this});var rn=class{constructor(e,t,n,i){this.from=e,this.to=t,this.number=n,this.text=i}get length(){return this.to-this.from}};var K=k(require("@codemirror/view")),ln=r=>{function e({state:l,dispatch:o},h){if(l.readOnly)return!1;let a="delete.selection",u=l.changeByRange(c=>{let{from:d,to:f}=c;if(d==f){let m=h(d);m<d?a="delete.backward":m>d&&(a="delete.forward"),d=Math.min(d,m),f=Math.max(f,m)}return d==f?{range:c}:{changes:{from:d,to:f},range:sn.EditorSelection.cursor(d)}});return u.changes.empty?!1:(o(l.update(u,{scrollIntoView:!0,userEvent:a})),!0)}function t(l,o,h){if(l instanceof K.EditorView)for(let a of l.pluginField(K.PluginField.atomicRanges))a.between(o,o,(u,c)=>{u<o&&c>o&&(o=h?c:u)});return o}let n=(l,o)=>e(l,h=>{var f;let a=h,{state:u}=l,c=u.doc.lineAt(a),d=u.charCategorizer(a);for(let m=null;;){if(a==(o?c.to:c.from)){a==h&&c.number!=(o?u.doc.lines:1)&&(a+=o?1:-1);break}let P=Xt(c.text,a-c.from,o)+c.from,F=c.text.slice(Math.min(a,P)-c.from,Math.max(a,P)-c.from),Z=d(F);if(m!=null&&Z!=m)break;(F!=" "||a!=h)&&(m=Z),a=P}return a=(f=r.getSegRangeFromGroup(h,a,u.sliceDoc.bind(u)))!=null?f:a,t(l,a,o)}),i=l=>n(l,!1),s=l=>n(l,!0);return K.keymap.of([{key:"Ctrl-Alt-h",run:i},{key:"Mod-Backspace",mac:"Alt-Backspace",run:i},{key:"Mod-Delete",mac:"Alt-Delete",run:s}])};var on=r=>[Ut(r),ln(r)];var Gn=r=>{r.registerEditorExtension(on(r)),r.register(te(Me.EditorState.prototype,{wordAt:e=>function(t){var i;let n=e.call(this,t);return(i=fe(r,t,e.call(this,t),this))!=null?i:n}})),r.register(te(hn.EditorView.prototype,{moveByGroup:e=>function(t,n){let i=e.call(this,t,n);if(i.empty&&t.empty){let s=r.getSegRangeFromGroup(t.from,i.from,this.state.sliceDoc.bind(this.state));if(s)return Me.EditorSelection.range(s,s)}return i}}))},an=Gn;var ot=class extends Error{},un=class extends ot{},cn=class extends ot{},Jn=(r,e=",")=>r.join(e),$n={accept:"*",multiple:!1,strict:!1},fn=r=>{let{accept:e,multiple:t,strict:n}={...$n,...r},i=Yn({multiple:t,accept:Array.isArray(e)?Jn(e):e});return new Promise(s=>{i.onchange=()=>{s(Un(i.files,t,n)),i.remove()},i.click()})},Un=(r,e,t)=>new Promise((n,i)=>{if(!r)return i(new un);let s=Kn(r,e,t);if(!s)return i(new cn);n(s)}),Kn=(r,e,t)=>!e&&t?r.length===1?r[0]:null:r.length?r:null,Yn=({accept:r,multiple:e})=>{let t=document.createElement("input");return t.type="file",t.multiple=e,t.accept=r,t};var dn=k(require("obsidian")),Xn="var(--background-modifier-success)",Zn="var(--background-modifier-cover)",Re=class extends dn.Modal{constructor(e){super(e.app);this.plugin=e;this.reloadButton=null;this.selectButton=null;this.downloadLink=`https://github.com/aidenlx/cm-chs-patch/blob/master/assets/jiaba-wasm/${this.libName}.zip?raw=true`;this.lanzoumLink="https://wwe.lanzoum.com/igUPR00jp02h";this.modalEl.addClass("zt-install-guide")}get libName(){return this.plugin.libName}onOpen(){this.contentEl.createEl("h1",{text:"\u5B89\u88C5\u7ED3\u5DF4\u5206\u8BCD"}),this.contentEl.createDiv({},e=>{e.appendText("\u65B0\u7248\u5206\u8BCD\u63D2\u4EF6\u9700\u8981\u5B89\u88C5 jieba-wasm\uFF0C\u8BF7\u6309\u7167\u4E0B\u9762\u7684\u6B65\u9AA4\u5B89\u88C5\uFF1A"),e.createEl("ol",{},t=>{t.createEl("li",{},n=>{n.appendText("\u70B9\u51FB\u94FE\u63A5\u4E0B\u8F7D "),n.createEl("code",{text:this.libName+".zip"}),n.createEl("br"),n.appendText("\u4ECE "),n.createEl("a",{href:this.downloadLink,text:"GitHub"}),n.appendText(" \u6216 "),n.createEl("a",{href:this.lanzoumLink,text:"\u84DD\u594F\u4E91"}),n.appendText(" \u4E0B\u8F7D")}),t.createEl("li",{},n=>{n.appendText("\u89E3\u538B\u7F29zip\u5305\u5F97\u5230 "),n.createEl("code",{text:this.libName})}),t.createEl("li",{},n=>{n.appendText("\u5728\u5F39\u51FA\u7684\u7A97\u53E3\u9009\u62E9 "),n.createEl("code",{text:this.libName}),this.selectButton=n.createEl("button",{text:"\u9009\u62E9\u6587\u4EF6"},i=>i.onclick=this.onSelectingFile.bind(this))}),t.createEl("li",{},n=>{n.appendText("\u91CD\u65B0\u52A0\u8F7D\u5206\u8BCD\u63D2\u4EF6: "),this.reloadButton=n.createEl("button",{text:"\u91CD\u65B0\u52A0\u8F7D"},i=>{i.disabled=!0,i.style.backgroundColor=Zn,i.onclick=this.onReloadPlugin.bind(this)})})})})}onClose(){this.contentEl.empty()}onSelectingFile(){return C(this,null,function*(){let e=yield fn({multiple:!1,accept:".wasm",strict:!0});!e||(yield this.app.vault.adapter.writeBinary(this.plugin.libPath,yield e.arrayBuffer()),this.selectButton&&(this.selectButton.setText("\u7ED3\u5DF4\u5206\u8BCD\u5BFC\u5165\u6210\u529F"),this.selectButton.style.backgroundColor=Xn),this.reloadButton&&(this.reloadButton.disabled=!1,this.reloadButton.style.backgroundColor=""))})}onReloadPlugin(){return C(this,null,function*(){yield this.app.plugins.disablePlugin(this.plugin.manifest.id),this.close(),yield this.app.plugins.enablePlugin(this.plugin.manifest.id)})}};var ri={},b,mn=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});mn.decode();var Pe=null;function Te(){return(Pe===null||Pe.buffer!==b.memory.buffer)&&(Pe=new Uint8Array(b.memory.buffer)),Pe}function ht(r,e){return mn.decode(Te().subarray(r,r+e))}var T=new Array(32).fill(void 0);T.push(void 0,null,!0,!1);var ae=T.length;function ue(r){ae===T.length&&T.push(T.length+1);let e=ae;return ae=T[e],T[e]=r,e}function Ie(r){return T[r]}function Qn(r){r<36||(T[r]=ae,ae=r)}function ce(r){let e=Ie(r);return Qn(r),e}function at(r){let e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){let i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){let i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){let i=r.length,s="[";i>0&&(s+=at(r[0]));for(let l=1;l<i;l++)s+=", "+at(r[l]);return s+="]",s}let t=/\[object ([^\]]+)\]/.exec(toString.call(r)),n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}var Y=0,_e=new TextEncoder("utf-8"),ei=typeof _e.encodeInto=="function"?function(r,e){return _e.encodeInto(r,e)}:function(r,e){let t=_e.encode(r);return e.set(t),{read:r.length,written:t.length}};function De(r,e,t){if(t===void 0){let o=_e.encode(r),h=e(o.length);return Te().subarray(h,h+o.length).set(o),Y=o.length,h}let n=r.length,i=e(n),s=Te(),l=0;for(;l<n;l++){let o=r.charCodeAt(l);if(o>127)break;s[i+l]=o}if(l!==n){l!==0&&(r=r.slice(l)),i=t(i,n,n=l+r.length*3);let o=Te().subarray(i+l,i+n);l+=ei(r,o).written}return Y=l,i}var Ne=null;function Be(){return(Ne===null||Ne.buffer!==b.memory.buffer)&&(Ne=new Int32Array(b.memory.buffer)),Ne}var Oe=null;function ti(){return(Oe===null||Oe.buffer!==b.memory.buffer)&&(Oe=new Uint32Array(b.memory.buffer)),Oe}function ni(r,e){let n=ti().subarray(r/4,r/4+e),i=[];for(let s=0;s<n.length;s++)i.push(ce(n[s]));return i}function ut(r,e){try{let o=b.__wbindgen_add_to_stack_pointer(-16);var t=De(r,b.__wbindgen_malloc,b.__wbindgen_realloc),n=Y;b.cut(o,t,n,e);var i=Be()[o/4+0],s=Be()[o/4+1],l=ni(i,s).slice();return b.__wbindgen_free(i,s*4),l}finally{b.__wbindgen_add_to_stack_pointer(16)}}function ct(r){return r==null}function Ve(r,e,t){var n=De(r,b.__wbindgen_malloc,b.__wbindgen_realloc),i=Y,s=ct(t)?0:De(t,b.__wbindgen_malloc,b.__wbindgen_realloc),l=Y,o=b.add_word(n,i,!ct(e),ct(e)?0:e,s,l);return o>>>0}async function ii(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}let t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}async function gn(r){typeof r=="undefined"&&(r=new URL("jieba_rs_wasm_bg.wasm",ri.url));let e={};e.wbg={},e.wbg.__wbindgen_string_new=function(i,s){var l=ht(i,s);return ue(l)},e.wbg.__wbindgen_object_drop_ref=function(i){ce(i)},e.wbg.__wbg_new_68adb0d58759a4ed=function(){var i=new Object;return ue(i)},e.wbg.__wbindgen_number_new=function(i){var s=i;return ue(s)},e.wbg.__wbg_set_2e79e744454afade=function(i,s,l){Ie(i)[ce(s)]=ce(l)},e.wbg.__wbindgen_object_clone_ref=function(i){var s=Ie(i);return ue(s)},e.wbg.__wbg_new_7031805939a80203=function(i,s){var l=new Error(ht(i,s));return ue(l)},e.wbg.__wbindgen_debug_string=function(i,s){var l=at(Ie(s)),o=De(l,b.__wbindgen_malloc,b.__wbindgen_realloc),h=Y;Be()[i/4+1]=h,Be()[i/4+0]=o},e.wbg.__wbindgen_throw=function(i,s){throw new Error(ht(i,s))},e.wbg.__wbindgen_rethrow=function(i){throw ce(i)},(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));let{instance:t,module:n}=await ii(await r,e);return b=t.exports,gn.__wbindgen_wasm_module=n,b}var pn=gn;var si=r=>r&&Number.isInteger(+r)?+r:void 0,bn=r=>r&&r in li?r:void 0,ft=!1,wn=(r,e)=>C(void 0,null,function*(){if(ft)return;let t=[];if(yield pn(r),e)for(let n of e.split(/\r?\n/)){let[i,s,l]=n.trim().split(/\s+/),o,h;if(!i){t.push(n);continue}!s&&!l?Ve(i):(h=bn(s))?Ve(i,void 0,h):(h=bn(l),o=si(s),Ve(i,o,h))}ut("",!0),ft=!0}),xn=(r,e=!1)=>{if(!ft)throw new Error("jieba not loaded");return ut(r,e)},li={n:void 0,f:void 0,s:void 0,t:void 0,nr:void 0,ns:void 0,nt:void 0,nw:void 0,nz:void 0,v:void 0,vd:void 0,vn:void 0,a:void 0,ad:void 0,an:void 0,d:void 0,m:void 0,q:void 0,r:void 0,p:void 0,c:void 0,u:void 0,xc:void 0,w:void 0,PER:void 0,LOC:void 0,ORG:void 0,TIME:void 0};var L=k(require("obsidian")),dt={useJieba:!1,hmm:!1,dict:""},mt=class extends L.PluginSettingTab{constructor(e){super(e.app,e);this.plugin=e}display(){var t;let{containerEl:e}=this;e.empty(),this.addToggle(e,"useJieba").setName("\u4F7F\u7528\u7ED3\u5DF4\u5206\u8BCD").setDesc("\u652F\u6301\u65B0\u8BCD\u53D1\u73B0\u3001\u81EA\u5B9A\u4E49\u8BCD\u5178\uFF0C\u9700\u8981\u989D\u5916\u4E0B\u8F7D\uFF0C\u91CD\u542Fobsidian\u751F\u6548"),(this.plugin.settings.useJieba||!((t=window.Intl)==null?void 0:t.Segmenter))&&(this.addToggle(e,"hmm").setName("\u65B0\u8BCD\u53D1\u73B0\u529F\u80FD").setDesc("\u91C7\u7528\u57FA\u4E8E\u6C49\u5B57\u6210\u8BCD\u80FD\u529B\u7684 HMM \u6A21\u578B\uFF0C\u4F7F\u7528 Viterbi \u7B97\u6CD5\u63A8\u7B97\u672A\u5B58\u5728\u4E8E\u8BCD\u5E93\u5185\u7684\u8BCD\u3002\u82E5\u6548\u679C\u4E0D\u7406\u60F3\uFF0C\u53EF\u9009\u62E9\u5173\u95ED\u6B64\u9009\u9879"),this.addTextField(e,{get:"dict",set:"dict"},{cols:30,rows:5}).setName("\u7528\u6237\u81EA\u5B9A\u4E49\u8BCD\u5178").setDesc(createFragment(n=>{n.appendText("\u901A\u8FC7\u7528\u6237\u81EA\u5B9A\u4E49\u8BCD\u5178\u6765\u589E\u5F3A\u6B67\u4E49\u7EA0\u9519\u80FD\u529B"),n.createEl("br"),n.appendText("\u8BCD\u5178\u683C\u5F0F\uFF1A\u4E00\u4E2A\u8BCD\u5360\u4E00\u884C\uFF1B\u6BCF\u4E00\u884C\u5206\u4E09\u90E8\u5206\uFF1A\u8BCD\u8BED\u3001\u8BCD\u9891\uFF08\u53EF\u7701\u7565\uFF09\u3001\u8BCD\u6027\uFF08\u53EF\u7701\u7565\uFF09\uFF0C\u7528\u7A7A\u683C\u9694\u5F00\uFF0C\u987A\u5E8F\u4E0D\u53EF\u98A0\u5012"),n.createEl("br"),n.appendText("\u6309\u4E0B\u6309\u94AE\u751F\u6548")})).addButton(n=>n.setIcon("reset").setTooltip("\u91CD\u65B0\u52A0\u8F7D\u8BCD\u5178").onClick(()=>C(this,null,function*(){yield this.app.plugins.disablePlugin(this.plugin.manifest.id),yield this.app.plugins.enablePlugin(this.plugin.manifest.id),this.app.setting.openTabById(this.plugin.manifest.id)}))))}addToggle(e,t){return new L.Setting(e).addToggle(n=>{n.setValue(this.plugin.settings[t]).onChange(i=>(this.plugin.settings[t]=i,this.plugin.saveSettings()))})}addTextField(e,t,n={},i=500){return new L.Setting(e).addTextArea(s=>{let{get:l,set:o}=t,h=typeof l=="function"?l:()=>this.plugin.settings[l],a=typeof o=="function"?o:c=>this.plugin.settings[o]=c,u=c=>C(this,null,function*(){a(c),yield this.plugin.saveSettings()});s.setValue(h()).onChange((0,L.debounce)(u,i,!0)),Object.assign(s.inputEl,ee({cols:30,rows:5},n))})}};var X=6,gt=class extends yn.Plugin{constructor(){super(...arguments);this.libName="jieba_rs_wasm_bg.wasm";this.settings=dt}get libPath(){return this.app.vault.configDir+"/"+this.libName}onload(){return C(this,null,function*(){this.addSettingTab(new mt(this)),yield this.loadSettings(),(yield this.loadSegmenter())&&(yt(this),an(this),console.info("editor word splitting patched"))})}loadSegmenter(){return C(this,null,function*(){var t;let{vault:e}=this.app;return!this.settings.useJieba&&((t=window.Intl)==null?void 0:t.Segmenter)?(this.segmenter=new Intl.Segmenter("zh-CN",{granularity:"word"}),!0):(yield e.adapter.exists(this.libPath,!0))?(yield wn(this.app.vault.adapter.readBinary(this.libPath),this.settings.dict),console.info("Jieba loaded"),!0):(new Re(this).open(),!1)})}loadSettings(){return C(this,null,function*(){this.settings=ee(ee({},dt),yield this.loadData())})}saveSettings(){return C(this,null,function*(){yield this.saveData(this.settings)})}cut(e){return!this.settings.useJieba&&this.segmenter?Array.from(this.segmenter.segment(e)).map(t=>t.segment):xn(e,this.settings.hmm)}getSegRangeFromCursor(e,{from:t,to:n,text:i}){if(/[\u4e00-\u9fa5]/.test(i)){if(e-t>X){let a=e-X;i=i.slice(a-t),t=a}if(n-e>X){let a=e+X;i=i.slice(0,a-n),n=a}let s=this.cut(i);if(e===n){let a=s.last();return{from:n-a.length,to:n}}let l=0,o=0,h=e-t;for(let a of s){if(o=l+a.length,h>=l&&h<o)break;l+=a.length}return n=o+t,t+=l,{from:t,to:n}}else return null}getSegRangeFromGroup(e,t,n){let i=e<t;Math.abs(e-t)>X&&(t=e+X*(i?1:-1));let s=i?n(e,t):n(t,e);if(!/[\u4e00-\u9fa5]/.test(s))return null;let l=this.cut(s);return l.length===0?null:i?e+l.first().length:e-l.last().length}};
